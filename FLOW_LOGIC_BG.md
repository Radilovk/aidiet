# Логика на Потока: Backend → AI Стъпка 1 → AI Стъпка 2 → AI Стъпка 3

## Backend
Изчислява **базови референтни стойности**:
- BMR (Mifflin-St Jeor)
- TDEE (базиран на активност скор)
- Безопасен дефицит (25% максимален)
- Базови макро проценти

Тези стойности са **отправна точка** за AI.

## AI Стъпка 1 (Анализ)
**Преизчислява** калории и макроси базирано на **всички фактори**:
- Стрес, сън, хронотип
- Темперамент, психопрофил
- Здравен статус, медикаменти
- Напитки, хранителни навици
- Метаболитна реактивност
- И всички други значими фактори

**Изход:**
- `bmr`, `tdee` (коригирани)
- `recommendedCalories` (финални препоръчителни калории)
- `macroRatios` (финални макро проценти)
- `macroGrams` (финални грамове)

## AI Стъпка 2 (Стратегия)
Взема резултатите от Стъпка 1 и определя **стратегия**:
- Може да **варира калории/макроси по дни**
- Примери: carb cycling, фастинг, зареждащи дни
- Описва вариациите в:
  - `calorieDistribution` (текст)
  - `macroDistribution` (текст)
  - `weeklyScheme.{day}.description` (текст за всеки ден)

**Изход:**
- Седмична схема с вариации
- Стратегически принципи

## AI Стъпка 3 (Меню)
Взема **калориите и макросите за всеки ден** от Стъпка 2 и създава менюто:
- Продукти, грамажи
- Разпределение по хранения

**Правило:** Използва `calorieDistribution` и `macroDistribution` от Стъпка 2 за съответния ден.

---

**Дата:** 2026-02-18  
**Логика:** Опростена, ясна, без излишни обяснения

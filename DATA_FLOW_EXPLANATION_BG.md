# –û–±—è—Å–Ω–µ–Ω–∏–µ –Ω–∞ –ü–æ—Ç–æ–∫–∞ –æ—Ç –î–∞–Ω–Ω–∏ –º–µ–∂–¥—É –°—Ç—ä–ø–∫–∏—Ç–µ –ø—Ä–∏ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ü–ª–∞–Ω

## üìã –ö—Ä–∞—Ç–∫–æ –†–µ–∑—é–º–µ

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ—Ç–æ –Ω–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ —Ä–∞–±–æ—Ç–∏ –≤ **4 –æ—Å–Ω–æ–≤–Ω–∏ —Å—Ç—ä–ø–∫–∏**:
1. **–°—Ç—ä–ø–∫–∞ 1 (Analysis)** - –ê–Ω–∞–ª–∏–∑ –Ω–∞ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª
2. **–°—Ç—ä–ø–∫–∞ 2 (Strategy)** - –û–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ –¥–∏–µ—Ç–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è  
3. **–°—Ç—ä–ø–∫–∞ 3 (Meal Plan)** - –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω (4 –ø–æ–¥-—Å—Ç—ä–ø–∫–∏)
4. **–°—Ç—ä–ø–∫–∞ 4 (Summary)** - –û–±–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏

**–í–ê–ñ–ï–ù –û–¢–ì–û–í–û–† –ù–ê –í–™–ü–†–û–°–ê**: –ú–æ–∂–µ—Ç–µ –¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞—Ç–µ –∫–æ–∏ –¥–∞–Ω–Ω–∏ —Å–µ –ø—Ä–µ–Ω–∞—Å—è—Ç –º–µ–∂–¥—É —Å—Ç—ä–ø–∫–∏—Ç–µ **–°–ê–ú–û —á—Ä–µ–∑ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ**, –ë–ï–ó –¥–∞ –ø—Ä–æ–º–µ–Ω—è—Ç–µ `worker.js`.

---

## üîÑ –ü–æ–¥—Ä–æ–±–µ–Ω –ü–æ—Ç–æ–∫ –æ—Ç –î–∞–Ω–Ω–∏

### –°—Ç—ä–ø–∫–∞ 1 ‚Üí –°—Ç—ä–ø–∫–∞ 2: –û—Ç –ê–Ω–∞–ª–∏–∑ –∫—ä–º –°—Ç—Ä–∞—Ç–µ–≥–∏—è

#### –ö–∞–∫–≤–æ –ò–ó–ü–†–ê–©–ê –±–µ–∫–µ–Ω–¥—ä—Ç –æ—Ç –°—Ç—ä–ø–∫–∞ 1 –∫—ä–º –°—Ç—ä–ø–∫–∞ 2?

–ë–µ–∫–µ–Ω–¥—ä—Ç (`worker.js`, —Ñ—É–Ω–∫—Ü–∏—è `generateStrategyPrompt()`, —Ä–µ–¥ 4520-4638) —Å—ä–∑–¥–∞–≤–∞ **–ö–û–ú–ü–ê–ö–¢–ù–ê –≤–µ—Ä—Å–∏—è** –Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏ —è –∏–∑–ø—Ä–∞—â–∞ –∫—ä–º –°—Ç—ä–ø–∫–∞ 2:

```javascript
// worker.js, —Ä–µ–¥ 4524-4549
const analysisCompact = {
  bmr: analysis.bmr || '–Ω–µ –∏–∑—á–∏—Å–ª–µ–Ω',
  tdee: analysis.tdee || '–Ω–µ –∏–∑—á–∏—Å–ª–µ–Ω',
  recommendedCalories: analysis.recommendedCalories || '–Ω–µ –∏–∑—á–∏—Å–ª–µ–Ω',
  macroRatios: 'Protein: X%, Carbs: Y%, Fats: Z%',
  macroGrams: 'Protein: Xg, Carbs: Yg, Fats: Zg',
  metabolicProfile: (–ø—ä—Ä–≤–∏—Ç–µ 200 —Å–∏–º–≤–æ–ª–∞),
  healthRisks: (–ø—ä—Ä–≤–∏—Ç–µ 3 —Ä–∏—Å–∫–∞),
  nutritionalNeeds: (–ø—ä—Ä–≤–∏—Ç–µ 3 –Ω—É–∂–¥–∏),
  psychologicalProfile: (–ø—ä—Ä–≤–∏—Ç–µ 150 —Å–∏–º–≤–æ–ª–∞),
  successChance: analysis.successChance,
  keyProblems: (–ø—ä—Ä–≤–∏—Ç–µ 3 –ø—Ä–æ–±–ª–µ–º–∞)
};
```

**–ü—ä–ª–Ω–∏—è—Ç –æ–±–µ–∫—Ç `analysis` –ù–ï –°–ï –ò–ó–ü–†–ê–©–ê** - —Å–∞–º–æ –∏–∑–≤–ª–µ—á–µ–Ω–∞—Ç–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∞ –≤–µ—Ä—Å–∏—è —Å–µ –¥–æ–±–∞–≤—è –∫—ä–º –ø—Ä–æ–º–ø—Ç–∞.

#### –ü—Ä–∏–º–µ—Ä –æ—Ç —Ç–µ–∫—É—â–∏—è –∫–æ–¥:
```javascript
// worker.js, —Ä–µ–¥ 4651-4660
–ê–ù–ê–õ–ò–ó (–ö–û–ú–ü–ê–ö–¢–ï–ù):
- BMR/TDEE/–ö–∞–ª–æ—Ä–∏–∏: ${analysisCompact.bmr} / ${analysisCompact.tdee} / ${analysisCompact.recommendedCalories}
- –ú–∞–∫—Ä–æ —Å—ä–æ—Ç–Ω–æ—à–µ–Ω–∏—è: ${analysisCompact.macroRatios}
- –ú–∞–∫—Ä–æ –≥—Ä–∞–º–æ–≤–µ –¥–Ω–µ–≤–Ω–æ: ${analysisCompact.macroGrams}
- –ú–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª: ${analysisCompact.metabolicProfile}
- –ó–¥—Ä–∞–≤–Ω–∏ —Ä–∏—Å–∫–æ–≤–µ: ${analysisCompact.healthRisks}
- –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –Ω—É–∂–¥–∏: ${analysisCompact.nutritionalNeeds}
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ñ–∏–ª: ${analysisCompact.psychologicalProfile}
- –®–∞–Ω—Å –∑–∞ —É—Å–ø–µ—Ö: ${analysisCompact.successChance}
- –ö–ª—é—á–æ–≤–∏ –ø—Ä–æ–±–ª–µ–º–∏: ${analysisCompact.keyProblems}
```

---

### –°—Ç—ä–ø–∫–∞ 2 ‚Üí –°—Ç—ä–ø–∫–∞ 3: –û—Ç –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ä–º –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ü–ª–∞–Ω

#### –ö–∞–∫–≤–æ –ò–ó–ü–†–ê–©–ê –±–µ–∫–µ–Ω–¥—ä—Ç –æ—Ç –°—Ç—ä–ø–∫–∞ 2 –∫—ä–º –°—Ç—ä–ø–∫–∞ 3?

–ë–µ–∫–µ–Ω–¥—ä—Ç (`worker.js`, —Ñ—É–Ω–∫—Ü–∏—è `generateMealPlanChunkPrompt()`, —Ä–µ–¥ 1511-1779) —Å—ä–∑–¥–∞–≤–∞ **–ö–û–ú–ü–ê–ö–¢–ù–ê –≤–µ—Ä—Å–∏—è** –Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞:

```javascript
// worker.js, —Ä–µ–¥ 1541-1551
const strategyCompact = {
  dietType: strategy.dietType || '–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–∞',
  weeklyMealPattern: strategy.weeklyMealPattern || '–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞',
  mealTiming: strategy.mealTiming?.pattern || '3 —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–æ',
  keyPrinciples: (–≤—Å–∏—á–∫–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏, –æ–±–µ–¥–∏–Ω–µ–Ω–∏ —Å ;),
  foodsToInclude: (–≤—Å–∏—á–∫–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏ —Ö—Ä–∞–Ω–∏, –æ–±–µ–¥–∏–Ω–µ–Ω–∏ —Å ,),
  foodsToAvoid: (–≤—Å–∏—á–∫–∏ –Ω–µ–∂–µ–ª–∞–Ω–∏ —Ö—Ä–∞–Ω–∏, –æ–±–µ–¥–∏–Ω–µ–Ω–∏ —Å ,),
  calorieDistribution: strategy.calorieDistribution,
  macroDistribution: strategy.macroDistribution,
  weeklyScheme: strategy.weeklyScheme
};
```

**–°–™–©–û –°–ï –ò–ó–ü–†–ê–©–ê–¢** –¥–∞–Ω–Ω–∏ –æ—Ç –°—Ç—ä–ø–∫–∞ 1 (–∞–Ω–∞–ª–∏–∑):
```javascript
// worker.js, —Ä–µ–¥ 1555-1563
const analysisCompact = {
  macroRatios: 'Protein: X%, Carbs: Y%, Fats: Z%',
  macroGrams: 'Protein: Xg, Carbs: Yg, Fats: Zg',
  fiber: 'Xg'
};
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç —Ç–µ–∫—É—â–∏—è –∫–æ–¥:
```javascript
// worker.js, —Ä–µ–¥ 1606-1619
=== –î–ê–ù–ù–ò –û–¢ –°–¢–™–ü–ö–ê 1 (–ê–ù–ê–õ–ò–ó) ===
–ú–∞–∫—Ä–æ —Å—ä–æ—Ç–Ω–æ—à–µ–Ω–∏—è: ${analysisCompact.macroRatios}
–î–Ω–µ–≤–Ω–∏ –º–∞–∫—Ä–æ –≥—Ä–∞–º–æ–≤–µ: ${analysisCompact.macroGrams}
–î–Ω–µ–≤–Ω–∏ —Ñ–∏–±—Ä–∏: ${analysisCompact.fiber}

=== –î–ê–ù–ù–ò –û–¢ –°–¢–™–ü–ö–ê 2 (–°–¢–†–ê–¢–ï–ì–ò–Ø) ===
–î–∏–µ—Ç–∞: ${strategyCompact.dietType} | –•—Ä–∞–Ω–µ–Ω–∏—è: ${strategyCompact.mealTiming}
–ü—Ä–∏–Ω—Ü–∏–ø–∏: ${strategyCompact.keyPrinciples}
–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏ —Ö—Ä–∞–Ω–∏ (–æ—Ç —Å—Ç—ä–ø–∫–∞ 2): ${strategyCompact.foodsToInclude}
–ù–µ–∂–µ–ª–∞–Ω–∏ —Ö—Ä–∞–Ω–∏ (–æ—Ç —Å—Ç—ä–ø–∫–∞ 2): ${strategyCompact.foodsToAvoid}
–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞–ª–æ—Ä–∏–∏ (—Å—Ç—ä–ø–∫–∞ 2): ${strategyCompact.calorieDistribution}
–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–∞–∫—Ä–æ—Å–∏ (—Å—Ç—ä–ø–∫–∞ 2): ${strategyCompact.macroDistribution}
```

---

### –°—Ç—ä–ø–∫–∞ 3 ‚Üí –°—Ç—ä–ø–∫–∞ 4: –û—Ç –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ü–ª–∞–Ω –∫—ä–º –û–±–æ–±—â–µ–Ω–∏–µ

#### –ö–∞–∫–≤–æ –ò–ó–ü–†–ê–©–ê –±–µ–∫–µ–Ω–¥—ä—Ç –æ—Ç –°—Ç—ä–ø–∫–∞ 3 –∫—ä–º –°—Ç—ä–ø–∫–∞ 4?

–ë–µ–∫–µ–Ω–¥—ä—Ç (`worker.js`, —Ñ—É–Ω–∫—Ü–∏—è `generateMealPlanSummaryPrompt()`, —Ä–µ–¥ 2009-2133) –ù–ï –ò–ó–ü–†–ê–©–ê —Ü—è–ª–∞—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∞ –∏–∑–≤–ª–∏—á–∞ —Å–∞–º–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Ç–æ:

```javascript
// worker.js, —Ä–µ–¥ 2040-2044
const psychologicalSupport = strategy.psychologicalSupport || ['–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ'];
const supplementRecommendations = strategy.supplementRecommendations || ['–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ'];
const hydrationStrategy = strategy.hydrationStrategy || '–ú–∏–Ω–∏–º—É–º 2-2.5–ª –≤–æ–¥–∞ –¥–Ω–µ–≤–Ω–æ';
const foodsToInclude = strategy.foodsToInclude || [];
const foodsToAvoid = strategy.foodsToAvoid || [];
```

**–ò–ó–ü–†–ê–©–ê–¢ –°–ï** —Å–∞–º–æ:
- `bmr` (–æ—Ç –°—Ç—ä–ø–∫–∞ 1)
- `recommendedCalories` (–æ—Ç –°—Ç—ä–ø–∫–∞ 1)
- `weekPlan` (—Ä–µ–∑—É–ª—Ç–∞—Ç—ä—Ç –æ—Ç –°—Ç—ä–ø–∫–∞ 3)
- –ò–∑–±—Ä–∞–Ω–∏ –ø–æ–ª–µ—Ç–∞ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ (–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ –ø–æ–¥–∫—Ä–µ–ø–∞, —Ö–∏–¥—Ä–∞—Ç–∞—Ü–∏—è, –¥–æ–±–∞–≤–∫–∏)
- –ó–¥—Ä–∞–≤–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ (–∫–ª—é—á–æ–≤–∏ –ø—Ä–æ–±–ª–µ–º–∏, –∞–ª–µ—Ä–≥–∏–∏, –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∏)

#### –ü—Ä–∏–º–µ—Ä –æ—Ç —Ç–µ–∫—É—â–∏—è –∫–æ–¥:
```javascript
// worker.js, —Ä–µ–¥ 2058-2064
–ö–õ–ò–ï–ù–¢: ${data.name}, –¶–µ–ª: ${data.goal}, BMR: ${bmr}
–¶–µ–ª–µ–≤–∏: ${recommendedCalories} kcal/–¥–µ–Ω | –†–µ–∞–ª–µ–Ω: ${avgCalories} kcal/–¥–µ–Ω
–ú–∞–∫—Ä–æ—Å–∏: Protein ${avgProtein}g, Carbs ${avgCarbs}g, Fats ${avgFats}g

–ó–î–†–ê–í–ù–ò –î–ê–ù–ù–ò: –ü—Ä–æ–±–ª–µ–º–∏: ${healthContext.keyProblems || '–Ω—è–º–∞'} 
| –ê–ª–µ—Ä–≥–∏–∏: ${healthContext.allergies} 
| –ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∏: ${healthContext.medications}
```

---

## üéØ –ö–∞–∫ –¥–∞ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞—Ç–µ –ö–∞–∫–≤–æ —Å–µ –ü—Ä–µ–Ω–∞—Å—è?

### ‚úÖ –ú–ï–¢–û–î 1: –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ –ü—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ (–ü–†–ï–ü–û–†–™–ß–ò–¢–ï–õ–ù–û)

–ú–æ–∂–µ—Ç–µ –¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞—Ç–µ –∫–æ–∏ –¥–∞–Ω–Ω–∏ —Å–µ –∏–∑–ø—Ä–∞—â–∞—Ç **–°–ê–ú–û —á—Ä–µ–∑ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ –≤ KV/prompts/**, –ë–ï–ó –¥–∞ –ø—Ä–æ–º–µ–Ω—è—Ç–µ `worker.js`.

#### –°—Ç—ä–ø–∫–∏:

1. **–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ —Å—ä–æ—Ç–≤–µ—Ç–Ω–∏—è –ø—Ä–æ–º–ø—Ç —Ñ–∞–π–ª:**
   - `KV/prompts/admin_strategy_prompt.txt` - –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –¥–∞–Ω–Ω–∏ –≤ –°—Ç—ä–ø–∫–∞ 2
   - `KV/prompts/admin_meal_plan_prompt.txt` - –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –¥–∞–Ω–Ω–∏ –≤ –°—Ç—ä–ø–∫–∞ 3
   - `KV/prompts/admin_summary_prompt.txt` - –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –¥–∞–Ω–Ω–∏ –≤ –°—Ç—ä–ø–∫–∞ 4

2. **–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ placeholders –æ—Ç `replacePromptVariables()`:**
   
   –°–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–º–µ–Ω—è —Å–ª–µ–¥–Ω–∏—Ç–µ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏:
   - `${userData}` - –¶—è–ª–æ—Å—Ç–Ω–∏ –¥–∞–Ω–Ω–∏ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (–æ–±–µ–∫—Ç)
   - `${analysisData}` - –ö–æ–º–ø–∞–∫—Ç–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ (–æ–±–µ–∫—Ç)
   - `${strategyData}` - –î–∞–Ω–Ω–∏ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ (–æ–±–µ–∫—Ç)
   - `${weekPlan}` - –°–µ–¥–º–∏—á–µ–Ω –ø–ª–∞–Ω (–æ–±–µ–∫—Ç)
   - –ò –≤—Å–∏—á–∫–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–Ω–∏ –ø–æ–ª–µ—Ç–∞ –∫–∞—Ç–æ `${name}`, `${age}`, `${bmr}`, –∏ —Ç.–Ω.

3. **–ö–∞—á–µ—Ç–µ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ –∫—ä–º KV storage:**
   ```bash
   cd /home/runner/work/aidiet/aidiet
   ./KV/upload-kv-keys.sh
   ```

#### –ü—Ä–∏–º–µ—Ä 1: –î–∞ –∏–∑–ø—Ä–∞—Ç–∏—Ç–µ –ü–û–í–ï–ß–ï –¥–∞–Ω–Ω–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ –∫—ä–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞

–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ `KV/prompts/admin_strategy_prompt.txt` –∏ –¥–æ–±–∞–≤–µ—Ç–µ:

```
–ê–ù–ê–õ–ò–ó (–†–ê–ó–®–ò–†–ï–ù):
- BMR: ${analysisData.bmr}
- TDEE: ${analysisData.tdee}
- –ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–∏ –∫–∞–ª–æ—Ä–∏–∏: ${analysisData.recommendedCalories}
- –ú–∞–∫—Ä–æ —Å—ä–æ—Ç–Ω–æ—à–µ–Ω–∏—è: ${analysisData.macroRatios}
- –ú–∞–∫—Ä–æ –≥—Ä–∞–º–æ–≤–µ: ${analysisData.macroGrams}
- –ü–™–õ–ï–ù –º–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª: ${analysisData.metabolicProfile}
- –í–°–ò–ß–ö–ò –∑–¥—Ä–∞–≤–Ω–∏ —Ä–∏—Å–∫–æ–≤–µ: ${analysisData.healthRisks}
- –í–°–ò–ß–ö–ò —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –Ω—É–∂–¥–∏: ${analysisData.nutritionalNeeds}
- –ü–™–õ–ï–ù –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ñ–∏–ª: ${analysisData.psychologicalProfile}
- –®–∞–Ω—Å –∑–∞ —É—Å–ø–µ—Ö: ${analysisData.successChance}
- –í–°–ò–ß–ö–ò –∫–ª—é—á–æ–≤–∏ –ø—Ä–æ–±–ª–µ–º–∏: ${analysisData.keyProblems}
```

**–û–ë–ê–ß–ï**: –¢–µ–∫—É—â–∏—è—Ç –∫–æ–¥ –≤ `worker.js` –≤–µ—á–µ —Å—ä–∑–¥–∞–≤–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∞ –≤–µ—Ä—Å–∏—è (`analysisCompact`), —Ç–∞–∫–∞ —á–µ `${analysisData}` —â–µ —Å—ä–¥—ä—Ä–∂–∞ —Å–∞–º–æ –∫–æ–º–ø–∞–∫—Ç–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏, –ù–ï –ø—ä–ª–Ω–∏—è –∞–Ω–∞–ª–∏–∑.

–ó–∞ –¥–∞ –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—ä–ø –¥–æ –ø—ä–ª–Ω–∏—è –∞–Ω–∞–ª–∏–∑, —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ `fullAnalysis` –∫—ä–º `replacePromptVariables()`.

#### –ü—Ä–∏–º–µ—Ä 2: –î–∞ –∏–∑–ø—Ä–∞—Ç–∏—Ç–µ –ü–û-–ú–ê–õ–ö–û –¥–∞–Ω–Ω–∏ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ –∫—ä–º –ø–ª–∞–Ω–∞

–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ `KV/prompts/admin_meal_plan_prompt.txt` –∏ –ø—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ –Ω–µ–Ω—É–∂–Ω–∏—Ç–µ —Ä–µ–¥–æ–≤–µ:

```
=== –î–ê–ù–ù–ò –û–¢ –°–¢–™–ü–ö–ê 2 (–°–¢–†–ê–¢–ï–ì–ò–Ø - –ú–ò–ù–ò–ú–ê–õ–ù–ò) ===
–î–∏–µ—Ç–∞: ${strategyData.dietType}
–•—Ä–∞–Ω–µ–Ω–∏—è: ${strategyData.mealTiming}
```

(–ü—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ `keyPrinciples`, `foodsToInclude`, `foodsToAvoid`, –∞–∫–æ –Ω–µ —Å–∞ –Ω—É–∂–Ω–∏)

#### –ü—Ä–∏–º–µ—Ä 3: –î–∞ –∏–∑–ø—Ä–∞—Ç–∏—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –ø–æ–ª–µ—Ç–∞

–í –ø—Ä–æ–º–ø—Ç–∞ –º–æ–∂–µ—Ç–µ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ —É—Å–ª–æ–≤–Ω–∞ –ª–æ–≥–∏–∫–∞ (–Ω–æ —Ç–æ–≤–∞ –Ω–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ template literals):

```
=== –í–ê–ñ–ù–ò –î–ê–ù–ù–ò ===
${strategyData.keyPrinciples ? '–ü—Ä–∏–Ω—Ü–∏–ø–∏: ' + strategyData.keyPrinciples : '–ù—è–º–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∏'}
```

---

### ‚ö†Ô∏è –ú–ï–¢–û–î 2: –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ worker.js (–ü–†–ò –ù–£–ñ–î–ê)

–ê–∫–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ **–°–¢–†–£–ö–¢–£–†–ê–¢–ê** –Ω–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∏—Ç–µ –æ–±–µ–∫—Ç–∏ –∏–ª–∏ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –Ω–æ–≤–∏ –ø–æ–ª–µ—Ç–∞, —Ç—Ä—è–±–≤–∞ –¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç–µ `worker.js`.

#### –°—Ç—ä–ø–∫–∏ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ worker.js:

1. **–ù–∞–º–µ—Ä–µ—Ç–µ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞, –∫–æ—è—Ç–æ —Å—ä–∑–¥–∞–≤–∞ –ø—Ä–æ–º–ø—Ç–∞** –∑–∞ —Å—Ç—ä–ø–∫–∞—Ç–∞, –∫–æ—è—Ç–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ:
   - –°—Ç—ä–ø–∫–∞ 1‚Üí2: `generateStrategyPrompt()` (—Ä–µ–¥ 4520)
   - –°—Ç—ä–ø–∫–∞ 2‚Üí3: `generateMealPlanChunkPrompt()` (—Ä–µ–¥ 1511)
   - –°—Ç—ä–ø–∫–∞ 3‚Üí4: `generateMealPlanSummaryPrompt()` (—Ä–µ–¥ 2009)

2. **–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ –æ–±–µ–∫—Ç–∞ `analysisCompact` –∏–ª–∏ `strategyCompact`:**

   –ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ `temperament` –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ –∫—ä–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞:
   
   ```javascript
   // worker.js, —Ä–µ–¥ 4524 (–≤ generateStrategyPrompt)
   const analysisCompact = {
     bmr: analysis.bmr || '–Ω–µ –∏–∑—á–∏—Å–ª–µ–Ω',
     tdee: analysis.tdee || '–Ω–µ –∏–∑—á–∏—Å–ª–µ–Ω',
     recommendedCalories: analysis.recommendedCalories || '–Ω–µ –∏–∑—á–∏—Å–ª–µ–Ω',
     // ... –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –ø–æ–ª–µ—Ç–∞ ...
     
     // –ù–û–í–ê –î–û–ë–ê–í–ö–ê:
     temperament: analysis.psychoProfile?.temperament || '–Ω–µ –µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'
   };
   ```

3. **–î–æ–±–∞–≤–µ—Ç–µ –Ω–æ–≤–æ—Ç–æ –ø–æ–ª–µ –∫—ä–º –ø—Ä–æ–º–ø—Ç–∞:**
   
   ```javascript
   // worker.js, —Ä–µ–¥ 4651 (–≤ defaultPrompt)
   –ê–ù–ê–õ–ò–ó (–ö–û–ú–ü–ê–ö–¢–ï–ù):
   - BMR/TDEE/–ö–∞–ª–æ—Ä–∏–∏: ${analysisCompact.bmr} / ${analysisCompact.tdee} / ${analysisCompact.recommendedCalories}
   - –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç: ${analysisCompact.temperament}
   // ... –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ —Ä–µ–¥–æ–≤–µ ...
   ```

4. **–î–æ–±–∞–≤–µ—Ç–µ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞—Ç–∞ –∫—ä–º `replacePromptVariables()` –∑–∞ custom –ø—Ä–æ–º–ø—Ç–æ–≤–µ:**
   
   ```javascript
   // worker.js, —Ä–µ–¥ 4554 (—Å–ª–µ–¥ –¥—Ä—É–≥–∏—Ç–µ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏)
   let prompt = replacePromptVariables(customPrompt, {
     userData: data,
     analysisData: analysisCompact,
     // ... –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ ...
     
     // –ù–û–í–ê –î–û–ë–ê–í–ö–ê:
     temperament: analysisCompact.temperament
   });
   ```

#### –ü—Ä–∏–º–µ—Ä: –î–∞ –∏–∑–ø—Ä–∞—Ç–∏—Ç–µ –ü–™–õ–ù–ò–Ø –∞–Ω–∞–ª–∏–∑ –≤–º–µ—Å—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω–∞ –≤–µ—Ä—Å–∏—è

–ê–∫–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑–ø—Ä–∞—Ç–∏—Ç–µ —Ü–µ–ª–∏—è –æ–±–µ–∫—Ç `analysis` –∫—ä–º –°—Ç—ä–ø–∫–∞ 2, –≤–º–µ—Å—Ç–æ `analysisCompact`:

```javascript
// worker.js, —Ä–µ–¥ 4554 (–≤ generateStrategyPrompt)
let prompt = replacePromptVariables(customPrompt, {
  userData: data,
  analysisData: analysisCompact, // –¢–µ–∫—É—â–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∞ –≤–µ—Ä—Å–∏—è
  fullAnalysis: analysis,         // –ù–û–í–ê –î–û–ë–ê–í–ö–ê: –ü—ä–ª–Ω–∏—è—Ç –∞–Ω–∞–ª–∏–∑
  // ... –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ ...
});
```

–¢–æ–≥–∞–≤–∞ –≤ custom –ø—Ä–æ–º–ø—Ç–∞ (`admin_strategy_prompt.txt`) –º–æ–∂–µ—Ç–µ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—Ç–µ:

```
–ü–™–õ–ï–ù –ê–ù–ê–õ–ò–ó:
${JSON.stringify(fullAnalysis, null, 2)}
```

**–í–ù–ò–ú–ê–ù–ò–ï**: –¢–æ–≤–∞ —â–µ —É–≤–µ–ª–∏—á–∏ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –ø—Ä–æ–º–ø—Ç–∞ –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ! –°–∏—Å—Ç–µ–º–∞—Ç–∞ –∏–∑–ø–æ–ª–∑–≤–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∏ –≤–µ—Ä—Å–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–Ω–æ –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Ç–æ–∫–µ–Ω–∏.

---

## üìä –¢–µ–∫—É—â–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –≤–µ—á–µ –µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞ **–∫–æ–º–ø–∞–∫—Ç–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∏**:

- **–°—Ç—ä–ø–∫–∞ 1‚Üí2**: –ê–Ω–∞–ª–∏–∑—ä—Ç —Å–µ –∫–æ–º–ø—Ä–µ—Å–∏—Ä–∞ –æ—Ç ~524 —Ç–æ–∫–µ–Ω–∞ –¥–æ ~327 —Ç–æ–∫–µ–Ω–∞ (37.6% –Ω–∞–º–∞–ª–µ–Ω–∏–µ)
- **–°—Ç—ä–ø–∫–∞ 2‚Üí3**: –°—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ —Å–µ –∫–æ–º–ø—Ä–µ—Å–∏—Ä–∞ –æ—Ç ~695 —Ç–æ–∫–µ–Ω–∞ –¥–æ ~167 —Ç–æ–∫–µ–Ω–∞ (76% –Ω–∞–º–∞–ª–µ–Ω–∏–µ)
- **–û–±—â–æ**: –ù–∞–º–∞–ª–µ–Ω–∏–µ –Ω–∞ –≤—Ö–æ–¥–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω–∏ —Å 59.1% (4799‚Üí1962 —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ)

**–ò–∑—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–µ–Ω—Ç–∞—Ä –≤ `worker.js`, —Ä–µ–¥ 12-16

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û—Ç–≥–æ–≤–æ—Ä –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ:

1. **–ö–∞–∫–≤–æ –∏–∑–ø—Ä–∞—â–∞ –±–µ–∫–µ–Ω–¥—ä—Ç –æ—Ç —Å—Ç—ä–ø–∫–∞ 1 –∫—ä–º —Å—Ç—ä–ø–∫–∞ 2?**
   - –ö–æ–º–ø–∞–∫—Ç–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ (`analysisCompact`) —Å –æ—Å–Ω–æ–≤–Ω–∏ —á–∏—Å–ª–∞ –∏ —Å—ä–∫—Ä–∞—Ç–µ–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤–∏ –ø–æ–ª–µ—Ç–∞

2. **–û—Ç —Å—Ç—ä–ø–∫–∞ 2 –∫—ä–º —Å—Ç—ä–ø–∫–∞ 3?**
   - –ö–æ–º–ø–∞–∫—Ç–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ (`strategyCompact`) + –º–∏–Ω–∏–º–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ (–º–∞–∫—Ä–æ—Å–∏, —Ñ–∏–±—Ä–∏)

3. **–û—Ç —Å—Ç—ä–ø–∫–∞ 3 –∫—ä–º —Å—Ç—ä–ø–∫–∞ 4?**
   - –°–µ–¥–º–∏—á–µ–Ω –ø–ª–∞–Ω (`weekPlan`) + –∏–∑–±—Ä–∞–Ω–∏ –ø–æ–ª–µ—Ç–∞ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ (–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è, —Ö–∏–¥—Ä–∞—Ç–∞—Ü–∏—è) + –∑–¥—Ä–∞–≤–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç –∞–Ω–∞–ª–∏–∑–∞

4. **–ö–∞–∫ –¥–∞ –∏–∑–±–µ—Ä–µ—Ç–µ –∫–∞–∫–≤–∞ —á–∞—Å—Ç –æ—Ç –¥–∞–Ω–Ω–∏—Ç–µ –¥–∞ –∏–∑–ø—Ä–∞—â–∞—Ç–µ?**
   - **–ü–†–ï–ü–û–†–™–ß–ò–¢–ï–õ–ù–û**: –ß—Ä–µ–∑ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ –≤ `KV/prompts/` –∏ –∫–∞—á–≤–∞–Ω–µ –∫—ä–º KV storage
   - **–ü—Ä–∏ –Ω—É–∂–¥–∞**: –ß—Ä–µ–∑ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ `analysisCompact`/`strategyCompact` –æ–±–µ–∫—Ç–∏—Ç–µ –≤ `worker.js`

5. **–¢—Ä—è–±–≤–∞ –ª–∏ –¥–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è worker.js –∏–ª–∏ —Å–∞–º–æ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ?**
   - **–°–ê–ú–û –ü–†–û–ú–ü–¢–û–í–ï–¢–ï**: –ê–∫–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –ø–æ–∫–∞–∑–≤–∞—Ç–µ/—Å–∫—Ä–∏–µ—Ç–µ –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –¥–∞–Ω–Ω–∏
   - **WORKER.JS**: –ê–∫–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –Ω–æ–≤–∏ –ø–æ–ª–µ—Ç–∞ –∏–ª–∏ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–∏—Ç–µ –æ–±–µ–∫—Ç–∏

---

## üìù –ü—Ä–∏–º–µ—Ä–µ–Ω –°—Ü–µ–Ω–∞—Ä–∏–π

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ò—Å–∫–∞—Ç–µ –¥–∞ –∏–∑–ø—Ä–∞—Ç–∏—Ç–µ —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç–∞ –æ—Ç –°—Ç—ä–ø–∫–∞ 1 –∫—ä–º –°—Ç—ä–ø–∫–∞ 2

#### –†–µ—à–µ–Ω–∏–µ 1: –°–ê–ú–û –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ (–∞–∫–æ —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç–∞ –≤–µ—á–µ –µ –≤ analysisCompact)

1. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ `analysisCompact` —Å—ä–¥—ä—Ä–∂–∞ —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç–∞ –≤ `worker.js` (—Ä–µ–¥ 4524-4549)
2. –ê–∫–æ –ù–ï, –ø—Ä–µ–º–∏–Ω–µ—Ç–µ –∫—ä–º –†–µ—à–µ–Ω–∏–µ 2
3. –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ `KV/prompts/admin_strategy_prompt.txt`:
   ```
   –ê–ù–ê–õ–ò–ó:
   - –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç: ${analysisData.temperament}
   ```
4. –ö–∞—á–µ—Ç–µ –ø—Ä–æ–º–ø—Ç–∞: `./KV/upload-kv-keys.sh`

#### –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ worker.js (–∞–∫–æ —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç–∞ –ù–ï –µ –≤ analysisCompact)

1. –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ `worker.js`, —Ä–µ–¥ 4524-4549:
   ```javascript
   const analysisCompact = {
     // ... –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –ø–æ–ª–µ—Ç–∞ ...
     temperament: analysis.psychoProfile?.temperament || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'
   };
   ```

2. –î–æ–±–∞–≤–µ—Ç–µ –∫—ä–º default –ø—Ä–æ–º–ø—Ç–∞ (—Ä–µ–¥ 4651):
   ```javascript
   - –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç: ${analysisCompact.temperament}
   ```

3. –î–æ–±–∞–≤–µ—Ç–µ –∫—ä–º `replacePromptVariables()` (—Ä–µ–¥ 4554):
   ```javascript
   temperament: analysisCompact.temperament
   ```

4. –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ `KV/prompts/admin_strategy_prompt.txt` –∏ –¥–æ–±–∞–≤–µ—Ç–µ:
   ```
   - –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç: ${temperament}
   ```

5. –ö–∞—á–µ—Ç–µ –ø—Ä–æ–º–ø—Ç–∞: `./KV/upload-kv-keys.sh`

---

–ù–∞–¥—è–≤–∞–º —Å–µ —Ç–æ–≤–∞ –æ–±—è—Å–Ω—è–≤–∞ —è—Å–Ω–æ –∫–∞–∫ —Ä–∞–±–æ—Ç–∏ –ø–æ—Ç–æ–∫—ä—Ç –æ—Ç –¥–∞–Ω–Ω–∏ –∏ –∫–∞–∫ –¥–∞ –≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞—Ç–µ! üöÄ

# Clients Folder

Тази папка е информативна - действителните данни от клиенти се съхраняват автоматично в Cloudflare KV хранилище.

## Как работи автоматичното съхранение

1. **Попълване на въпросника**: Клиентът попълва questionnaire2.html
2. **Автоматично изпращане**: След завършване данните се изпращат автоматично към backend API
3. **Съхранение в KV**: Данните се записват в Cloudflare KV хранилище с ключ `client:{clientId}`
4. **Backup**: Данните се запазват и локално в браузъра (localStorage) като резервно копие

## Достъп до данните

Данните са достъпни чрез:
- **Админ панел (препоръчително)**: admin.html > Клиентски Въпросници
  - Преглед на списък с всички клиенти
  - Търсене и филтриране по име, имейл, цел
  - Преглед на пълни детайли за всеки клиент
  - Изтегляне на данни като JSON файл
- **KV ключове**: `client:{clientId}` (напр. `client:client_1771087769249_p4o9ji`)
- **KV списък**: `clients_list` съдържа списък с всички clientId (последните 500)
- **Cloudflare Dashboard**: KV хранилище `page_content` > Browse

## Работа с админ панела

### Зареждане на клиенти
1. Отворете admin.html
2. Влезте с админ парола
3. Скролнете до секцията "Клиентски Въпросници"
4. Натиснете "Зареди Клиенти"

### Търсене на клиент
- Използвайте полето за търсене за филтриране по име, имейл или цел
- Търсенето е в реално време и работи локално (без нови заявки към сървъра)

### Преглед на детайли
- Натиснете "Преглед" за да видите пълните отговори от въпросника
- Модалният прозорец показва всички полета и прикачени файлове

### Изтегляне на данни
- Натиснете "Изтегли JSON" за да свалите данните като файл
- Файлът съдържа пълната структура с отговори и метаданни
- Формат: `client_{name}_{id}.json`

## Структура на данните

Всеки клиентски файл в KV съдържа:
- **id**: Уникален идентификатор на клиента (формат: `client_{timestamp}_{random}`)
- **timestamp**: Дата и час на подаване (ISO 8601 формат)
- **answers**: Отговорите от въпросника (всички 31+ полета)
- **files**: Прикачени файлове (ако има такива) в base64 формат
- **submittedAt**: Дата и час на получаване от сървъра

## Пример на KV ключ

```
client:client_1771087769249_p4o9ji
```

## API Endpoints

### GET /api/admin/get-clients-list
Връща списък с всички клиенти (първите 100) с основна информация:
```json
{
  "success": true,
  "clients": [...],
  "total": 150,
  "showing": 100,
  "failedCount": 0
}
```

### GET /api/admin/get-client-data?clientId={id}
Връща пълните данни за конкретен клиент:
```json
{
  "success": true,
  "client": { ... }
}
```

## Производителност и Оптимизация

- **Минимални заявки**: Списъкът се зарежда веднъж, детайлите - само при нужда
- **Паралелно изпълнение**: Използва се `Promise.all()` за бързо зареждане
- **Локално филтриране**: Търсенето работи в браузъра без допълнителни заявки
- **Лимит от 100**: За бърза първоначална визуализация
- **Проследяване на грешки**: `failedCount` показва проблеми при зареждане

## Бележки

- Данните се съхраняват автоматично - **не се изисква ръчна намеса**
- Backup копие остава в localStorage на браузъра на клиента
- KV хранилището поддържа последните 500 клиента
- Вижте EXAMPLE_client_data.json за примерна структура на данните
- Всички endpoints са достъпни само за администратори

<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ NutriPlan –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞.">
    <meta name="theme-color" content="#10b981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NutriPlan">
    <link rel="canonical" href="https://biocode.website/admin.html">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512x512.png">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icon-192x192.png">
    <title>–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª - NutriPlan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-red: #10b981;
            --primary-dark: #059669;
            --soft-red: #d1fae5;
            --accent-yellow: #fbbf24;
            --accent-blue: #3b82f6;
            --accent-light-red: #f87171;
            --bg-color: #fefce8;
            --text-dark: #1e3a20;
            --text-gray: #4b5563;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(16,185,129,0.15);
            --radius: 16px;
            /* Safe area insets for mobile devices with notches/dynamic island */
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-inset-left: env(safe-area-inset-left, 0px);
            --safe-area-inset-right: env(safe-area-inset-right, 0px);
        }

        /* Dark theme */
        [data-theme="dark"] {
            --primary-red: #34d399;
            --primary-dark: #10b981;
            --soft-red: #064e3b;
            --accent-yellow: #fcd34d;
            --accent-blue: #60a5fa;
            --accent-light-red: #fca5a5;
            --bg-color: #0f1419;
            --text-dark: #e5f3e8;
            --text-gray: #9ca3af;
            --white: #1a2028;
            --shadow: 0 10px 30px rgba(52,211,153,0.3);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-dark);
            min-height: 100vh;
            padding: calc(20px + var(--safe-area-inset-top)) calc(20px + var(--safe-area-inset-right)) calc(20px + var(--safe-area-inset-bottom)) calc(20px + var(--safe-area-inset-left));
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: var(--white);
            padding: 20px 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        h1 {
            font-size: 1.8rem;
            color: var(--text-dark);
        }

        .logout-btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 10px 20px;

        .theme-toggle {
            background: var(--bg-color);
            border: 2px solid var(--text-gray);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .theme-toggle:hover {
            border-color: var(--primary-red);
            transform: scale(1.05);
        }
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }

        .logout-btn:hover {
            background: var(--primary-dark);
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text-dark);
            border-bottom: 2px solid var(--soft-red);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        select, input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: 0.3s;
            font-family: inherit;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-red);
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .info-box {
            background: #e8f8f5;
            border-left: 4px solid #27ae60;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .info-box-warning {
            background: #ffe6e6;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .login-card h1 {
            margin-bottom: 30px;
            color: var(--primary-red);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--primary-red);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .card {
                padding: 20px;
            }
        }

        /* Report Item Styles */
        .report-item {
            background: var(--bg-color);
            border: 1px solid var(--text-gray);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .report-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .report-user {
            font-weight: 600;
            color: var(--primary-red);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-time {
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .report-message {
            background: var(--white);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .report-meta {
            font-size: 0.8rem;
            color: var(--text-gray);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .report-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-unread {
            background: #ff9800;
            color: white;
        }

        .badge-read {
            background: #4CAF50;
            color: white;
        }

        /* PWA Install Banner */
        .install-banner {
            position: fixed;
            bottom: calc(20px + var(--safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            color: var(--text-dark);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(0, 0, 0, 0.08);
            display: none;
            align-items: center;
            gap: 16px;
            z-index: 1001;
            max-width: 90%;
            animation: slideUpBanner 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .install-banner.show {
            display: flex;
        }

        @keyframes slideUpBanner {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .install-banner-icon {
            font-size: 2.5rem;
            color: var(--primary-red);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05));
            border-radius: 12px;
        }

        .install-banner-content {
            flex: 1;
            min-width: 0;
        }

        .install-banner-title {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 1rem;
            line-height: 1.3;
            color: var(--text-dark);
        }

        .install-banner-text {
            font-size: 0.875rem;
            color: var(--text-gray);
            line-height: 1.4;
        }

        .install-banner-browser {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            color: var(--primary-red);
            font-weight: 600;
            margin-top: 4px;
            padding: 4px 8px;
            background: rgba(220, 38, 38, 0.08);
            border-radius: 6px;
        }

        .install-banner-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .install-banner-btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .install-banner-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
        }

        .install-banner-btn:active {
            transform: translateY(0);
        }

        .install-banner-btn.dismiss {
            background: transparent;
            color: var(--text-gray);
            padding: 12px 16px;
        }

        .install-banner-btn.dismiss:hover {
            background: var(--soft-red);
            color: var(--text-dark);
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .install-banner {
                flex-direction: column;
                padding: 20px 16px;
                bottom: 12px;
                max-width: calc(100% - 24px);
                gap: 16px;
            }

            .install-banner-icon {
                width: 56px;
                height: 56px;
                font-size: 2.75rem;
            }

            .install-banner-content {
                text-align: center;
                width: 100%;
            }

            .install-banner-title {
                font-size: 1.05rem;
                margin-bottom: 8px;
            }

            .install-banner-text {
                font-size: 0.875rem;
                line-height: 1.5;
            }

            .install-banner-browser {
                display: inline-flex;
                margin-top: 8px;
            }

            .install-banner-actions {
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .install-banner-btn {
                width: 100%;
                justify-content: center;
                padding: 14px 24px;
                font-size: 0.95rem;
            }

            .install-banner-btn.dismiss {
                padding: 12px 24px;
            }
        }

        .ios-prompt {
            position: fixed;
            bottom: calc(20px + var(--safe-area-inset-bottom));
            width: 90%;
            left: 5%;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            padding: 15px;
            font-family: 'Poppins', sans-serif;
            animation: slideUpIOS 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUpIOS {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes highlightField {
            0% {
                background-color: #fff3cd;
                border-color: #ffc107;
            }
            100% {
                background-color: #ffffff;
                border-color: #ddd;
            }
        }

        .field-updated {
            animation: highlightField 2s ease-out;
        }

        .ios-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-gray);
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .ios-close:hover {
            color: var(--text-dark);
            transform: scale(1.1);
        }

        .ios-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .ios-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .ios-title-group h4 {
            margin: 0;
            color: var(--text-dark);
            font-size: 1rem;
            font-weight: 700;
        }

        .ios-title-group p {
            margin: 5px 0 0;
            font-size: 13px;
            color: var(--text-gray);
            line-height: 1.4;
        }

        .ios-instructions {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            font-size: 14px;
            text-align: center;
            color: var(--text-dark);
        }

        .ios-instructions p {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
        }

        .ios-share-icon {
            width: 20px;
            height: 20px;
            vertical-align: middle;
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
            background: var(--white);
            padding: 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: var(--bg-color);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-dark);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: var(--soft-red);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: var(--primary-red);
            color: white;
            border-color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); /* Matches primary green theme color */
        }

        .tab-btn i {
            font-size: 1.2rem;
        }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive tabs for mobile */
        @media (max-width: 768px) {
            .tab-navigation {
                flex-direction: column;
                gap: 8px;
            }

            .tab-btn {
                min-width: 100%;
                padding: 12px 15px;
            }
        }

    </style>
</head>
<body>
    <!-- PWA Install Banner -->
    <div class="install-banner" id="installBanner">
        <div class="install-banner-icon" id="installBannerIcon">
            <i class="fas fa-mobile-alt"></i>
        </div>
        <div class="install-banner-content">
            <div class="install-banner-title" id="installBannerTitle">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π NutriPlan</div>
            <div class="install-banner-text" id="installBannerText">–î–æ–±–∞–≤–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∫—ä–º –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω</div>
            <div class="install-banner-browser" id="installBannerBrowser" style="display: none;">
                <i class="fas fa-info-circle"></i>
                <span id="installBannerBrowserText"></span>
            </div>
        </div>
        <div class="install-banner-actions">
            <button class="install-banner-btn" id="installBtn">
                <i class="fas fa-download"></i>
                <span>–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π</span>
            </button>
            <button class="install-banner-btn dismiss" id="dismissInstallBtn">
                <i class="fas fa-times"></i>
                <span>–ü–æ-–∫—ä—Å–Ω–æ</span>
            </button>
        </div>
    </div>

    <!-- iOS Install Banner -->
    <div id="ios-banner" class="ios-prompt" style="display:none;">
        <button onclick="dismissIosBanner()" class="ios-close">‚úï</button>
        <div class="ios-header">
            <img src="./icon-192x192.png" class="ios-icon" alt="NutriPlan Icon">
            <div class="ios-title-group">
                <h4>–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π NutriPlan</h4>
                <p>–î–æ–±–∞–≤–∏ –Ω–∞ –µ–∫—Ä–∞–Ω–∞ –∑–∞ –±—ä—Ä–∑ –¥–æ—Å—Ç—ä–ø –∏ –∏–∑–≤–µ—Å—Ç–∏—è</p>
            </div>
        </div>
        <div class="ios-instructions">
            <p>–ù–∞—Ç–∏—Å–Ω–∏ –±—É—Ç–æ–Ω–∞ <img id="ios-share-icon-img" class="ios-share-icon" alt="Share"> –∏ –∏–∑–±–µ—Ä–∏ <strong>"Add to Home Screen" (–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω)</strong></p>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h1><i class="fas fa-shield-alt"></i> –ê–¥–º–∏–Ω –í—Ö–æ–¥</h1>
            <div class="form-group">
                <input type="password" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª–∞" onkeypress="if(event.key==='Enter') login()">
            </div>
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> –í—Ö–æ–¥
            </button>
            <div id="loginError" class="error-message" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <div class="container">
            <header>
                <h1><i class="fas fa-cog"></i> –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª</h1>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="theme-toggle" onclick="toggleTheme()" title="–°–º–µ–Ω–∏ —Ç–µ–º–∞">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> –ò–∑—Ö–æ–¥
                    </button>
                </div>
            </header>

            <!-- Stats Section -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalUsers">-</h3>
                    <p>–û–±—â–æ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalPlans">-</h3>
                    <p>–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏ –ü–ª–∞–Ω–æ–≤–µ</p>
                </div>
                <div class="stat-card">
                    <h3 id="currentModel">-</h3>
                    <p>–ê–∫—Ç–∏–≤–µ–Ω AI –ú–æ–¥–µ–ª</p>
                </div>
            </div>

            <div id="successMessage" class="success-message"></div>
            <div id="errorMessage" class="error-message"></div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('configuration', event)">
                    <i class="fas fa-cog"></i> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
                </button>
                <button class="tab-btn" onclick="switchTab('ai-prompts', event)">
                    <i class="fas fa-robot"></i> AI –ü—Ä–æ–º–ø—Ç–∏
                </button>
                <button class="tab-btn" onclick="switchTab('monitoring', event)">
                    <i class="fas fa-chart-line"></i> –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                </button>
                <button class="tab-btn" onclick="switchTab('features', event)">
                    <i class="fas fa-sliders-h"></i> –§—É–Ω–∫—Ü–∏–∏
                </button>
            </div>

            <!-- Configuration Tab -->
            <div id="tab-configuration" class="tab-content active">
            <!-- AI Model Selection -->
            <div class="card">
                <h2><i class="fas fa-robot"></i> AI –ú–æ–¥–µ–ª</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ò–∑–±–µ—Ä–µ—Ç–µ AI –ø—Ä–æ–≤–∞–π–¥—ä—Ä –∏ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω –º–æ–¥–µ–ª –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–æ–≤–µ –∏ —á–∞—Ç.
                </div>
                <div class="form-group">
                    <label for="aiProvider">–ò–∑–±–µ—Ä–∏ AI –ü—Ä–æ–≤–∞–π–¥—ä—Ä:</label>
                    <select id="aiProvider">
                        <option value="openai">OpenAI</option>
                        <option value="google">Google</option>
                        <option value="mock">Mock (–ó–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ –±–µ–∑ API)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="aiModelName">–ò–º–µ –Ω–∞ –º–æ–¥–µ–ª:</label>
                    <input type="text" id="aiModelName" placeholder="–Ω–∞–ø—Ä. gpt-4o, gemini-2.0-flash-exp">
                    <small style="display: block; margin-top: 5px; color: var(--text-gray);">
                        OpenAI –ø—Ä–∏–º–µ—Ä–∏: gpt-4o, gpt-4o-mini, gpt-4-turbo<br>
                        Google –ø—Ä–∏–º–µ—Ä–∏: gemini-pro, gemini-2.0-flash-exp, gemini-1.5-pro
                    </small>
                </div>
                <button class="btn" onclick="saveAIModel()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ú–æ–¥–µ–ª
                </button>
            </div>

            <!-- Color Scheme Configuration -->
            <div class="card">
                <h2><i class="fas fa-palette"></i> –¶–≤–µ—Ç–æ–≤–∞ –°—Ö–µ–º–∞</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ò–∑–±–µ—Ä–µ—Ç–µ —Ü–≤–µ—Ç–æ–≤–∞ —Å—Ö–µ–º–∞ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —â–µ —Å–µ –ø—Ä–∏–ª–æ–∂–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞ –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏.
                </div>
                <div class="form-group">
                    <label for="colorScheme">–ò–∑–±–µ—Ä–∏ –¶–≤–µ—Ç–æ–≤–∞ –ü–∞–ª–∏—Ç—Ä–∞:</label>
                    <select id="colorScheme" onchange="previewColorScheme()">
                        <option value="purple-pink">–ó–µ–ª–µ–Ω–æ-–ñ—ä–ª—Ç–∞ (–ú–æ–¥–µ—Ä–Ω–∞ Premium)</option>
                        <option value="green-blue">–ó–µ–ª–µ–Ω–æ-–°–∏–Ω—è (–ó–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–∞)</option>
                        <option value="blue-indigo">–°–∏–Ω—å–æ-–ò–Ω–¥–∏–≥–æ (–ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–∞)</option>
                        <option value="orange-red">–û—Ä–∞–Ω–∂–µ–≤–æ-–ß–µ—Ä–≤–µ–Ω–∞ (–ï–Ω–µ—Ä–≥–∏—á–Ω–∞)</option>
                        <option value="custom">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∞ (–ò–∑–±–µ—Ä–∏ —Å–≤–æ–∏ —Ü–≤–µ—Ç–æ–≤–µ)</option>
                    </select>
                </div>
                
                <!-- Custom Color Picker Section -->
                <div id="customColorSection" style="display: none; margin: 20px 0; padding: 20px; background: var(--bg-color); border-radius: 12px; border: 2px solid var(--primary-red);">
                    <h3 style="margin-bottom: 15px; color: var(--text-dark);"><i class="fas fa-paint-brush"></i> –ò–∑–±–µ—Ä–∏ 3 –û—Å–Ω–æ–≤–Ω–∏ –¶–≤—è—Ç–∞</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label for="customPrimary">–û—Å–Ω–æ–≤–µ–Ω –¶–≤—è—Ç (Primary):</label>
                            <input type="color" id="customPrimary" value="#10b981" style="width: 100%; height: 50px; cursor: pointer;">
                            <small style="display: block; margin-top: 5px; color: var(--text-gray);">–ó–∞ –±—É—Ç–æ–Ω–∏ –∏ –∞–∫—Ü–µ–Ω—Ç–∏</small>
                        </div>
                        <div class="form-group">
                            <label for="customSecondary">–í—Ç–æ—Ä–∏—á–µ–Ω –¶–≤—è—Ç (Secondary):</label>
                            <input type="color" id="customSecondary" value="#3b82f6" style="width: 100%; height: 50px; cursor: pointer;">
                            <small style="display: block; margin-top: 5px; color: var(--text-gray);">–ó–∞ –ø–æ–¥—á–µ—Ä—Ç–∞–≤–∞–Ω–µ</small>
                        </div>
                        <div class="form-group">
                            <label for="customAccent">–ê–∫—Ü–µ–Ω—Ç–∏—Ä–∞—â –¶–≤—è—Ç (Accent):</label>
                            <input type="color" id="customAccent" value="#ff7f6a" style="width: 100%; height: 50px; cursor: pointer;">
                            <small style="display: block; margin-top: 5px; color: var(--text-gray);">–ó–∞ —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏</small>
                        </div>
                    </div>
                </div>
                <div id="colorPreview" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; padding: 20px; background: var(--bg-light); border-radius: 12px;">
                    <div style="padding: 30px; border-radius: 12px; text-align: center; color: white; font-weight: bold; background: #10b981;">
                        –ó–µ–ª–µ–Ω–æ
                    </div>
                    <div style="padding: 30px; border-radius: 12px; text-align: center; color: white; font-weight: bold; background: #3b82f6;">
                        –°–∏–Ω—å–æ
                    </div>
                    <div style="padding: 30px; border-radius: 12px; text-align: center; font-weight: bold; color: white; background: #ff7f6a;">
                        –ö–æ—Ä–∞–ª
                    </div>
                </div>
                <button class="btn" onclick="saveColorScheme()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –¶–≤–µ—Ç–æ–≤–∞ –°—Ö–µ–º–∞
                </button>
            </div>
            </div>
            <!-- End Configuration Tab -->

            <!-- AI Prompts Tab -->
            <div id="tab-ai-prompts" class="tab-content">
            <!-- AI Prompt Editor -->
            <div class="card">
                <h2><i class="fas fa-pen-fancy"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ü–ª–∞–Ω</h2>
                <div class="warning-box">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü—Ä–æ–º–µ–Ω–µ—Ç–µ –ø—Ä–æ–º–ø—Ç–∞ —Å–∞–º–æ –∞–∫–æ –∑–Ω–∞–µ—Ç–µ –∫–∞–∫–≤–æ –ø—Ä–∞–≤–∏—Ç–µ. –ì—Ä–µ—à–µ–Ω –ø—Ä–æ–º–ø—Ç –º–æ–∂–µ –¥–∞ –¥–æ–≤–µ–¥–µ –¥–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏ –ø–ª–∞–Ω–æ–≤–µ.
                </div>
                <div class="info-box" style="background: #d1f2eb; border-left: 4px solid #1abc9c;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞ –∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏ <strong>—Å–ª–µ–¥–≤–∞—â–æ—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ</strong> –Ω–∞ –ø–ª–∞–Ω. –ù—è–º–∞ –∫–µ—à–∏—Ä–∞–Ω–µ - –≤–∏–Ω–∞–≥–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è.
                </div>
                <div class="form-group">
                    <label for="aiPrompt">–ü—Ä–æ–º–ø—Ç –®–∞–±–ª–æ–Ω:</label>
                    <textarea id="aiPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç —à–∞–±–ª–æ–Ω..."></textarea>
                </div>
                <div class="info-box">
                    <strong>–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏:</strong> –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ {name}, {age}, {weight}, {height}, {goal} –∏ –¥—Ä—É–≥–∏ –ø–æ–ª–µ—Ç–∞ –æ—Ç –≤—ä–ø—Ä–æ—Å–Ω–∏–∫–∞.
                </div>
                <button class="btn" onclick="saveAIPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="resetPrompt()" style="background: #7f8c8d; margin-left: 10px;">
                    <i class="fas fa-undo"></i> –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </button>
            </div>

            <!-- Analysis Prompt Editor -->
            <div class="card">
                <h2><i class="fas fa-brain"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –ê–Ω–∞–ª–∏–∑ (–°—Ç—ä–ø–∫–∞ 1)</h2>
                <div class="info-box" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                    <strong>‚ú® –ü–æ–¥–æ–±—Ä–µ–Ω–æ:</strong> –•–æ–ª–∏—Å—Ç–∏—á–µ–Ω –∞–Ω–∞–ª–∏–∑ —Å –∫–æ—Ä–µ–ª–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—ä–Ω ‚Üî —Å—Ç—Ä–µ—Å ‚Üî —Ö—Ä–∞–Ω–µ–Ω–µ, —Å–µ–¥–º–∏—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (weeklyBlueprint), –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –∏ –º–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª.
                </div>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ —Ö–æ–ª–∏—Å—Ç–∏—á–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ - BMR, TDEE, –º–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Ñ–∞–∫—Ç–æ—Ä–∏.
                </div>
                <div class="info-box" style="background: #d1f2eb; border-left: 4px solid #1abc9c;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞ –∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏ <strong>—Å–ª–µ–¥–≤–∞—â–æ—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ</strong> –Ω–∞ –ø–ª–∞–Ω. –ù—è–º–∞ –∫–µ—à–∏—Ä–∞–Ω–µ - –≤–∏–Ω–∞–≥–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è.
                </div>
                <div class="form-group">
                    <label for="analysisPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –ê–Ω–∞–ª–∏–∑:</label>
                    <textarea id="analysisPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ –∞–Ω–∞–ª–∏–∑..."></textarea>
                </div>
                <div class="info-box">
                    <strong>–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏:</strong> –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ {userData} –∑–∞ –≤—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç, –∏–ª–∏ –æ—Ç–¥–µ–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∫–∞—Ç–æ {name}, {age}, {goal} –∏ –¥—Ä.
                </div>
                <div class="info-box-warning">
                    <strong>‚ö†Ô∏è –í–ê–ñ–ù–û - JSON –§–æ—Ä–º–∞—Ç:</strong> –ê–∫–æ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø—Ä–æ–º–ø—Ç, <strong>–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ</strong> –¥–æ–±–∞–≤–µ—Ç–µ –≤ –∫—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ JSON —Ñ–æ—Ä–º–∞—Ç (–Ω–∞–ø—Ä. "–û—Ç–≥–æ–≤–æ—Ä–∏ –°–ê–ú–û —Å –≤–∞–ª–∏–¥–µ–Ω JSON –æ–±–µ–∫—Ç"). –ê–∫–æ –ø—Ä–æ–º–ø—Ç—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ JSON –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —â–µ –¥–æ–±–∞–≤–∏ –±–∞–∑–æ–≤–∏ —Ç–∞–∫–∏–≤–∞. –ó–∞ –ø—Ä–∏–º–µ—Ä, –≤–∏–∂—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è –ø—Ä–æ–º–ø—Ç –∫–∞—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è.
                </div>
                <button class="btn" onclick="saveAnalysisPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç –∑–∞ –ê–Ω–∞–ª–∏–∑
                </button>
                <button class="btn" onclick="viewDefaultPrompt('analysis', 'analysisPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="resetAnalysisPrompt()" style="background: #7f8c8d; margin-left: 10px;">
                    <i class="fas fa-undo"></i> –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </button>
            </div>

            <!-- Strategy Prompt Editor -->
            <div class="card">
                <h2><i class="fas fa-chess"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏—è (–°—Ç—ä–ø–∫–∞ 2)</h2>
                <div class="info-box" style="background: #d1ecf1; border-left: 4px solid #0c5460;">
                    <strong>üéØ –ù–û–í–û (Archprompt):</strong> AI —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è <code>dietaryModifier</code> (–ö–µ—Ç–æ, –í–µ–≥–∞–Ω, –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–æ, –©–∞–¥—è—â —Å—Ç–æ–º–∞—Ö –∏ –¥—Ä.) –±–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ —Ö–æ–ª–∏—Å—Ç–∏—á–µ–Ω –∞–Ω–∞–ª–∏–∑. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–Ω–∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –¥–æ–±–∞–≤–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.
                </div>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ –æ–ø—Ç–∏–º–∞–ª–Ω–∞—Ç–∞ –¥–∏–µ—Ç–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑–∞.
                </div>
                <div class="info-box" style="background: #d1f2eb; border-left: 4px solid #1abc9c;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞ –∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏ <strong>—Å–ª–µ–¥–≤–∞—â–æ—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ</strong> –Ω–∞ –ø–ª–∞–Ω. –ù—è–º–∞ –∫–µ—à–∏—Ä–∞–Ω–µ - –≤–∏–Ω–∞–≥–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è.
                </div>
                <div class="form-group">
                    <label for="strategyPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏—è:</label>
                    <textarea id="strategyPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è..."></textarea>
                </div>
                <div class="info-box">
                    <strong>–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏:</strong> –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ {userData} –∑–∞ –¥–∞–Ω–Ω–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞, {analysisData} –∑–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞, {name}, {age}, {goal} –∏ –¥—Ä.
                </div>
                <div class="info-box-warning">
                    <strong>‚ö†Ô∏è –í–ê–ñ–ù–û - JSON –§–æ—Ä–º–∞—Ç:</strong> –ê–∫–æ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø—Ä–æ–º–ø—Ç, <strong>–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ</strong> –¥–æ–±–∞–≤–µ—Ç–µ –≤ –∫—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ JSON —Ñ–æ—Ä–º–∞—Ç (–Ω–∞–ø—Ä. "–í—ä—Ä–Ω–∏ JSON —Å—ä—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏—è"). –ê–∫–æ –ø—Ä–æ–º–ø—Ç—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ JSON –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —â–µ –¥–æ–±–∞–≤–∏ –±–∞–∑–æ–≤–∏ —Ç–∞–∫–∏–≤–∞. –ó–∞ –ø—Ä–∏–º–µ—Ä, –≤–∏–∂—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è –ø—Ä–æ–º–ø—Ç –∫–∞—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è.
                </div>
                <button class="btn" onclick="saveStrategyPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç –∑–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏—è
                </button>
                <button class="btn" onclick="viewDefaultPrompt('strategy', 'strategyPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="resetStrategyPrompt()" style="background: #7f8c8d; margin-left: 10px;">
                    <i class="fas fa-undo"></i> –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </button>
            </div>

            <!-- Meal Plan Prompt Editor -->
            <div class="card">
                <h2><i class="fas fa-utensils"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ü–ª–∞–Ω (–°—Ç—ä–ø–∫–∞ 3)</h2>
                <div class="info-box" style="background: #d4edda; border-left: 4px solid #28a745;">
                    <strong>üöÄ ADLE v8:</strong> Advanced Dietary Logic Engine —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ([PRO], [ENG], [VOL], [FAT], [CMPX]), 4 —à–∞–±–ª–æ–Ω–∞ (A-D) –∏ 12 —Å—Ç—Ä–æ–≥–∏ –ø—Ä–∞–≤–∏–ª–∞ (R1-R12). –§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ —Å–ø–æ—Ä–µ–¥ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä, whitelist/blacklist –ø—Ä–æ–≤–µ—Ä–∫–∞.
                </div>
                <div class="warning-box">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç –µ –∫—Ä–∏—Ç–∏—á–µ–Ω - –∏–∑–ø–æ–ª–∑–≤–∞ —Å–µ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ç–µ —è—Å—Ç–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞ –≤—Å–µ–∫–∏ –¥–µ–Ω.
                </div>
                <div class="info-box" style="background: #d1f2eb; border-left: 4px solid #1abc9c;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞ –∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏ <strong>—Å–ª–µ–¥–≤–∞—â–æ—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ</strong> –Ω–∞ –ø–ª–∞–Ω. –ù—è–º–∞ –∫–µ—à–∏—Ä–∞–Ω–µ - –≤–∏–Ω–∞–≥–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è.
                </div>
                <div class="form-group">
                    <label for="mealPlanPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ü–ª–∞–Ω:</label>
                    <textarea id="mealPlanPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω..."></textarea>
                </div>
                <div class="info-box">
                    <strong>–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏:</strong> {userData}, {analysisData}, {strategyData}, {bmr}, {recommendedCalories}, {startDay}, {endDay}, {previousDays}
                </div>
                <div class="info-box-warning">
                    <strong>‚ö†Ô∏è –í–ê–ñ–ù–û - JSON –§–æ—Ä–º–∞—Ç:</strong> –ê–∫–æ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø—Ä–æ–º–ø—Ç, <strong>–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ</strong> –¥–æ–±–∞–≤–µ—Ç–µ –≤ –∫—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ JSON —Ñ–æ—Ä–º–∞—Ç. –ê–∫–æ –ø—Ä–æ–º–ø—Ç—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ JSON –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —â–µ –¥–æ–±–∞–≤–∏ –±–∞–∑–æ–≤–∏ —Ç–∞–∫–∏–≤–∞. –ó–∞ –ø—Ä–∏–º–µ—Ä, –≤–∏–∂—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è –ø—Ä–æ–º–ø—Ç –∫–∞—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è.
                </div>
                <button class="btn" onclick="saveMealPlanPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç –∑–∞ –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ü–ª–∞–Ω
                </button>
                <button class="btn" onclick="viewDefaultPrompt('meal_plan', 'mealPlanPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="resetMealPlanPrompt()" style="background: #7f8c8d; margin-left: 10px;">
                    <i class="fas fa-undo"></i> –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </button>
            </div>

            <!-- Summary Prompt Editor -->
            <div class="card">
                <h2><i class="fas fa-clipboard-check"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –û–±–æ–±—â–µ–Ω–∏–µ (–°—Ç—ä–ø–∫–∞ 4)</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ, –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∏ –¥–æ–ø—ä–ª–Ω–µ–Ω–∏—è –∫—ä–º —Å–µ–¥–º–∏—á–Ω–∏—è –ø–ª–∞–Ω.
                </div>
                <div class="info-box" style="background: #d1f2eb; border-left: 4px solid #1abc9c;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞ –∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏ <strong>—Å–ª–µ–¥–≤–∞—â–æ—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ</strong> –Ω–∞ –ø–ª–∞–Ω. –ù—è–º–∞ –∫–µ—à–∏—Ä–∞–Ω–µ - –≤–∏–Ω–∞–≥–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è.
                </div>
                <div class="form-group">
                    <label for="summaryPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –û–±–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="summaryPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ –æ–±–æ–±—â–µ–Ω–∏–µ..."></textarea>
                </div>
                <div class="info-box">
                    <strong>–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏:</strong> {userData}, {strategyData}, {weekPlan}, {bmr}, {recommendedCalories}, {avgCalories}, {avgProtein}, {avgCarbs}, {avgFats}
                </div>
                <div class="info-box-warning">
                    <strong>‚ö†Ô∏è –í–ê–ñ–ù–û - JSON –§–æ—Ä–º–∞—Ç:</strong> –ê–∫–æ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø—Ä–æ–º–ø—Ç, <strong>–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ</strong> –¥–æ–±–∞–≤–µ—Ç–µ –≤ –∫—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ JSON —Ñ–æ—Ä–º–∞—Ç. –ê–∫–æ –ø—Ä–æ–º–ø—Ç—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ JSON –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —â–µ –¥–æ–±–∞–≤–∏ –±–∞–∑–æ–≤–∏ —Ç–∞–∫–∏–≤–∞. –ó–∞ –ø—Ä–∏–º–µ—Ä, –≤–∏–∂—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è –ø—Ä–æ–º–ø—Ç –∫–∞—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è.
                </div>
                <button class="btn" onclick="saveSummaryPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç –∑–∞ –û–±–æ–±—â–µ–Ω–∏–µ
                </button>
                <button class="btn" onclick="viewDefaultPrompt('summary', 'summaryPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="resetSummaryPrompt()" style="background: #7f8c8d; margin-left: 10px;">
                    <i class="fas fa-undo"></i> –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </button>
            </div>

            <!-- Chat Prompt Editor - Consultation Mode -->
            <div class="card">
                <h2><i class="fas fa-comments"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –ß–∞—Ç –ê—Å–∏—Å—Ç–µ–Ω—Ç - –†–µ–∂–∏–º –ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏—è</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∫–æ–≥–∞—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –µ –≤ —Ä–µ–∂–∏–º –Ω–∞ –∫–æ–Ω—Å—É–ª—Ç–∞—Ü–∏—è (—Å–∞–º–æ —á–µ—Ç–µ–Ω–µ –Ω–∞ –ø–ª–∞–Ω–∞).
                </div>
                <div class="info-box" style="background: #fff9e6; border-left: 4px solid #f39c12;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞. –ò–º–∞ 5-–º–∏–Ω—É—Ç–µ–Ω –∫–µ—à –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –Ω–æ –∫–µ—à—ä—Ç —Å–µ <strong>–∏–∑—á–∏—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</strong> –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ. –ù–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å–ª–µ–¥ —Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ –∑–∞—è–≤–∫–∞.
                </div>
                <div class="form-group">
                    <label for="consultationPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–æ–Ω–µ–Ω –†–µ–∂–∏–º:</label>
                    <textarea id="consultationPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ –∫–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–æ–Ω–µ–Ω —Ä–µ–∂–∏–º..."></textarea>
                </div>
                <button class="btn" onclick="saveConsultationPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–æ–Ω–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="viewDefaultPrompt('consultation', 'consultationPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
            </div>

            <!-- Chat Prompt Editor - Modification Mode -->
            <div class="card">
                <h2><i class="fas fa-edit"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –ß–∞—Ç –ê—Å–∏—Å—Ç–µ–Ω—Ç - –†–µ–∂–∏–º –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ –ü–ª–∞–Ω</h2>
                <div class="warning-box">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∫–æ–≥–∞—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –∏—Å–∫–∞ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏—è —Å–∏ –ø–ª–∞–Ω.
                </div>
                <div class="info-box" style="background: #fff9e6; border-left: 4px solid #f39c12;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞. –ò–º–∞ 5-–º–∏–Ω—É—Ç–µ–Ω –∫–µ—à –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –Ω–æ –∫–µ—à—ä—Ç —Å–µ <strong>–∏–∑—á–∏—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</strong> –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ. –ù–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å–ª–µ–¥ —Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ –∑–∞—è–≤–∫–∞.
                </div>
                <div class="form-group">
                    <label for="modificationPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –†–µ–∂–∏–º –ü—Ä–æ–º—è–Ω–∞:</label>
                    <textarea id="modificationPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ —Ä–µ–∂–∏–º –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø–ª–∞–Ω..."></textarea>
                </div>
                <button class="btn" onclick="saveModificationPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç –∑–∞ –ü—Ä–æ–º—è–Ω–∞
                </button>
                <button class="btn" onclick="viewDefaultPrompt('modification', 'modificationPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
            </div>

            <!-- Correction Prompt Editor -->
            <div class="card">
                <h2><i class="fas fa-tools"></i> AI –ü—Ä–æ–º–ø—Ç –∑–∞ –ö–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ –ü–ª–∞–Ω (–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞)</h2>
                <div class="info-box" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                    <strong>üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ö–æ—Ä–µ–∫—Ü–∏—è:</strong> –¢–æ–∑–∏ –ø—Ä–æ–º–ø—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∫–æ–≥–∞—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏—è—Ç –ø–ª–∞–Ω –Ω–µ –ø—Ä–µ–º–∏–Ω–∞–≤–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞. AI —Å–µ –∏–∑–≤–∏–∫–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–∞ –∫–æ—Ä–∏–≥–∏—Ä–∞ –≥—Ä–µ—à–∫–∏—Ç–µ –≤–º–µ—Å—Ç–æ –¥–∞ —Å–µ –ø—Ä–æ–≤–∞–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ—Ç–æ.
                </div>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–ø—Ç—ä—Ç –ø–æ–ª—É—á–∞–≤–∞ —Å–ø–∏—Å—ä–∫ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –≥—Ä–µ—à–∫–∏ (–Ω–∞–ø—Ä. "–ª–∏–ø—Å–≤–∞—Ç –∫–∞–ª–æ—Ä–∏–∏", "–Ω–µ–≤–∞–ª–∏–¥–Ω–∏ –º–∞–∫—Ä–æ—Å–∏") –∏ —Ç–µ–∫—É—â–∏—è –ø–ª–∞–Ω —Å –ø—Ä–æ–±–ª–µ–º–∏, —Å–ª–µ–¥ –∫–æ–µ—Ç–æ AI –∫–æ—Ä–∏–≥–∏—Ä–∞ —Å–∞–º–æ –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ç–µ —á–∞—Å—Ç–∏.
                </div>
                <div class="info-box" style="background: #d1f2eb; border-left: 4px solid #1abc9c;">
                    <strong>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç <strong>–≤–µ–¥–Ω–∞–≥–∞</strong> –≤ –±–µ–∫–µ–Ω–¥–∞ –∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–∏ <strong>—Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è</strong>. –ù—è–º–∞ –∫–µ—à–∏—Ä–∞–Ω–µ.
                </div>
                <div class="form-group">
                    <label for="correctionPrompt">–ü—Ä–æ–º–ø—Ç –∑–∞ –ö–æ—Ä–µ–∫—Ü–∏—è:</label>
                    <textarea id="correctionPrompt" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ –ø–ª–∞–Ω..."></textarea>
                </div>
                <div class="info-box">
                    <strong>–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏:</strong> {errorsFormatted} (—Å–ø–∏—Å—ä–∫ —Å –≥—Ä–µ—à–∫–∏), {planJSON} (–ø–ª–∞–Ω —Å –≥—Ä–µ—à–∫–∏), {userDataJSON} (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏ –¥–∞–Ω–Ω–∏), {MEAL_NAME_FORMAT_INSTRUCTIONS} (–ø—Ä–∞–≤–∏–ª–∞ –∑–∞ —Ñ–æ—Ä–º–∞—Ç)
                </div>
                <div class="info-box-warning">
                    <strong>‚ö†Ô∏è –í–ê–ñ–ù–û - JSON –§–æ—Ä–º–∞—Ç:</strong> –ê–∫–æ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø—Ä–æ–º–ø—Ç, <strong>–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ</strong> –¥–æ–±–∞–≤–µ—Ç–µ –≤ –∫—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è "–í—ä—Ä–Ω–∏ –ü–™–õ–ù–ò–Ø –ö–û–†–ò–ì–ò–†–ê–ù –ø–ª–∞–Ω –≤ JSON —Ñ–æ—Ä–º–∞—Ç". –ê–∫–æ –ø—Ä–æ–º–ø—Ç—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ JSON –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —â–µ –¥–æ–±–∞–≤–∏ –±–∞–∑–æ–≤–∏ —Ç–∞–∫–∏–≤–∞. –ó–∞ –ø—Ä–∏–º–µ—Ä, –≤–∏–∂—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è –ø—Ä–æ–º–ø—Ç –∫–∞—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è.
                </div>
                <button class="btn" onclick="saveCorrectionPrompt()">
                    <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ü—Ä–æ–º–ø—Ç –∑–∞ –ö–æ—Ä–µ–∫—Ü–∏—è
                </button>
                <button class="btn" onclick="viewDefaultPrompt('correction', 'correctionPrompt')" style="background: #3498db; margin-left: 10px;">
                    <i class="fas fa-eye"></i> –í–∏–∂ –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç
                </button>
                <button class="btn" onclick="resetCorrectionPrompt()" style="background: #7f8c8d; margin-left: 10px;">
                    <i class="fas fa-undo"></i> –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                </button>
            </div>
            </div>
            <!-- End AI Prompts Tab -->

            <!-- Monitoring Tab -->
            <div id="tab-monitoring" class="tab-content">
            <!-- Problem Reports Section -->
            <div class="card">
                <h2><i class="fas fa-exclamation-triangle"></i> –î–æ–∫–ª–∞–¥–∏ –∑–∞ –ü—Ä–æ–±–ª–µ–º–∏</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –¢—É–∫ –º–æ–∂–µ—Ç–µ –¥–∞ –≤–∏–¥–∏—Ç–µ –≤—Å–∏—á–∫–∏ –¥–æ–∫–ª–∞–¥–∏ –∑–∞ –ø—Ä–æ–±–ª–µ–º–∏, –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ.
                </div>
                <button class="btn" onclick="loadReports()" style="margin-bottom: 20px;">
                    <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏ –î–æ–∫–ª–∞–¥–∏
                </button>
                <div id="reportsContainer" style="max-height: 500px; overflow-y: auto;">
                    <p style="text-align: center; color: var(--text-gray); padding: 20px;">
                        –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–û–±–Ω–æ–≤–∏ –î–æ–∫–ª–∞–¥–∏" –∑–∞ –¥–∞ –∑–∞—Ä–µ–¥–∏—Ç–µ –¥–æ–∫–ª–∞–¥–∏—Ç–µ.
                    </p>
                </div>
            </div>

            <!-- Client Questionnaires Section -->
            <div class="card">
                <h2><i class="fas fa-users"></i> –ö–ª–∏–µ–Ω—Ç—Å–∫–∏ –í—ä–ø—Ä–æ—Å–Ω–∏—Ü–∏</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –¢—É–∫ –º–æ–∂–µ—Ç–µ –¥–∞ –≤–∏–¥–∏—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ø—ä–ª–Ω–µ–Ω–∏ –≤—ä–ø—Ä–æ—Å–Ω–∏—Ü–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∏, –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ –ø—Ä–µ–∑ questionnaire2.html. –î–∞–Ω–Ω–∏—Ç–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤ KV —Ö—Ä–∞–Ω–∏–ª–∏—â–µ—Ç–æ.
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn" onclick="loadClientsList()" style="flex: 1;">
                        <i class="fas fa-sync"></i> –ó–∞—Ä–µ–¥–∏ –ö–ª–∏–µ–Ω—Ç–∏
                    </button>
                    <input type="text" id="clientsSearchInput" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –∏–º–µ –∏–ª–∏ –∏–º–µ–π–ª..." 
                           onkeyup="filterClients()" style="flex: 2; padding: 10px; border: 2px solid #d1d5db; border-radius: 8px;">
                </div>
                <div id="clientsStatsContainer" style="display: none; margin-bottom: 20px; padding: 15px; background: var(--soft-red); border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center;">
                        <div>
                            <strong>–û–±—â–æ –ö–ª–∏–µ–Ω—Ç–∏:</strong>
                            <div id="totalClients" style="font-size: 1.5rem; color: var(--primary-red); font-weight: bold;">-</div>
                        </div>
                        <div>
                            <strong>–ü–æ–∫–∞–∑–∞–Ω–∏:</strong>
                            <div id="showingClients" style="font-size: 1.5rem; color: var(--primary-red); font-weight: bold;">-</div>
                        </div>
                    </div>
                </div>
                <div id="clientsListContainer" style="max-height: 600px; overflow-y: auto;">
                    <p style="text-align: center; color: var(--text-gray); padding: 20px;">
                        –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–ó–∞—Ä–µ–¥–∏ –ö–ª–∏–µ–Ω—Ç–∏" –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —Å–ø–∏—Å—ä–∫–∞ —Å –∫–ª–∏–µ–Ω—Ç–∏.
                    </p>
                </div>
            </div>

            <!-- AI Communication Logs -->
            <div class="card">
                <h2><i class="fas fa-network-wired"></i> AI –ö–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –õ–æ–≥–æ–≤–µ</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –±–µ–∫–µ–Ω–¥–∞ –∏ AI –º–æ–¥–µ–ª–∞. –°—ä—Ö—Ä–∞–Ω—è–≤–∞ —Å–µ —Å–∞–º–æ –ø–æ—Å–ª–µ–¥–Ω–∏—è—Ç –ª–æ–≥, –ø—Ä–µ–¥–∏—à–Ω–∏—Ç–µ —Å–µ –∏–∑—Ç—Ä–∏–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –±—É—Ç–æ–Ω–∞ "–ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ –õ–æ–≥–æ–≤–µ" –∑–∞ –¥–∞ –∑–∞–ø–∞–∑–∏—Ç–µ —Ç–µ–∫—É—â–∏—è –ª–æ–≥ –∫–∞—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤ —Ñ–∞–π–ª —Å –≤—Å–∏—á–∫–∏ —Å—Ç—ä–ø–∫–∏, –¥–∞–Ω–Ω–∏ –∏ –æ—Ç–≥–æ–≤–æ—Ä–∏.
                </div>
                
                <!-- Logging Toggle -->
                <div style="background: var(--soft-red); padding: 20px; border-radius: 12px; margin: 20px 0; border: 2px solid var(--primary-red);">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="flex: 1; min-width: 250px;">
                            <h3 style="margin-bottom: 10px; color: var(--text-dark);">
                                <i class="fas fa-toggle-on"></i> AI –õ–æ–≥–≤–∞–Ω–µ
                            </h3>
                            <p style="color: var(--text-gray); margin: 0;">
                                –°—Ç–∞—Ç—É—Å: <strong id="loggingStatusText" style="color: var(--text-gray);">–ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –±—É—Ç–æ–Ω–∞ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞</strong>
                            </p>
                            <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                                ‚ö†Ô∏è –ò–∑–∫–ª—é—á–≤–∞–Ω–µ—Ç–æ —Å–ø–µ—Å—Ç—è–≤–∞ ~36 KV –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –ø–ª–∞–Ω (56% —Ä–µ–¥—É–∫—Ü–∏—è)
                            </small>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" onclick="loadLoggingStatus()" style="background: var(--accent-blue);">
                                <i class="fas fa-sync"></i> –ü—Ä–æ–≤–µ—Ä–∏
                            </button>
                            <button id="enableLoggingBtn" class="btn" onclick="toggleLogging(true)" style="background: #28a745;">
                                <i class="fas fa-check"></i> –í–∫–ª—é—á–∏
                            </button>
                            <button id="disableLoggingBtn" class="btn" onclick="toggleLogging(false)" style="background: #dc3545;">
                                <i class="fas fa-times"></i> –ò–∑–∫–ª—é—á–∏
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –∏ –û–ø—Ü–∏–∏:</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="number" id="logsLimit" placeholder="–õ–∏–º–∏—Ç (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ: 50)" value="50" style="flex: 1;">
                        <input type="number" id="logsOffset" placeholder="–û—Ç–º–µ—Å—Ç–≤–∞–Ω–µ (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ: 0)" value="0" style="flex: 1;">
                    </div>
                </div>
                <button class="btn" onclick="loadAILogs()" style="margin-bottom: 20px;">
                    <i class="fas fa-sync"></i> –ó–∞—Ä–µ–¥–∏ –õ–æ–≥–æ–≤–µ
                </button>
                <button class="btn" onclick="exportAILogs()" style="margin-bottom: 20px; margin-left: 10px; background: var(--accent-blue);" aria-label="–ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ AI –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏ –ª–æ–≥–æ–≤–µ –∫–∞—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤ —Ñ–∞–π–ª">
                    <i class="fas fa-download"></i> –ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ –õ–æ–≥–æ–≤–µ
                </button>
                <div id="aiLogsStats" style="display: none; margin-bottom: 20px; padding: 15px; background: var(--soft-red); border-radius: 8px;">
                    <h3 style="margin-bottom: 10px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        <div>
                            <strong>–û–±—â–æ –õ–æ–≥–æ–≤–µ:</strong>
                            <div id="totalLogs">-</div>
                        </div>
                        <div>
                            <strong>–°—Ä–µ–¥–Ω–æ –í—Ä–µ–º–µ:</strong>
                            <div id="avgDuration">-</div>
                        </div>
                        <div>
                            <strong>–û–±—â–æ –í—Ö–æ–¥–Ω–∏ –¢–æ–∫–µ–Ω–∏:</strong>
                            <div id="totalInputTokens">-</div>
                        </div>
                        <div>
                            <strong>–û–±—â–æ –ò–∑—Ö–æ–¥–Ω–∏ –¢–æ–∫–µ–Ω–∏:</strong>
                            <div id="totalOutputTokens">-</div>
                        </div>
                    </div>
                </div>
                <div id="aiLogsContainer" style="max-height: 600px; overflow-y: auto;">
                    <p style="text-align: center; color: var(--text-gray); padding: 20px;">
                        –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–ó–∞—Ä–µ–¥–∏ –õ–æ–≥–æ–≤–µ" –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏—Ç–µ –ª–æ–≥–æ–≤–µ.
                    </p>
                </div>
            </div>
            </div>
            <!-- End Monitoring Tab -->

            <!-- Features Tab -->
            <div id="tab-features" class="tab-content">
            <!-- Push Notifications Management -->
            <div class="card">
                <h2><i class="fas fa-bell"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Push –ò–∑–≤–µ—Å—Ç–∏—è</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ –∏–∑–≤–µ—Å—Ç–∏—è –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ. –ò–∑–≤–µ—Å—Ç–∏—è—Ç–∞ —Å–µ –∏–∑–ø—Ä–∞—â–∞—Ç —Å–∞–º–æ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏, –∫–æ–∏—Ç–æ —Å–∞ –¥–∞–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑—ä—Ä–∞ —Å–∏.
                </div>

                <!-- Notification Status -->
                <div class="form-group">
                    <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 20px;">
                        <div class="stat-card">
                            <div class="stat-label">VAPID –ö–ª—é—á</div>
                            <div class="stat-value" id="vapidKeyStatus" style="font-size: 0.9rem;">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">–°—Ç–∞—Ç—É—Å</div>
                            <div class="stat-value" id="notificationStatus">
                                <span id="notificationEnabledBadge" style="padding: 5px 10px; border-radius: 5px; font-size: 0.9rem;">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global Enable/Disable -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="notificationsEnabled" style="width: auto; margin-right: 10px;" checked>
                        –ê–∫—Ç–∏–≤–∏—Ä–∞–π —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è
                    </label>
                </div>

                <!-- Chat Messages Notifications -->
                <div class="form-group">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: var(--text-dark);">
                        <i class="fas fa-comments"></i> –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –ß–∞—Ç –°—ä–æ–±—â–µ–Ω–∏—è
                    </h3>
                    <label>
                        <input type="checkbox" id="chatNotificationsEnabled" style="width: auto; margin-right: 10px;" checked>
                        –ò–∑–ø—Ä–∞—â–∞–π –∏–∑–≤–µ—Å—Ç–∏—è –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è –æ—Ç AI –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞
                    </label>
                </div>

                <!-- Water Reminders -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: var(--text-dark);">
                        <i class="fas fa-tint"></i> –ù–∞–ø–æ–º–Ω—è–Ω–∏—è –∑–∞ –ü–∏–µ–Ω–µ –Ω–∞ –í–æ–¥–∞
                    </h3>
                    <label>
                        <input type="checkbox" id="waterRemindersEnabled" style="width: auto; margin-right: 10px;" checked>
                        –ê–∫—Ç–∏–≤–∏—Ä–∞–π –Ω–∞–ø–æ–º–Ω—è–Ω–∏—è –∑–∞ –≤–æ–¥–∞
                    </label>
                    <div id="waterReminderSettings" style="margin-top: 15px; padding-left: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                            <div>
                                <label>–ß–µ—Å—Ç–æ—Ç–∞ (—á–∞—Å–æ–≤–µ)</label>
                                <input type="number" id="waterFrequency" min="1" max="6" value="2" style="width: 100%;">
                            </div>
                            <div>
                                <label>–ù–∞—á–∞–ª–µ–Ω —á–∞—Å</label>
                                <input type="number" id="waterStartHour" min="0" max="23" value="8" style="width: 100%;">
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <label>–ö—Ä–∞–µ–Ω —á–∞—Å</label>
                            <input type="number" id="waterEndHour" min="0" max="23" value="22" style="width: 100%;">
                        </div>
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                            –ü—Ä–∏–º–µ—Ä: –ü—Ä–∏ —á–µ—Å—Ç–æ—Ç–∞ 2 —á–∞—Å–∞, –Ω–∞—á–∞–ª–µ–Ω —á–∞—Å 8 –∏ –∫—Ä–∞–µ–Ω —á–∞—Å 22, –∏–∑–≤–µ—Å—Ç–∏—è—Ç–∞ —â–µ —Å–µ –∏–∑–ø—Ä–∞—â–∞—Ç –Ω–∞: 8:00, 10:00, 12:00, 14:00, 16:00, 18:00, 20:00, 22:00
                        </small>
                    </div>
                </div>

                <!-- Meal Reminders -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: var(--text-dark);">
                        <i class="fas fa-utensils"></i> –ù–∞–ø–æ–º–Ω—è–Ω–∏—è –∑–∞ –•—Ä–∞–Ω–µ–Ω–µ
                    </h3>
                    <label>
                        <input type="checkbox" id="mealRemindersEnabled" style="width: auto; margin-right: 10px;" checked>
                        –ê–∫—Ç–∏–≤–∏—Ä–∞–π –Ω–∞–ø–æ–º–Ω—è–Ω–∏—è –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–µ
                    </label>
                    <div id="mealReminderSettings" style="margin-top: 15px; padding-left: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                            <div>
                                <label>–ó–∞–∫—É—Å–∫–∞</label>
                                <input type="time" id="breakfastTime" value="08:00" style="width: 100%;">
                            </div>
                            <div>
                                <label>–û–±—è–¥</label>
                                <input type="time" id="lunchTime" value="13:00" style="width: 100%;">
                            </div>
                            <div>
                                <label>–í–µ—á–µ—Ä—è</label>
                                <input type="time" id="dinnerTime" value="19:00" style="width: 100%;">
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <label>
                                <input type="checkbox" id="snackRemindersEnabled" style="width: auto; margin-right: 10px;">
                                –ê–∫—Ç–∏–≤–∏—Ä–∞–π –Ω–∞–ø–æ–º–Ω—è–Ω–∏—è –∑–∞ –º–µ–∂–¥–∏–Ω–Ω–∏ –∑–∞–∫—É—Å–∫–∏
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="saveNotificationSettings()">
                        <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                    <button class="btn" onclick="loadNotificationSettings()" style="background: var(--accent-blue);">
                        <i class="fas fa-sync"></i> –ü—Ä–µ–∑–∞—Ä–µ–¥–∏
                    </button>
                    <button class="btn" onclick="sendTestNotification()" style="background: var(--accent-yellow); color: var(--text-dark);">
                        <i class="fas fa-paper-plane"></i> –¢–µ—Å—Ç–≤–∞–π –ò–∑–≤–µ—Å—Ç–∏–µ
                    </button>
                </div>
            </div>

            <!-- Admin Messaging Section -->
            <div class="card" style="margin-top: 20px;">
                <h2><i class="fas fa-comment-dots"></i> –ò–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ AI –ê—Å–∏—Å—Ç–µ–Ω—Ç –°—ä–æ–±—â–µ–Ω–∏—è</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ò–∑–ø—Ä–∞—Ç–µ—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –æ—Ç AI –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç —â–µ –ø–æ–ª—É—á–∏ push –∏–∑–≤–µ—Å—Ç–∏–µ.
                </div>

                <div class="form-group">
                    <label>User ID –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è</label>
                    <input type="text" id="messageUserId" placeholder="–Ω–∞–ø—Ä. user_1234567890_abc123" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                        –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –º–æ–∂–µ –¥–∞ –Ω–∞–º–µ—Ä–∏ —Å–≤–æ–µ—Ç–æ User ID –≤ browser console
                    </small>
                </div>

                <div class="form-group">
                    <label>–°—ä–æ–±—â–µ–Ω–∏–µ</label>
                    <textarea id="messageText" rows="4" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –æ—Ç AI –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞..."
                              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="sendAdminMessage()">
                        <i class="fas fa-paper-plane"></i> –ò–∑–ø—Ä–∞—Ç–∏ –°—ä–æ–±—â–µ–Ω–∏–µ
                    </button>
                </div>
            </div>

            <!-- Notification Templates Editor -->
            <div class="card" style="margin-top: 20px;">
                <h2><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –®–∞–±–ª–æ–Ω–∏ –∑–∞ –ò–∑–≤–µ—Å—Ç–∏—è</h2>
                <div class="info-box">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ —Ç–µ–∫—Å—Ç–∞ –∏ –≤—Ä–µ–º–µ—Ç–æ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ç–µ –∏–∑–≤–µ—Å—Ç–∏—è.
                </div>

                <!-- Meal Templates -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-dark);">
                        <i class="fas fa-utensils"></i> –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –•—Ä–∞–Ω–µ–Ω–µ
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600;">–ó–∞–∫—É—Å–∫–∞</label>
                        <input type="text" id="templateMealBreakfastTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                               style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" id="templateMealBreakfastBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600;">–û–±—è–¥</label>
                        <input type="text" id="templateMealLunchTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                               style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" id="templateMealLunchBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600;">–í–µ—á–µ—Ä—è</label>
                        <input type="text" id="templateMealDinnerTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                               style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" id="templateMealDinnerBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600;">–ú–µ–∂–¥–∏–Ω–Ω–∞ –∑–∞–∫—É—Å–∫–∞</label>
                        <input type="text" id="templateMealSnackTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                               style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" id="templateMealSnackBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                </div>

                <!-- Water Template -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-dark);">
                        <i class="fas fa-tint"></i> –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –í–æ–¥–∞
                    </h3>
                    <input type="text" id="templateWaterTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                           style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="text" id="templateWaterBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                </div>

                <!-- Sleep Template -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-dark);">
                        <i class="fas fa-moon"></i> –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –°—ä–Ω
                    </h3>
                    <input type="text" id="templateSleepTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                           style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="text" id="templateSleepBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                </div>

                <!-- Activity Template -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-dark);">
                        <i class="fas fa-running"></i> –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600;">–°—É—Ç—Ä–µ—à–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç</label>
                        <input type="text" id="templateActivityMorningTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                               style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" id="templateActivityMorningBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600;">–î–Ω–µ–≤–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç</label>
                        <input type="text" id="templateActivityDayTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                               style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" id="templateActivityDayBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                </div>

                <!-- Supplements Template -->
                <div class="form-group" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-dark);">
                        <i class="fas fa-pills"></i> –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –î–æ–±–∞–≤–∫–∏
                    </h3>
                    <input type="text" id="templateSupplementsTitle" placeholder="–ó–∞–≥–ª–∞–≤–∏–µ" 
                           style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="text" id="templateSupplementsBody" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∏–∑–≤–µ—Å—Ç–∏–µ—Ç–æ" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                </div>

                <!-- Template Action Buttons -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="saveNotificationTemplates()">
                        <i class="fas fa-save"></i> –ó–∞–ø–∞–∑–∏ –®–∞–±–ª–æ–Ω–∏
                    </button>
                    <button class="btn" onclick="loadNotificationTemplates()" style="background: var(--accent-blue);">
                        <i class="fas fa-sync"></i> –ü—Ä–µ–∑–∞—Ä–µ–¥–∏
                    </button>
                </div>
            </div>

            <!-- Blacklist Management -->
            <div class="card">
                <h2><i class="fas fa-ban"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ß–µ—Ä–µ–Ω –°–ø–∏—Å—ä–∫ —Å –•—Ä–∞–Ω–∏</h2>
                <div class="warning-box">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –•—Ä–∞–Ω–∏—Ç–µ –≤ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫ —â–µ –±—ä–¥–∞—Ç –ö–ê–¢–ï–ì–û–†–ò–ß–ù–û –ó–ê–ë–†–ê–ù–ï–ù–ò –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–æ–≤–µ. AI-—Ç–æ –Ω—è–º–∞ –¥–∞ –º–æ–∂–µ –¥–∞ –≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞.
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—É—â –ß–µ—Ä–µ–Ω –°–ø–∏—Å—ä–∫:</label>
                    <div id="blacklistDisplay" style="padding: 15px; background: var(--soft-red); border-radius: 8px; margin-bottom: 15px; min-height: 80px;">
                        <p style="text-align: center; color: var(--text-gray); padding: 20px;">
                            –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–û–ø—Ä–µ—Å–Ω–∏ –°–ø–∏—Å—ä–∫–∞", –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫.
                        </p>
                    </div>
                </div>
                <div class="form-group">
                    <label>–î–æ–±–∞–≤–∏ —Ö—Ä–∞–Ω–∞ –≤ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="blacklistInput" placeholder="–ù–∞–ø—Ä: –≥—Ä—ä—Ü–∫–æ –∫–∏—Å–µ–ª–æ –º–ª—è–∫–æ" style="flex: 1;">
                        <button class="btn" onclick="addToBlacklist()" style="background: var(--accent-light-red);">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏
                        </button>
                    </div>
                    <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                        –î–æ–±–∞–≤–µ—Ç–µ —Ö—Ä–∞–Ω–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –∏/–∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏ –µ–∑–∏–∫. –ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ –µ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –∏ –¥–≤–∞—Ç–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.
                    </small>
                </div>
                <button class="btn" onclick="loadBlacklist()" style="background: var(--accent-blue); margin-top: 10px;">
                    <i class="fas fa-sync"></i> –û–ø—Ä–µ—Å–Ω–∏ –°–ø–∏—Å—ä–∫–∞
                </button>
            </div>

            <!-- Whitelist Management -->
            <div class="card">
                <h2><i class="fas fa-check-circle"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ë—è–ª –°–ø–∏—Å—ä–∫ —Å –•—Ä–∞–Ω–∏</h2>
                <div class="info-box" style="background: #d4edda; border-left: 4px solid #28a745;">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –•—Ä–∞–Ω–∏—Ç–µ –≤ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫ —Å–∞ –†–ê–ó–†–ï–®–ï–ù–ò –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–æ–≤–µ. AI-—Ç–æ —â–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞ —Ç–µ–∑–∏ —Ö—Ä–∞–Ω–∏.
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—É—â –ë—è–ª –°–ø–∏—Å—ä–∫:</label>
                    <div id="whitelistDisplay" style="padding: 15px; background: #d4edda; border-radius: 8px; margin-bottom: 15px; min-height: 80px;">
                        <p style="text-align: center; color: var(--text-gray); padding: 20px;">
                            –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–û–ø—Ä–µ—Å–Ω–∏ –°–ø–∏—Å—ä–∫–∞", –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫.
                        </p>
                    </div>
                </div>
                <div class="form-group">
                    <label>–î–æ–±–∞–≤–∏ —Ö—Ä–∞–Ω–∞ –≤ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="whitelistInput" placeholder="–ù–∞–ø—Ä: —Ä–∏–±–∞, –ø–∏–ª–µ—à–∫–æ" style="flex: 1;">
                        <button class="btn" onclick="addToWhitelist()" style="background: #28a745;">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏
                        </button>
                    </div>
                    <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                        –î–æ–±–∞–≤–µ—Ç–µ —Ö—Ä–∞–Ω–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –∏/–∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏ –µ–∑–∏–∫. –ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ –µ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –∏ –¥–≤–∞—Ç–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.
                    </small>
                </div>
                <button class="btn" onclick="loadWhitelist()" style="background: var(--accent-blue); margin-top: 10px;">
                    <i class="fas fa-sync"></i> –û–ø—Ä–µ—Å–Ω–∏ –°–ø–∏—Å—ä–∫–∞
                </button>
            </div>
            </div>
            <!-- End Features Tab -->
        </div>
    </div>

    <script>
        // --- Theme Management ---
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
        }

        // Initialize theme on load
        initializeTheme();

        // --- Tab Management ---
        function switchTab(tabName, evt) {
            // Validate tabName to prevent XSS
            const validTabs = ['configuration', 'ai-prompts', 'monitoring', 'features'];
            if (!validTabs.includes(tabName)) {
                console.error('Invalid tab name:', tabName);
                return;
            }

            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab content
            const selectedTab = document.getElementById(`tab-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active class to clicked button (using evt if passed, otherwise find by data attribute)
            if (evt && evt.target) {
                evt.target.closest('.tab-btn').classList.add('active');
            } else {
                // Find button by matching tab name in a safe way
                const buttons = document.querySelectorAll('.tab-btn');
                buttons.forEach(button => {
                    const onclick = button.getAttribute('onclick');
                    if (onclick && onclick.includes(tabName)) {
                        button.classList.add('active');
                    }
                });
            }

            // Save selected tab to localStorage
            localStorage.setItem('selectedTab', tabName);
        }

        // Initialize tab on page load
        function initializeTab() {
            const savedTab = localStorage.getItem('selectedTab') || 'configuration';
            // Validate saved tab to prevent XSS
            const validTabs = ['configuration', 'ai-prompts', 'monitoring', 'features'];
            const tabToLoad = validTabs.includes(savedTab) ? savedTab : 'configuration';
            
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(`tab-${tabToLoad}`)?.classList.add('active');
            
            // Find and activate the matching button
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(button => {
                const onclick = button.getAttribute('onclick');
                if (onclick && onclick.includes(tabToLoad)) {
                    button.classList.add('active');
                }
            });
        }

        // Initialize tab when dashboard is shown
        document.addEventListener('DOMContentLoaded', () => {
            // DOMContentLoaded already ensures DOM is fully loaded, no timeout needed
            initializeTab();
        });

        // WARNING: This is a basic client-side authentication for demonstration purposes.
        // For production use, implement proper server-side authentication with the worker.
        // This password is visible in the browser source code and should not be used for security.
        const ADMIN_PASSWORD = 'nutriplan2024'; // TODO: Move to server-side auth
        const WORKER_URL = 'https://aidiet.radilov-k.workers.dev';

        // ============================================================================
        // CLIENT-SIDE CACHE SYSTEM FOR REDUCING BACKEND REQUESTS
        // ============================================================================
        // Cache Configuration
        const CACHE_CONFIG = {
            // Cache TTL (Time To Live) in milliseconds
            config: 5 * 60 * 1000,        // 5 minutes for config data
            blacklist: 5 * 60 * 1000,     // 5 minutes for blacklist
            whitelist: 5 * 60 * 1000,     // 5 minutes for whitelist
            reports: 2 * 60 * 1000,       // 2 minutes for reports (more dynamic)
            defaultPrompts: 30 * 60 * 1000, // 30 minutes for default prompts (rarely change)
            aiLogs: 1 * 60 * 1000         // 1 minute for AI logs (frequently updated)
        };

        // In-memory cache object
        const apiCache = {
            data: {},
            
            // Set cache entry with TTL
            set(key, value, ttl) {
                this.data[key] = {
                    value: value,
                    expiry: Date.now() + ttl
                };
            },
            
            // Get cache entry if not expired
            get(key) {
                const entry = this.data[key];
                if (!entry) return null;
                
                // Check if expired
                if (Date.now() > entry.expiry) {
                    delete this.data[key];
                    return null;
                }
                
                return entry.value;
            },
            
            // Clear specific cache entry
            clear(key) {
                delete this.data[key];
            },
            
            // Clear all cache entries
            clearAll() {
                this.data = {};
            },
            
            // Clear cache entries by pattern (e.g., 'defaultPrompt:*')
            clearPattern(pattern) {
                // Escape regex special characters and replace * with .*
                const escapedPattern = pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&').replace(/\\\*/g, '.*');
                const regex = new RegExp(escapedPattern);
                Object.keys(this.data).forEach(key => {
                    if (regex.test(key)) {
                        delete this.data[key];
                    }
                });
            }
        };

        // Cached fetch wrapper
        async function cachedFetch(url, cacheKey, ttl, options = {}) {
            // Check cache first
            const cached = apiCache.get(cacheKey);
            if (cached !== null) {
                console.log(`[Cache HIT] ${cacheKey}`);
                return cached;
            }
            
            console.log(`[Cache MISS] ${cacheKey} - Fetching from server...`);
            
            // Fetch from server
            const response = await fetch(url, options);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            // Store in cache
            apiCache.set(cacheKey, data, ttl);
            
            return data;
        }

        // Cache invalidation helpers - call these after data modifications
        function invalidateConfigCache() {
            apiCache.clear('admin:config');
            console.log('[Cache] Invalidated config cache');
        }

        function invalidateBlacklistCache() {
            apiCache.clear('admin:blacklist');
            console.log('[Cache] Invalidated blacklist cache');
        }

        function invalidateWhitelistCache() {
            apiCache.clear('admin:whitelist');
            console.log('[Cache] Invalidated whitelist cache');
        }

        function invalidateReportsCache() {
            apiCache.clear('admin:reports');
            console.log('[Cache] Invalidated reports cache');
        }

        function invalidateDefaultPromptsCache() {
            apiCache.clearPattern('admin:defaultPrompt:*');
            console.log('[Cache] Invalidated all default prompts cache');
        }

        function invalidateAILogsCache() {
            apiCache.clearPattern('admin:aiLogs:*');
            console.log('[Cache] Invalidated AI logs cache');
        }
        // ============================================================================
        // END OF CACHE SYSTEM
        // ============================================================================

        // Default prompts
        const DEFAULT_PLAN_PROMPT = `–¢–∏ —Å–∏ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω –¥–∏–µ—Ç–æ–ª–æ–≥ –∏ –∑–¥—Ä–∞–≤–µ–Ω –∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç. –°—ä–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–µ–Ω 7-–¥–Ω–µ–≤–µ–Ω —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω –∑–∞ –∫–ª–∏–µ–Ω—Ç —Å—ä—Å —Å–ª–µ–¥–Ω–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:

–û–°–ù–û–í–ù–ò –î–ê–ù–ù–ò:
- –ò–º–µ: {name}
- –ü–æ–ª: {gender}
- –í—ä–∑—Ä–∞—Å—Ç: {age} –≥–æ–¥–∏–Ω–∏
- –†—ä—Å—Ç: {height} —Å–º
- –¢–µ–≥–ª–æ: {weight} –∫–≥
- –¶–µ–ª: {goal}

–ó–î–†–ê–í–û–°–õ–û–í–ï–ù –ü–†–û–§–ò–õ:
- –°—ä–Ω: {sleepHours} —á–∞—Å–∞
- –•—Ä–æ–Ω–æ—Ç–∏–ø: {chronotype}
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç –ø—Ä–µ–∑ –¥–µ–Ω—è: {dailyActivityLevel}
- –°—Ç—Ä–µ—Å: {stressLevel}
- –°–ø–æ—Ä—Ç–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç: {sportActivity}

–•–†–ê–ù–ò–¢–ï–õ–ù–ò –ù–ê–í–ò–¶–ò:
- –í–æ–¥–∞: {waterIntake}
- –ü—Ä–µ–∫–æ–º–µ—Ä–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ: {overeatingFrequency}

–ü–†–ï–î–ü–û–ß–ò–¢–ê–ù–ò–Ø:
- –î–∏–µ—Ç–∏—á–Ω–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è: {dietPreference}
- –ù–µ –æ–±–∏—á–∞/–Ω–µ–ø–æ–Ω–æ—Å–∏–º–æ—Å—Ç: {dietDislike}
- –õ—é–±–∏–º–∏ —Ö—Ä–∞–Ω–∏: {dietLove}

–ú–ï–î–ò–¶–ò–ù–°–ö–ò –°–™–°–¢–û–Ø–ù–ò–Ø:
- –°—ä—Å—Ç–æ—è–Ω–∏—è: {medicalConditions}
- –õ–µ–∫–∞—Ä—Å—Ç–≤–∞: {medications}

–ú–æ–ª—è, –≤—ä—Ä–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç —Å weekPlan, recommendations, forbidden, psychology, waterIntake, supplements.
–í–∫–ª—é—á–∏ 3-5 —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –¥–µ–Ω –∑–∞ –≤—Å–µ–∫–∏ –æ—Ç 7-—Ç–µ –¥–Ω–∏.`;

        const DEFAULT_CHAT_PROMPT = `–¢–∏ —Å–∏ –ª–∏—á–µ–Ω –¥–∏–µ—Ç–æ–ª–æ–≥, –ø—Å–∏—Ö–æ–ª–æ–≥ –∏ –∑–¥—Ä–∞–≤–µ–Ω –∞—Å–∏—Å—Ç–µ–Ω—Ç –∑–∞ {name}.
–û—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∞ –∫–∞—Ç–æ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω –∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç. –ë—ä–¥–∏ —Ç–æ–ø—ä–ª, –ø–æ–¥–∫—Ä–µ–ø—è—â –∏ –º–æ—Ç–∏–≤–∏—Ä–∞—â.`;

        // Default prompts for all AI operations (extracted from worker.js)
        const DEFAULT_ANALYSIS_PROMPT = `–¢–∏ —Å–∏ –µ–∫—Å–ø–µ—Ä—Ç–µ–Ω –¥–∏–µ—Ç–æ–ª–æ–≥, –ø—Å–∏—Ö–æ–ª–æ–≥ –∏ –µ–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥. –ù–∞–ø—Ä–∞–≤–∏ –•–û–õ–ò–°–¢–ò–ß–ï–ù –ê–ù–ê–õ–ò–ó –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –ò–ó–ß–ò–°–õ–ò –∫–∞–ª–æ—Ä–∏–∏—Ç–µ –∏ –º–∞–∫—Ä–æ—Å–∏—Ç–µ.

‚ïê‚ïê‚ïê –ö–õ–ò–ï–ù–¢–°–ö–ò –ü–†–û–§–ò–õ ‚ïê‚ïê‚ïê
{userData}

‚ïê‚ïê‚ïê –ë–ê–ó–û–í–ê –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ó–ê –ò–ó–ß–ò–°–õ–ï–ù–ò–Ø ‚ïê‚ïê‚ïê
–û—Å–Ω–æ–≤–Ω–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (–∑–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è):
- –¢–µ–≥–ª–æ: {weight} –∫–≥
- –í–∏—Å–æ—á–∏–Ω–∞: {height} —Å–º
- –í—ä–∑—Ä–∞—Å—Ç: {age} –≥–æ–¥–∏–Ω–∏
- –ü–æ–ª: {gender}
- –¶–µ–ª: {goal}
{lossKg}

–í–ê–ñ–ù–û: –ò–∑–ø–æ–ª–∑–≤–∞–π Mifflin-St Jeor —Ñ–æ—Ä–º—É–ª–∞ –∫–∞—Ç–æ –û–¢–ü–†–ê–í–ù–ê –¢–û–ß–ö–ê, –Ω–æ –ê–ù–ê–õ–ò–ó–ò–†–ê–ô –•–û–õ–ò–°–¢–ò–ß–ù–û:
- –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—ä–Ω –∏ —Å—Ç—Ä–µ—Å
- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–∏–µ—Ç–∏ (–º–µ—Ç–∞–±–æ–ª–∏—Ç–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—è)
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Ñ–∞–∫—Ç–æ—Ä–∏ –∏ –µ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ
- –†–µ–∞–ª–µ–Ω –¥–Ω–µ–≤–µ–Ω —Ä–∏—Ç—ä–º –∏ —Ö—Ä–æ–Ω–æ—Ç–∏–ø
- –°—ä–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–ø–æ—Ä—Ç/–¥–Ω–µ–≤–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç

‚ïê‚ïê‚ïê –ù–ê–°–û–ö–ò –ó–ê –•–û–õ–ò–°–¢–ò–ß–ù–û –ò–ó–ß–ò–°–õ–ï–ù–ò–ï ‚ïê‚ïê‚ïê

–§–û–†–ú–£–õ–ê –ö–ê–¢–û –ë–ê–ó–ê:
- BMR: Mifflin-St Jeor (10√ó—Ç–µ–≥–ª–æ + 6.25√ó–≤–∏—Å–æ—á–∏–Ω–∞ - 5√ó–≤—ä–∑—Ä–∞—Å—Ç + 5/-161)
- TDEE: BMR √ó Activity Factor (1.2 –¥–æ 1.9 —Å–ø–æ—Ä–µ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç)
- –ö–∞–ª–æ—Ä–∏–∏: —Å–ø–æ—Ä–µ–¥ —Ü–µ–ª (–æ—Ç—Å–ª–∞–±–≤–∞–Ω–µ –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ —Å –¥–µ—Ñ–∏—Ü–∏—Ç, –º—É—Å–∫—É–ª–Ω–∞ –º–∞—Å–∞ —Å –∏–∑–ª–∏—à—ä–∫)

–ö–õ–Æ–ß–û–í–ò –§–ê–ö–¢–û–†–ò –ó–ê –ö–û–†–ï–ö–¶–ò–Ø:
- –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—ä–Ω –≤–ª–∏—è–µ –Ω–∞ —Ö–æ—Ä–º–æ–Ω–∏ –∏ –º–µ—Ç–∞–±–æ–ª–∏–∑—ä–º
- –°—Ç—Ä–µ—Å –≤–ª–∏—è–µ –Ω–∞ –∫–æ—Ä—Ç–∏–∑–æ–ª –∏ –µ–Ω–µ—Ä–≥–∏–π–Ω–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç
- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–∏–µ—Ç–∏ –º–æ–∂–µ –¥–∞ –æ–∑–Ω–∞—á–∞–≤–∞ –º–µ—Ç–∞–±–æ–ª–∏—Ç–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—è
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è (—â–∏—Ç–æ–≤–∏–¥–Ω–∞ –∂–ª–µ–∑–∞, –°–ü–ö–Ø, –¥–∏–∞–±–µ—Ç) –≤–ª–∏—è—è—Ç –Ω–∞ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Ñ–∞–∫—Ç–æ—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∏—Ç–µ –∏ —É—Å—Ç–æ–π—á–∏–≤–∏ —Ü–µ–ª–∏
- –•—Ä–æ–Ω–æ—Ç–∏–ø –∏ –¥–Ω–µ–≤–µ–Ω —Ä–∏—Ç—ä–º –≤–ª–∏—è—è—Ç –Ω–∞ –æ–ø—Ç–∏–º–∞–ª–Ω–æ—Ç–æ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

–ü–†–ò–ú–ï–† –ó–ê –ò–õ–Æ–°–¢–†–ê–¶–ò–Ø (–Ω–µ —Å–ª–µ–¥–≤–∞–π —Ç–æ—á–Ω–æ):
–ñ–µ–Ω–∞, 35–≥, 70–∫–≥, 165—Å–º, —Å—Ä–µ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç:
- –î–æ–±—ä—Ä –ø—Ä–æ—Ñ–∏–ª (–¥–æ–±—ä—Ä —Å—ä–Ω, –Ω–∏—Å—ä–∫ —Å—Ç—Ä–µ—Å, –±–µ–∑ –¥–∏–µ—Ç–∏): BMR‚âà1400, TDEE‚âà2160, –¶–µ–ª‚âà1840 kcal
- –ü—Ä–µ–¥–∏–∑–≤–∏–∫–∞—Ç–µ–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª (–ª–æ—à —Å—ä–Ω, –≤–∏—Å–æ–∫ —Å—Ç—Ä–µ—Å, 3 –¥–∏–µ—Ç–∏): BMR‚âà1180, TDEE‚âà1780, –¶–µ–ª‚âà1600 kcal
(–ó–∞–±–µ–ª–µ–∂–∫–∞: AI –º–æ–¥–µ–ª—ä—Ç –ø—Ä–µ—Ü–µ–Ω–∏ –ø–æ-–Ω–∏—Å—ä–∫ BMR/TDEE –∏ –ø–æ-–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–µ–Ω –¥–µ—Ñ–∏—Ü–∏—Ç –∑–∞—Ä–∞–¥–∏ –∫—É–º—É–ª–∞—Ç–∏–≤–Ω–∏—è –µ—Ñ–µ–∫—Ç)

‚ïê‚ïê‚ïê –¢–í–û–Ø–¢–ê –ó–ê–î–ê–ß–ê ‚ïê‚ïê‚ïê
1. –ê–ù–ê–õ–ò–ó–ò–†–ê–ô –•–û–õ–ò–°–¢–ò–ß–ù–û –≤—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏ –∑–∞ {name}
2. –ò–ó–ß–ò–°–õ–ò BMR, TDEE –∏ –ø—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ –∫–∞–ª–æ—Ä–∏–∏ –±–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ –¢–í–û–Ø–¢–ê –ü–†–û–§–ï–°–ò–û–ù–ê–õ–ù–ê –ü–†–ï–¶–ï–ù–ö–ê
3. –û–ë–Ø–°–ù–ò –¥–µ—Ç–∞–π–ª–Ω–æ –ó–ê–©–û —Å–∏ –∏–∑–±—Ä–∞–ª —Ç–æ—á–Ω–æ —Ç–µ–∑–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏
4. –ü–æ–∫–∞–∂–∏ –ª–æ–≥–∏–∫–∞—Ç–∞ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞—Ç–∞ –≤ reasoning –ø–æ–ª–µ—Ç–∞—Ç–∞

2. –ö–û–†–ï–õ–ê–¶–ò–û–ù–ï–ù –ê–ù–ê–õ–ò–ó:

**–°–™–ù ‚Üî –°–¢–†–ï–° ‚Üî –•–†–ê–ù–ï–ù–ï**: –ö–∞–∫ {sleepHours}—á —Å—ä–Ω (–ø—Ä–µ–∫—ä—Å–≤–∞–Ω: {sleepInterrupt}) + —Å—Ç—Ä–µ—Å ({stressLevel}) –≤–ª–∏—è—è—Ç –Ω–∞:
   - –•–æ—Ä–º–æ–Ω–∏ (–∫–æ—Ä—Ç–∏–∑–æ–ª, –≥—Ä–µ–ª–∏–Ω, –ª–µ–ø—Ç–∏–Ω)
   - –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –∂–µ–ª–∞–Ω–∏—è: {foodCravings}
   - –ü—Ä–µ–∫–æ–º–µ—Ä–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ: {overeatingFrequency}

**–ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò –ü–†–û–§–ò–õ**: –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –≤—Ä—ä–∑–∫–∞—Ç–∞ –µ–º–æ—Ü–∏–∏ ‚Üî —Ö—Ä–∞–Ω–µ–Ω–µ:
   - –¢—Ä–∏–≥–µ—Ä–∏: {foodTriggers}
   - –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏: {compensationMethods}
   - –°–æ—Ü–∏–∞–ª–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ: {socialComparison}
   - –û—Ü–µ–Ω–∫–∞ –Ω–∞ —Å–∞–º–æ–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è

**–ú–ï–¢–ê–ë–û–õ–ò–¢–ù–ò –û–°–û–ë–ï–ù–û–°–¢–ò**: –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞–π —É–Ω–∏–∫–∞–ª–µ–Ω –º–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª –±–∞–∑–∏—Ä–∞–Ω –Ω–∞:
   - –•—Ä–æ–Ω–æ—Ç–∏–ø ({chronotype}) ‚Üí –∫–æ–≥–∞ –µ –æ–ø—Ç–∏–º–∞–ª–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ—Ç–æ
   - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç ({sportActivity}, {dailyActivityLevel})
   - –ò—Å—Ç–æ—Ä–∏—è: {dietHistory}
   - –í–ê–ñ–ù–û: –ù–µ—É—Å–ø–µ—à–Ω–∏ –¥–∏–µ—Ç–∏ –≤ –º–∏–Ω–∞–ª–æ—Ç–æ –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –æ–∑–Ω–∞—á–∞–≤–∞—Ç –Ω–∞–º–∞–ª–µ–Ω –º–µ—Ç–∞–±–æ–ª–∏–∑—ä–º

**–ú–ï–î–ò–¶–ò–ù–°–ö–ò –§–ê–ö–¢–û–†–ò**: –ö–∞–∫ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è –≤–ª–∏—è—è—Ç –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ:
   - –°—ä—Å—Ç–æ—è–Ω–∏—è: {medicalConditions}
   - –õ–µ–∫–∞—Ä—Å—Ç–≤–∞: {medications}
   - –ö–∞–∫–≤–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –Ω—É–∂–¥–∏ –æ—Ç –º–∞–∫—Ä–æ/–º–∏–∫—Ä–æ–µ–ª–µ–º–µ–Ω—Ç–∏?

3. **–®–ê–ù–° –ó–ê –£–°–ü–ï–•**: –ò–∑—á–∏—Å–ª–∏ —É—Å–ø–µ—Ö score (-100 –¥–æ +100) –±–∞–∑–∏—Ä–∞–Ω –Ω–∞ –í–°–ò–ß–ö–ò —Ñ–∞–∫—Ç–æ—Ä–∏:
   - BMI –∏ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
   - –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—ä–Ω—è –∏ —Å—Ç—Ä–µ—Å
   - –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–∏–µ—Ç–∏ (–Ω–µ—É—Å–ø–µ—à–Ω–∏ –Ω–∞–º–∞–ª—è–≤–∞—Ç —à–∞–Ω—Å–∞ —Å 15-25 —Ç–æ—á–∫–∏)
   - –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç
   - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —É—Å–ª–æ–≤–∏—è –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç

4. **–ö–õ–Æ–ß–û–í–ò –ü–†–û–ë–õ–ï–ú–ò**: –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞–π 3-6 –ø—Ä–æ–±–ª–µ–º–Ω–∏ –æ–±–ª–∞—Å—Ç–∏ (–°–ê–ú–û Borderline/Risky/Critical severity):
   - –§–æ–∫—É—Å –Ω–∞ —Ñ–∞–∫—Ç–æ—Ä–∏ –∫–æ–∏—Ç–æ –ê–ö–¢–ò–í–ù–û –ø—Ä–µ—á–∞—Ç –Ω–∞ —Ü–µ–ª—Ç–∞
   - –ù–ï –≤–∫–ª—é—á–≤–∞–π "Normal" –ø—Ä–æ–±–ª–µ–º–∏

‚ïê‚ïê‚ïê –§–û–†–ú–ê–¢ –ù–ê –û–¢–ì–û–í–û–† ‚ïê‚ïê‚ïê
–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–ù–û - –¢–ò–ü–û–í–ï –î–ê–ù–ù–ò –ò –ò–ó–ß–ò–°–õ–ï–ù–ò–Ø:
- –ß–∏—Å–ª–æ–≤–∏ –ø–æ–ª–µ—Ç–∞ –¢–†–Ø–ë–í–ê –¥–∞ —Å—ä–¥—ä—Ä–∂–∞—Ç –°–ê–ú–û —á–∏—Å–ª–∞ (integer –∏–ª–∏ float)
- –ë–ï–ó —Ç–µ–∫—Å—Ç, –µ–¥–∏–Ω–∏—Ü–∏ –∏–∑–º–µ—Ä–≤–∞–Ω–µ –∏–ª–∏ –æ–±—è—Å–Ω–µ–Ω–∏—è –≤ —á–∏—Å–ª–æ–≤–∏—Ç–µ –ø–æ–ª–µ—Ç–∞
- –û–±—è—Å–Ω–µ–Ω–∏—è —Å–µ –ø–æ—Å—Ç–∞–≤—è—Ç –≤ –æ—Ç–¥–µ–ª–Ω–∏ "_reasoning" –ø–æ–ª–µ—Ç–∞
- BMR, TDEE, recommendedCalories - –¢–ò –≥–∏ –∏–∑—á–∏—Å–ª—è–≤–∞—à –±–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ –í–°–ò–ß–ö–ò –∫–æ—Ä–µ–ª–∞—Ç–∏!

{
  "bmr": —á–∏—Å–ª–æ (–¢–ò –∏–∑—á–∏—Å–ª—è–≤–∞—à —Ö–æ–ª–∏—Å—Ç–∏—á–Ω–æ),
  "bmrReasoning": "–æ–±—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∫ –∏ –∑–∞—â–æ —Å–∏ –∫–æ—Ä–∏–≥–∏—Ä–∞–ª –±–∞–∑–æ–≤–∞—Ç–∞ Mifflin-St Jeor —Ñ–æ—Ä–º—É–ª–∞",
  "tdee": —á–∏—Å–ª–æ (–¢–ò –∏–∑—á–∏—Å–ª—è–≤–∞—à —Ö–æ–ª–∏—Å—Ç–∏—á–Ω–æ),
  "tdeeReasoning": "–æ–±—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—Ç–∞, —Å—Ç—Ä–µ—Å—ä—Ç, —Å—ä–Ω—è –≤–ª–∏—è—è—Ç –Ω–∞ TDEE",
  "recommendedCalories": —á–∏—Å–ª–æ (–¢–ò –æ–ø—Ä–µ–¥–µ–ª—è—à –±–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ —Ü–µ–ª –∏ –∫–æ—Ä–µ–ª–∞—Ç–∏),
  "caloriesReasoning": "–æ–±—è—Å–Ω–µ–Ω–∏–µ –∑–∞—â–æ –¢–û–ß–ù–û —Ç–µ–∑–∏ –∫–∞–ª–æ—Ä–∏–∏ - –∫–∞–∫ —Ü–µ–ª—Ç–∞, —Å—Ç—Ä–µ—Å—ä—Ç, –∏—Å—Ç–æ—Ä–∏—è—Ç–∞ –Ω–∞ –¥–∏–µ—Ç–∏, –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞ –≤–ª–∏—è—è—Ç –Ω–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ—Ç–æ",
  "macroRatios": {
    "protein": —á–∏—Å–ª–æ (–ø—Ä–æ—Ü–µ–Ω—Ç, –Ω–∞–ø—Ä. 30),
    "carbs": —á–∏—Å–ª–æ (–ø—Ä–æ—Ü–µ–Ω—Ç, –Ω–∞–ø—Ä. 35),
    "fats": —á–∏—Å–ª–æ (–ø—Ä–æ—Ü–µ–Ω—Ç, –Ω–∞–ø—Ä. 35)
  },
  "macroRatiosReasoning": {
    "protein": "–æ–±–æ—Å–Ω–æ–≤–∫–∞ –∑–∞—â–æ —Ç–æ–∑–∏ –ø—Ä–æ—Ü–µ–Ω—Ç –µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω –∑–∞ {name}",
    "carbs": "–æ–±–æ—Å–Ω–æ–≤–∫–∞ –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è",
    "fats": "–æ–±–æ—Å–Ω–æ–≤–∫–∞ —Å–ø–æ—Ä–µ–¥ –Ω—É–∂–¥–∏"
  },
  "macroGrams": {
    "protein": —á–∏—Å–ª–æ (–≥—Ä–∞–º–æ–≤–µ –¥–Ω–µ–≤–Ω–æ),
    "carbs": —á–∏—Å–ª–æ (–≥—Ä–∞–º–æ–≤–µ –¥–Ω–µ–≤–Ω–æ),
    "fats": —á–∏—Å–ª–æ (–≥—Ä–∞–º–æ–≤–µ –¥–Ω–µ–≤–Ω–æ)
  },
  "weeklyBlueprint": {
    "skipBreakfast": boolean (true –∞–∫–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç –Ω–µ –∑–∞–∫—É—Å–≤–∞),
    "dailyMealCount": —á–∏—Å–ª–æ (–∫–æ–ª–∫–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –¥–µ–Ω, –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ 2-4),
    "mealCountReasoning": "–∑–∞—â–æ —Ç–æ–∑–∏ –±—Ä–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è –µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω",
    "dailyStructure": [
      {
        "dayIndex": 1,
        "meals": [
          {
            "type": "breakfast/lunch/dinner/snack",
            "active": boolean,
            "calorieTarget": —á–∏—Å–ª–æ (–∫–∞–ª–æ—Ä–∏–∏ –∑–∞ —Ç–æ–≤–∞ —Ö—Ä–∞–Ω–µ–Ω–µ),
            "proteinSource": "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω –æ—Å–Ω–æ–≤–µ–Ω –ø—Ä–æ—Ç–µ–∏–Ω (–Ω–∞–ø—Ä. chicken, fish, eggs)",
            "carbSource": "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω –≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç (–Ω–∞–ø—Ä. quinoa, rice, vegetables)"
          }
        ]
      }
      // ... –ø–æ–≤—Ç–æ—Ä–µ—Ç–µ –∑–∞ –≤—Å–∏—á–∫–∏ 7 –¥–Ω–∏
    ]
  },
  "metabolicProfile": "–£–ù–ò–ö–ê–õ–ï–ù –º–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª - –æ–ø–∏—à–∏ –∫–∞–∫ —Ö—Ä–æ–Ω–æ—Ç–∏–ø, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç, –∏—Å—Ç–æ—Ä–∏—è –≤–ª–∏—è—è—Ç –Ω–∞ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞",
  "healthRisks": ["—Ä–∏—Å–∫ 1 —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –∑–∞ –ø—Ä–æ—Ñ–∏–ª–∞", "—Ä–∏—Å–∫ 2", "—Ä–∏—Å–∫ 3"],
  "nutritionalNeeds": ["–Ω—É–∂–¥–∞ 1 –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑–∞", "–Ω—É–∂–¥–∞ 2", "–Ω—É–∂–¥–∞ 3"],
  "psychologicalProfile": "–î–ï–¢–ê–ô–õ–ï–ù –∞–Ω–∞–ª–∏–∑: –µ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ, —Ç—Ä–∏–≥–µ—Ä–∏, –∫–æ–ø–∏–Ω–≥ –º–µ—Ö–∞–Ω–∏–∑–º–∏, –º–æ—Ç–∏–≤–∞—Ü–∏—è",
  "successChance": —á–∏—Å–ª–æ (-100 –¥–æ 100),
  "successChanceReasoning": "–∑–∞—â–æ —Ç–æ–∑–∏ —à–∞–Ω—Å - –∫–æ–∏ —Ñ–∞–∫—Ç–æ—Ä–∏ –ø–æ–º–∞–≥–∞—Ç –∏ –∫–æ–∏ –ø—Ä–µ—á–∞—Ç",
  "keyProblems": [
    {
      "title": "–∫—Ä–∞—Ç–∫–æ –∏–º–µ (2-4 –¥—É–º–∏)",
      "description": "–∑–∞—â–æ –µ –ø—Ä–æ–±–ª–µ–º –∏ –¥–æ –∫–∞–∫–≤–æ –≤–æ–¥–∏",
      "severity": "Borderline / Risky / Critical",
      "severityValue": —á–∏—Å–ª–æ 0-100,
      "category": "Sleep / Nutrition / Hydration / Stress / Activity / Medical",
      "impact": "–≤—ä–∑–¥–µ–π—Å—Ç–≤–∏–µ –≤—ä—Ä—Ö—É –∑–¥—Ä–∞–≤–µ—Ç–æ –∏–ª–∏ —Ü–µ–ª—Ç–∞"
    }
  ]
}

–í–ê–ñ–ù–ò –ü–†–ê–í–ò–õ–ê –ó–ê weeklyBlueprint:
1. –°–±–æ—Ä—ä—Ç –Ω–∞ calorieTarget –∑–∞ –≤—Å–∏—á–∫–∏ –∞–∫—Ç–∏–≤–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –µ–¥–∏–Ω –¥–µ–Ω –¢–†–Ø–ë–í–ê –¥–∞ –µ —Ä–∞–≤–µ–Ω –Ω–∞ —Ç–≤–æ–∏—Ç–µ –∏–∑—á–∏—Å–ª–µ–Ω–∏ recommendedCalories
2. –ê–∫–æ skipBreakfast –µ true, "breakfast" —Ö—Ä–∞–Ω–µ–Ω–∏—è –¢–†–Ø–ë–í–ê –¥–∞ –∏–º–∞—Ç active: false –∏ calorieTarget: 0
3. –í–∞—Ä–∏—Ä–∞–π proteinSource –∏ carbSource –º–µ–∂–¥—É –¥–Ω–∏—Ç–µ –∑–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
4. –¢–∏–ø–æ–≤–µ—Ç–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ–Ω —Ä–µ–¥: breakfast -> lunch -> snack -> dinner
5. –ò–∑–ø–æ–ª–∑–≤–∞–π dailyMealCount –∑–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç –ø—Ä–µ–∑ —Ü—è–ª–∞—Ç–∞ —Å–µ–¥–º–∏—Ü–∞ (–æ—Å–≤–µ–Ω –∞–∫–æ –Ω—è–º–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –∑–∞ –≤–∞—Ä–∏–∞—Ü–∏—è)

–ë—ä–¥–∏ –ö–û–ù–ö–†–ï–¢–ï–ù –∑–∞ {name}. –ò–∑–±—è–≥–≤–∞–π –æ–±—â–∏ —Ñ—Ä–∞–∑–∏ –∫–∞—Ç–æ "–¥–æ–±—ä—Ä –º–µ—Ç–∞–±–æ–ª–∏–∑—ä–º" - –æ–±—è—Å–Ω–∏ –ó–ê–©–û –∏ –ö–ê–ö!`;

        const DEFAULT_STRATEGY_PROMPT = `–ë–∞–∑–∏—Ä–∞–π–∫–∏ —Å–µ –Ω–∞ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª –∏ –∞–Ω–∞–ª–∏–∑–∞, –æ–ø—Ä–µ–¥–µ–ª–∏ –æ–ø—Ç–∏–º–∞–ª–Ω–∞—Ç–∞ –¥–∏–µ—Ç–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

–ö–õ–ò–ï–ù–¢: {name}, {age} –≥–æ–¥., –¶–µ–ª: {goal}

–ê–ù–ê–õ–ò–ó (–ö–û–ú–ü–ê–ö–¢–ï–ù):
- BMR/TDEE/–ö–∞–ª–æ—Ä–∏–∏: {bmr} / {tdee} / {recommendedCalories}
- –ú–∞–∫—Ä–æ —Å—ä–æ—Ç–Ω–æ—à–µ–Ω–∏—è: {macroRatios}
- –ú–∞–∫—Ä–æ –≥—Ä–∞–º–æ–≤–µ –¥–Ω–µ–≤–Ω–æ: {macroGrams}
{weeklyBlueprint}
- –ú–µ—Ç–∞–±–æ–ª–∏—Ç–µ–Ω –ø—Ä–æ—Ñ–∏–ª: {metabolicProfile}
- –ó–¥—Ä–∞–≤–Ω–∏ —Ä–∏—Å–∫–æ–≤–µ: {healthRisks}
- –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –Ω—É–∂–¥–∏: {nutritionalNeeds}
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ñ–∏–ª: {psychologicalProfile}
- –®–∞–Ω—Å –∑–∞ —É—Å–ø–µ—Ö: {successChance}
- –ö–ª—é—á–æ–≤–∏ –ø—Ä–æ–±–ª–µ–º–∏: {keyProblems}

–ü–†–ï–î–ü–û–ß–ò–¢–ê–ù–ò–Ø:
- –î–∏–µ—Ç–∏—á–Ω–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è: {dietPreference}
- –ù–µ –æ–±–∏—á–∞/–Ω–µ–ø–æ–Ω–æ—Å–∏–º–æ—Å—Ç: {dietDislike}
- –õ—é–±–∏–º–∏ —Ö—Ä–∞–Ω–∏: {dietLove}

–í–ê–ñ–ù–û: –í–∑–µ–º–∏ –ø—Ä–µ–¥–≤–∏–¥ –í–°–ò–ß–ö–ò –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ö–æ–ª–∏—Å—Ç–∏—á–Ω–æ –∏ —Å—ä–∑–¥–∞–π –ö–û–†–ï–õ–ê–¶–ò–ò –º–µ–∂–¥—É —Ç—è—Ö:
1. –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ç–µ —Å—ä—Å—Ç–æ—è–Ω–∏—è –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ - –∫–∞–∫ –≤–ª–∏—è—è—Ç –Ω–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏—Ç–µ –Ω—É–∂–¥–∏
2. –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏—Ç–µ –Ω–µ–ø–æ–Ω–æ—Å–∏–º–æ—Å—Ç–∏ –∏ –∞–ª–µ—Ä–≥–∏–∏ - —Å—Ç—Ä–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
3. –õ–∏—á–Ω–∏—Ç–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è –∏ –ª—é–±–∏–º–∏ —Ö—Ä–∞–Ω–∏ - –∑–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç
4. –•—Ä–æ–Ω–æ—Ç–∏–ø–∞ –∏ –¥–Ω–µ–≤–Ω–∏—è —Ä–∏—Ç—ä–º - –æ–ø—Ç–∏–º–∞–ª–Ω–æ –≤—Ä–µ–º–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ
5. –ù–∏–≤–æ—Ç–æ –Ω–∞ —Å—Ç—Ä–µ—Å –∏ –µ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–æ—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–µ - –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ –ø–æ–¥–∫—Ä–µ–ø–∞
6. –ö—É–ª—Ç—É—Ä–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç (–±—ä–ª–≥–∞—Ä—Å–∫–∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏ –∏ –Ω–∞–ª–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏)
7. –ö–û–†–ï–õ–ê–¶–ò–ò –º–µ–∂–¥—É —Å—ä–Ω, —Å—Ç—Ä–µ—Å –∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –∂–µ–ª–∞–Ω–∏—è
8. –í–†–™–ó–ö–ê–¢–ê –º–µ–∂–¥—É —Ñ–∏–∑–∏—á–µ—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç –∏ –∫–∞–ª–æ—Ä–∏–π–Ω–∏ –Ω—É–∂–¥–∏
9. –í–ó–ê–ò–ú–û–í–†–™–ó–ö–ê–¢–ê –º–µ–∂–¥—É –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è –∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏

–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–ù–û - –ò–ù–î–ò–í–ò–î–£–ê–õ–ò–ó–ê–¶–ò–Ø –ù–ê –í–°–ò–ß–ö–ò –ü–†–ï–ü–û–†–™–ö–ò:
1. –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏—Ç–µ –¥–æ–±–∞–≤–∫–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –°–¢–†–û–ì–û –ò–ù–î–ò–í–ò–î–£–ê–õ–ù–û –ø–æ–¥–±—Ä–∞–Ω–∏ –∑–∞ {name}
2. –ó–ê–ë–†–ê–ù–ï–ù–û –µ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∏/–æ–±—â–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –¥–æ–±–∞–≤–∫–∏
3. –í—Å—è–∫–∞ –¥–æ–±–∞–≤–∫–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∞ —Å –ö–û–ù–ö–†–ï–¢–ù–ò –Ω—É–∂–¥–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞
4. –î–æ–∑–∏—Ä–æ–≤–∫–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Å–ø–æ—Ä–µ–¥ –≤—ä–∑—Ä–∞—Å—Ç, —Ç–µ–≥–ª–æ, –ø–æ–ª –∏ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
5. –í–∑–µ–º–∏ –ø—Ä–µ–¥–≤–∏–¥ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏ –≤—ä–∑–º–æ–∂–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
6. –ö–†–ò–¢–ò–ß–ù–û - –ü–†–û–í–ï–†–ö–ê –ó–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:
   - –ê–∫–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç –ø—Ä–∏–µ–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞: {medications}, –ø—Ä–æ–≤–µ—Ä–∏:
     * –í–∏—Ç–∞–º–∏–Ω –ö + –∞–Ω—Ç–∏–∫–æ–∞–≥—É–ª–∞–Ω—Ç–∏ (–≤–∞—Ä—Ñ–∞—Ä–∏–Ω) = –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–æ
     * –ö–∞–ª—Ü–∏–π/–ú–∞–≥–Ω–µ–∑–∏–π + –∞–Ω—Ç–∏–±–∏–æ—Ç–∏—Ü–∏ = –Ω–∞–º–∞–ª–µ–Ω–æ —É—Å–≤–æ—è–≤–∞–Ω–µ
     * –ñ–µ–ª—è–∑–æ + –∞–Ω—Ç–∞—Ü–∏–¥–∏ = –±–ª–æ–∫–∏—Ä–∞–Ω–æ —É—Å–≤–æ—è–≤–∞–Ω–µ
     * –í–∏—Ç–∞–º–∏–Ω D + –∫–æ—Ä—Ç–∏–∫–æ—Å—Ç–µ—Ä–æ–∏–¥–∏ = –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø–æ-–≤–∏—Å–æ–∫–∞ –¥–æ–∑–∞
   - –ê–∫–æ –∏–º–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è: {medicalConditions}, —Å—ä–æ–±—Ä–∞–∑–∏:
     * –î–∏–∞–±–µ—Ç: –•—Ä–æ–º, –í–∏—Ç–∞–º–∏–Ω D, –û–º–µ–≥–∞-3 (–∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –∫—Ä—ä–≤–Ω–∞ –∑–∞—Ö–∞—Ä)
     * –•–∏–ø–µ—Ä—Ç–æ–Ω–∏—è: –ú–∞–≥–Ω–µ–∑–∏–π, –ö–∞–ª–∏–π, CoQ10 (–ø–æ–Ω–∏–∂–∞–≤–∞–Ω–µ –Ω–∞ –Ω–∞–ª—è–≥–∞–Ω–µ)
     * –©–∏—Ç–æ–≤–∏–¥–Ω–∞ –∂–ª–µ–∑–∞: –°–µ–ª–µ–Ω, –ô–æ–¥ (—Å–∞–º–æ –∞–∫–æ –µ –¥–µ—Ñ–∏—Ü–∏—Ç!), –¶–∏–Ω–∫
     * –ê–Ω–µ–º–∏—è: –ñ–µ–ª—è–∑–æ (—Ö–µ–º–æ–≤–æ –∑–∞ –ø–æ-–¥–æ–±—Ä–æ —É—Å–≤–æ—è–≤–∞–Ω–µ), –í–∏—Ç–∞–º–∏–Ω C (–ø–æ–¥–ø–æ–º–∞–≥–∞ —É—Å–≤–æ—è–≤–∞–Ω–µ—Ç–æ), B12
     * PCOS/–°–ü–ö–Ø: –ò–Ω–æ–∑–∏—Ç–æ–ª, –í–∏—Ç–∞–º–∏–Ω D, –û–º–µ–≥–∞-3, –•—Ä–æ–º
     * IBS/IBD: –ü—Ä–æ–±–∏–æ—Ç–∏—Ü–∏ (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ —â–∞–º–æ–≤–µ), –í–∏—Ç–∞–º–∏–Ω D, –û–º–µ–≥–∞-3
7. –ò–ù–î–ò–í–ò–î–£–ê–õ–ù–ê –î–û–ó–ò–†–û–í–ö–ê –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞:
   - –¢–µ–≥–ª–æ: {weight} –∫–≥ (–ø–æ-–≤–∏—Å–æ–∫–æ —Ç–µ–≥–ª–æ = –ø–æ-–≤–∏—Å–æ–∫–∞ –¥–æ–∑–∞ –∑–∞ –ª–∏–ø–æ—Ä–∞–∑—Ç–≤–æ—Ä–∏–º–∏ –≤–∏—Ç–∞–º–∏–Ω–∏)
   - –í—ä–∑—Ä–∞—Å—Ç: {age} –≥–æ–¥. (–ø–æ-–≤—ä–∑—Ä–∞—Å—Ç–Ω–∏ = –ø–æ-–≤–∏—Å–æ–∫–∏ –Ω—É–∂–¥–∏ –æ—Ç –í–∏—Ç–∞–º–∏–Ω D, B12, –ö–∞–ª—Ü–∏–π)
   - –ü–æ–ª: {gender} (–∂–µ–Ω–∏ = –ø–æ–≤–µ—á–µ –∂–µ–ª—è–∑–æ –ø—Ä–∏ –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏—è; –º—ä–∂–µ = –ø–æ–≤–µ—á–µ —Ü–∏–Ω–∫)
   - –°—ä–Ω: {sleepHours}—á (–ø–æ–¥ 7—á = –ú–∞–≥–Ω–µ–∑–∏–π –∑–∞ —Å—ä–Ω, –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω)
   - –°—Ç—Ä–µ—Å: {stressLevel} (–≤–∏—Å–æ–∫ —Å—Ç—Ä–µ—Å = –ú–∞–≥–Ω–µ–∑–∏–π, –í–∏—Ç–∞–º–∏–Ω–∏ B-–∫–æ–º–ø–ª–µ–∫—Å, –ê—à–≤–∞–≥–∞–Ω–¥–∞)
   - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç: {sportActivity} (–≤–∏—Å–æ–∫–∞ = –ü—Ä–æ—Ç–µ–∏–Ω, BCAA, –ö—Ä–µ–∞—Ç–∏–Ω, –í–∏—Ç–∞–º–∏–Ω D)

–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–ù–û - –û–ü–†–ï–î–ï–õ–Ø–ù–ï –ù–ê –ú–û–î–ò–§–ò–ö–ê–¢–û–†:
–°–ª–µ–¥ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –æ–ø—Ä–µ–¥–µ–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â –ú–û–î–ò–§–ò–ö–ê–¢–û–† (–¥–∏–µ—Ç–∏—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª), –∫–æ–π—Ç–æ —â–µ —É–ø—Ä–∞–≤–ª—è–≤–∞ –ª–æ–≥–∏–∫–∞—Ç–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —è—Å—Ç–∏—è:
- –ú–æ–∂–µ –¥–∞ –±—ä–¥–µ —Ç–µ—Ä–º–∏–Ω: "–ö–µ—Ç–æ", "–ü–∞–ª–µ–æ", "–í–µ–≥–∞–Ω", "–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ", "–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–æ", "–ù–∏—Å–∫–æ–≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–Ω–æ", "–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–æ", "–©–∞–¥—è—â —Å—Ç–æ–º–∞—Ö", "–ë–µ–∑ –≥–ª—É—Ç–µ–Ω" –∏ –¥—Ä.
- –ú–û–î–ò–§–ò–ö–ê–¢–û–†–™–¢ —Ç—Ä—è–±–≤–∞ –¥–∞ –æ—Ç—á–∏—Ç–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ç–µ —Å—ä—Å—Ç–æ—è–Ω–∏—è, —Ü–µ–ª–∏, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è –∏ –≤—Å–∏—á–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Ñ–∞–∫—Ç–æ—Ä–∏
- –û–ø—Ä–µ–¥–µ–ª–∏ –ï–î–ù–ê –æ—Å–Ω–æ–≤–Ω–∞ –¥–∏–µ—Ç–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∫–æ—è—Ç–æ –µ –Ω–∞–π-–ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ –∫–ª–∏–µ–Ω—Ç–∞
- –ê–∫–æ –Ω—è–º–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∏–∑–ø–æ–ª–∑–≤–∞–π "–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–æ" –∏–ª–∏ "–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–æ"

–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –ó–ê–î–™–õ–ë–û–ß–ï–ù–û –∫–∞–∫ –≤—Å–µ–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—ä—Ä –≤–ª–∏—è–µ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∞ —Å –¥—Ä—É–≥–∏—Ç–µ.

–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–ù–û - –î–™–õ–ì–û–°–†–û–ß–ù–ê –°–¢–†–ê–¢–ï–ì–ò–Ø:
1. –°—ä–∑–¥–∞–π –Ø–°–ù–ê –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ –ø–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ —Ü–µ–ª–∏—Ç–µ –Ω–∞ {name}
2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –æ–±—Ö–≤–∞—â–∞ –Ω–µ —Å–∞–º–æ –¥–Ω–µ–≤–µ–Ω, –Ω–æ –∏ –°–ï–î–ú–ò–ß–ï–ù/–ú–ù–û–ì–û–î–ù–ï–í–ï–ù —Ö–æ—Ä–∏–∑–æ–Ω—Ç
3. –ü—Ä–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∞ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–Ω–∞, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ –∏–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞ –∏–¥–µ—è:
   - –ü–ª–∞–Ω–∏—Ä–∞–Ω–µ—Ç–æ –º–æ–∂–µ –¥–∞ –æ–±—Ö–≤–∞—â–∞ 2-3 –¥–Ω–∏ –∫–∞—Ç–æ —Ü—è–ª–æ
   - –•–æ—Ä–∏–∑–æ–Ω—Ç—ä—Ç –Ω–∞ –º–∞–∫—Ä–æ—Å–∏ –∏ –∫–∞–ª–æ—Ä–∏–∏ –ù–ï –ï –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û 24 —á–∞—Å–∞
   - –ú–æ–∂–µ –¥–∞ –∏–º–∞ —Ü–∏–∫–ª–∏—á–Ω–æ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞–ª–æ—Ä–∏–∏/–º–∞–∫—Ä–æ—Å–∏ (–Ω–∞–ø—Ä. –Ω–∏—Å–∫–æ-–≤–∏—Å–æ–∫–∏ –¥–Ω–∏)
4. –û–±–æ—Å–Ω–æ–≤–∏ –ó–ê–©–û –∏–∑–±–∏—Ä–∞—à –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –±—Ä–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è (1-5) –∑–∞ –≤—Å–µ–∫–∏ –¥–µ–Ω
5. –û–±–æ—Å–Ω–æ–≤–∏ –ó–ê–©–û –∏ –ö–û–ì–ê —Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è (–∞–∫–æ –∏–º–∞ —Ç–∞–∫–∏–≤–∞)
6. –í—Å—è–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø—Ä–µ–ø–æ—Ä—ä–∫–∞ –¢–†–Ø–ë–í–ê –¥–∞ –∏–º–∞ —è—Å–Ω–∞ —Ü–µ–ª –∏ –æ–±–æ—Å–Ω–æ–≤–∫–∞

–í—ä—Ä–Ω–∏ JSON —Å—ä—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–ë–ï–ó —É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏):
{
  "dietaryModifier": "—Ç–µ—Ä–º–∏–Ω –∑–∞ –æ—Å–Ω–æ–≤–µ–Ω –¥–∏–µ—Ç–∏—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª (–Ω–∞–ø—Ä. –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–æ, –ö–µ—Ç–æ, –í–µ–≥–∞–Ω, –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–æ, –ù–∏—Å–∫–æ–≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–Ω–æ, –©–∞–¥—è—â —Å—Ç–æ–º–∞—Ö)",
  "modifierReasoning": "–î–µ—Ç–∞–π–ª–Ω–æ –æ–±—è—Å–Ω–µ–Ω–∏–µ –∑–∞—â–æ —Ç–æ–∑–∏ –ú–û–î–ò–§–ò–ö–ê–¢–û–† –µ –∏–∑–±—Ä–∞–Ω –°–ü–ï–¶–ò–§–ò–ß–ù–û –∑–∞ {name}",
  "welcomeMessage": "–ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –ü–û–õ–ï: –ü–ï–†–°–û–ù–ê–õ–ò–ó–ò–†–ê–ù–û –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞ {name} –ø—Ä–∏ –ø—ä—Ä–≤–æ—Ç–æ —Ä–∞–∑–≥–ª–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–∞. –¢–æ–Ω—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω, –Ω–æ —Ç–æ–ø—ä–ª –∏ –º–æ—Ç–∏–≤–∏—Ä–∞—â. –í–∫–ª—é—á–∏: 1) –ü–µ—Ä—Å–æ–Ω–∞–ª–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∏–º–µ, 2) –ö—Ä–∞—Ç–∫–æ —Å–ø–æ–º–µ–Ω–∞–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Ñ–∞–∫—Ç–æ—Ä–∏ –æ—Ç –ø—Ä–æ—Ñ–∏–ª–∞ (–≤—ä–∑—Ä–∞—Å—Ç, —Ü–µ–ª, –∫–ª—é—á–æ–≤–∏ –ø—Ä–µ–¥–∏–∑–≤–∏–∫–∞—Ç–µ–ª—Å—Ç–≤–∞), 3) –ö–∞–∫ –ø–ª–∞–Ω—ä—Ç –µ —Å—ä–∑–¥–∞–¥–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–Ω–æ –∑–∞ —Ç–µ—Ö–Ω–∏—Ç–µ –Ω—É–∂–¥–∏, 4) –ü–æ–ª–æ–∂–∏—Ç–µ–ª–Ω–∞ –≤–∏–∑–∏—è –∑–∞ –ø–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ —Ü–µ–ª–∏—Ç–µ. –î—ä–ª–∂–∏–Ω–∞: 150-250 –¥—É–º–∏. –í–ê–ñ–ù–û: –ò–∑–±—è–≥–≤–∞–π –≥–µ–Ω–µ—Ä–∏—á–Ω–∏ —Ñ—Ä–∞–∑–∏ - –∏–∑–ø–æ–ª–∑–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –¥–µ—Ç–∞–π–ª–∏ –∑–∞ {name}.",
  "planJustification": "–ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –ü–û–õ–ï: –î–µ—Ç–∞–π–ª–Ω–∞ –æ–±–æ—Å–Ω–æ–≤–∫–∞ –Ω–∞ —Ü—è–ª–æ—Å—Ç–Ω–∞—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –±—Ä–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è, –≤—Ä–µ–º–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ, —Ü–∏–∫–ª–∏—á–Ω–æ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–∞–∫–æ –∏–º–∞), —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è (–∞–∫–æ –∏–º–∞), –∏ –ó–ê–©–û —Ç–∞–∑–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –µ –æ–ø—Ç–∏–º–∞–ª–Ω–∞ –∑–∞ {name}. –ú–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–∞.",
  "longTermStrategy": "–î–™–õ–ì–û–°–†–û–ß–ù–ê –°–¢–†–ê–¢–ï–ì–ò–Ø: –û–ø–∏—à–∏ –∫–∞–∫ –ø–ª–∞–Ω—ä—Ç —Ä–∞–±–æ—Ç–∏ –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ 2-3 –¥–Ω–∏/—Å–µ–¥–º–∏—Ü–∞, –Ω–µ —Å–∞–º–æ –Ω–∞ –¥–Ω–µ–≤–Ω–∞ –±–∞–∑–∞. –í–∫–ª—é—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ü–∏–∫–ª–∏—á–Ω–æ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞–ª–æ—Ä–∏–∏/–º–∞–∫—Ä–æ—Å–∏, –≤–∞—Ä–∏–∏—Ä–∞–Ω–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è, –∏ –∫–∞–∫ —Ç–æ–≤–∞ –ø–æ–¥–ø–æ–º–∞–≥–∞ —Ü–µ–ª–∏—Ç–µ.",
  "mealCountJustification": "–û–ë–û–°–ù–û–í–ö–ê –ó–ê –ë–†–û–ô –•–†–ê–ù–ï–ù–ò–Ø: –ó–∞—â–æ –µ –∏–∑–±—Ä–∞–Ω —Ç–æ—á–Ω–æ —Ç–æ–∑–∏ –±—Ä–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è (1-5) –∑–∞ –≤—Å–µ–∫–∏ –¥–µ–Ω. –ö–∞–∫–≤–∞ –µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—Ç–∞, —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–Ω–∞ –∏–ª–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ –ø—Ä–∏—á–∏–Ω–∞.",
  "afterDinnerMealJustification": "–û–ë–û–°–ù–û–í–ö–ê –ó–ê –•–†–ê–ù–ï–ù–ò–Ø –°–õ–ï–î –í–ï–ß–ï–†–Ø: –ê–∫–æ –∏–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è, –æ–±—è—Å–Ω–∏ –ó–ê–©–û —Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏, –∫–∞–∫–≤–∞ –µ —Ü–µ–ª—Ç–∞, –∏ –∫–∞–∫ –ø–æ–¥–ø–æ–º–∞–≥–∞—Ç –æ–±—â–∞—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è. –ê–∫–æ –Ω—è–º–∞ - –Ω–∞–ø–∏—à–∏ '–ù–µ —Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏'.",
  "dietType": "—Ç–∏–ø –¥–∏–µ—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –∑–∞ {name} (–Ω–∞–ø—Ä. —Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∞, –±–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–∞, –Ω–∏—Å–∫–æ-–≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–Ω–∞)",
  "weeklyMealPattern": "–•–û–õ–ò–°–¢–ò–ß–ù–ê —Å–µ–¥–º–∏—á–Ω–∞ —Å—Ö–µ–º–∞ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ (–Ω–∞–ø—Ä. '16:8 –∏–Ω—Ç–µ—Ä–º–∏—Ç–µ–Ω—Ç–Ω–æ –≥–ª–∞–¥—É–≤–∞–Ω–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ', '5:2 –ø–æ–¥—Ö–æ–¥', '—Ü–∏–∫–ª–∏—á–Ω–æ —Ñ–∞—Å—Ç–∏–Ω–≥', '—Å–≤–æ–±–æ–¥–µ–Ω —É–∏–∫–µ–Ω–¥', –∏–ª–∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞ —Å—Ö–µ–º–∞ —Å –≤–∞—Ä–∏–∏—Ä–∞—â–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è)",
  "mealTiming": {
    "pattern": "—Å–µ–¥–º–∏—á–µ–Ω –º–æ–¥–µ–ª –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ –æ–ø–∏—Å–∞–Ω –¥–µ—Ç–∞–π–ª–Ω–æ - –Ω–∞–ø—Ä. '–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫-–ü–µ—Ç—ä–∫: 2 —Ö—Ä–∞–Ω–µ–Ω–∏—è (12:00, 19:00), –°—ä–±–æ—Ç–∞-–ù–µ–¥–µ–ª—è: 3 —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –µ–¥–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ'",
    "fastingWindows": "–ø–µ—Ä–∏–æ–¥–∏ –Ω–∞ –≥–ª–∞–¥—É–≤–∞–Ω–µ –∞–∫–æ —Å–µ –ø—Ä–∏–ª–∞–≥–∞ (–Ω–∞–ø—Ä. '16 —á–∞—Å–∞ –º–µ–∂–¥—É –ø–æ—Å–ª–µ–¥–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ –∏ —Å–ª–µ–¥–≤–∞—â–æ', –∏–ª–∏ '–Ω–µ —Å–µ –ø—Ä–∏–ª–∞–≥–∞')",
    "flexibility": "–æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≥—ä–≤–∫–∞–≤–æ—Å—Ç—Ç–∞ –≤ —Å—Ö–µ–º–∞—Ç–∞ —Å–ø–æ—Ä–µ–¥ –¥–Ω–∏—Ç–µ –∏ –Ω—É–∂–¥–∏—Ç–µ"
  },
  "keyPrinciples": ["–ø—Ä–∏–Ω—Ü–∏–ø 1 —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –∑–∞ {name}", "–ø—Ä–∏–Ω—Ü–∏–ø 2 —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –∑–∞ {name}", "–ø—Ä–∏–Ω—Ü–∏–ø 3 —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –∑–∞ {name}"],
  "foodsToInclude": ["—Ö—Ä–∞–Ω–∞ 1 –ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ {name}", "—Ö—Ä–∞–Ω–∞ 2 –ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ {name}", "—Ö—Ä–∞–Ω–∞ 3 –ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ {name}"],
  "foodsToAvoid": ["—Ö—Ä–∞–Ω–∞ 1 –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ {name}", "—Ö—Ä–∞–Ω–∞ 2 –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ {name}", "—Ö—Ä–∞–Ω–∞ 3 –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∞ –∑–∞ {name}"],
  "supplementRecommendations": [
    "! –ò–ù–î–ò–í–ò–î–£–ê–õ–ù–ê –¥–æ–±–∞–≤–∫–∞ 1 –∑–∞ {name} - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –¥–æ–±–∞–≤–∫–∞ —Å –¥–æ–∑–∏—Ä–æ–≤–∫–∞ –∏ –æ–±–æ—Å–Ω–æ–≤–∫–∞ –∑–∞—â–æ –ï –ù–£–ñ–ù–ê –∑–∞ —Ç–æ–∑–∏ –∫–ª–∏–µ–Ω—Ç (–ë–ê–ó–ò–†–ê–ù–ê –Ω–∞: –≤—ä–∑—Ä–∞—Å—Ç {age} –≥–æ–¥., –ø–æ–ª {gender}, —Ü–µ–ª {goal}, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è {medicalConditions})",
    "! –ò–ù–î–ò–í–ò–î–£–ê–õ–ù–ê –¥–æ–±–∞–≤–∫–∞ 2 –∑–∞ {name} - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –¥–æ–±–∞–≤–∫–∞ —Å –¥–æ–∑–∏—Ä–æ–≤–∫–∞ –∏ –æ–±–æ—Å–Ω–æ–≤–∫–∞ –∑–∞—â–æ –ï –ù–£–ñ–ù–ê –∑–∞ —Ç–æ–∑–∏ –∫–ª–∏–µ–Ω—Ç (–ë–ê–ó–ò–†–ê–ù–ê –Ω–∞: –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç {sportActivity}, —Å—ä–Ω {sleepHours}—á, —Å—Ç—Ä–µ—Å {stressLevel})",
    "! –ò–ù–î–ò–í–ò–î–£–ê–õ–ù–ê –¥–æ–±–∞–≤–∫–∞ 3 –∑–∞ {name} - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –¥–æ–±–∞–≤–∫–∞ —Å –¥–æ–∑–∏—Ä–æ–≤–∫–∞ –∏ –æ–±–æ—Å–Ω–æ–≤–∫–∞ –∑–∞—â–æ –ï –ù–£–ñ–ù–ê –∑–∞ —Ç–æ–∑–∏ –∫–ª–∏–µ–Ω—Ç (–ë–ê–ó–ò–†–ê–ù–ê –Ω–∞: —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –Ω–∞–≤–∏—Ü–∏ {eatingHabits}, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è {dietPreference})"
  ],
  "hydrationStrategy": "–ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –ø—Ä–∏–µ–º –Ω–∞ —Ç–µ—á–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞ {name} —Å–ø–æ—Ä–µ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç –∏ –∫–ª–∏–º–∞—Ç",
  "psychologicalSupport": [
    "! –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Å—ä–≤–µ—Ç 1 –±–∞–∑–∏—Ä–∞–Ω –Ω–∞ –µ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–æ—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–µ –Ω–∞ {name}",
    "! –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Å—ä–≤–µ—Ç 2 –±–∞–∑–∏—Ä–∞–Ω –Ω–∞ —Å—Ç—Ä–µ—Å–∞ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ—Ç–æ –Ω–∞ {name}",
    "! –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Å—ä–≤–µ—Ç 3 –∑–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –∑–∞ –ø—Ä–æ—Ñ–∏–ª–∞ –Ω–∞ {name}"
  ]
}

–í–ê–ñ–ù–û –ó–ê –°–ï–î–ú–ò–ß–ù–ê–¢–ê –°–•–ï–ú–ê:
- –°—ä–∑–¥–∞–π –•–û–õ–ò–°–¢–ò–ß–ï–ù —Å–µ–¥–º–∏—á–µ–Ω –º–æ–¥–µ–ª, –∫–æ–π—Ç–æ –≤–∑–µ–º–∞ –ø—Ä–µ–¥–≤–∏–¥ —Ü–µ–ª—Ç–∞, —Ö—Ä–æ–Ω–æ—Ç–∏–ø–∞ –∏ –Ω–∞–≤–∏—Ü–∏—Ç–µ
- –ò–Ω—Ç–µ—Ä–º–∏—Ç–µ–Ω—Ç–Ω–æ –≥–ª–∞–¥—É–≤–∞–Ω–µ (16:8, 18:6, OMAD) –µ –Ω–∞–ø—ä–ª–Ω–æ –≤–∞–ª–∏–¥–µ–Ω –∏–∑–±–æ—Ä –∞–∫–æ –ø–æ–¥—Ö–æ–∂–¥–∞
- –ú–æ–∂–µ –¥–∞ –≤–∞—Ä–∏—Ä–∞—à –±—Ä–æ—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –¥–Ω–∏—Ç–µ (–Ω–∞–ø—Ä. 2 —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ä–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏, 3 –≤ –ø–æ—á–∏–≤–Ω–∏)
- "–°–≤–æ–±–æ–¥–Ω–∏ –¥–Ω–∏" –∏–ª–∏ "—Å–≤–æ–±–æ–¥–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è" —Å–∞ –ø–æ–∑–≤–æ–ª–µ–Ω–∏ –∫–∞—Ç–æ —á–∞—Å—Ç –æ—Ç —É—Å—Ç–æ–π—á–∏–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –°–µ–¥–º–∏—Ü–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ —Ä–∞–±–æ—Ç–∏ –∫–∞—Ç–æ –°–ò–°–¢–ï–ú–ê, –Ω–µ –∫–∞—Ç–æ 7 –Ω–µ–∑–∞–≤–∏—Å–∏–º–∏ –¥–Ω–∏

–í–ê–ñ–ù–û –ó–ê –•–†–ê–ù–ò–¢–ï–õ–ù–ò –î–û–ë–ê–í–ö–ò:
- –í—Å—è–∫–∞ –¥–æ–±–∞–≤–∫–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –Ø–°–ù–ê –æ–±–æ—Å–Ω–æ–≤–∫–∞ –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞:
  * –î–µ—Ñ–∏—Ü–∏—Ç–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä. –Ω–∏—Å—ä–∫ –≤–∏—Ç–∞–º–∏–Ω D –∑–∞—Ä–∞–¥–∏ –º–∞–ª–∫–æ –∏–∑–ª–∞–≥–∞–Ω–µ –Ω–∞ —Å–ª—ä–Ω—Ü–µ)
  * –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä. –º–∞–≥–Ω–µ–∑–∏–π –∑–∞ —Å—Ç—Ä–µ—Å, –æ–º–µ–≥–∞-3 –∑–∞ –≤—ä–∑–ø–∞–ª–µ–Ω–∏–µ)
  * –¶–µ–ª–∏ (–Ω–∞–ø—Ä. –ø—Ä–æ—Ç–µ–∏–Ω –∑–∞ –º—É—Å–∫—É–ª–Ω–∞ –º–∞—Å–∞, –∂–µ–ª—è–∑–æ –∑–∞ –µ–Ω–µ—Ä–≥–∏—è)
  * –í—ä–∑—Ä–∞—Å—Ç –∏ –ø–æ–ª (–Ω–∞–ø—Ä. –∫–∞–ª—Ü–∏–π –∑–∞ –∂–µ–Ω–∏ –Ω–∞–¥ 40, —Ü–∏–Ω–∫ –∑–∞ –º—ä–∂–µ)
- –î–æ–∑–∏—Ä–æ–≤–∫–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –ü–ï–†–°–û–ù–ê–õ–ò–ó–ò–†–ê–ù–ê —Å–ø–æ—Ä–µ–¥ —Ç–µ–≥–ª–æ, –≤—ä–∑—Ä–∞—Å—Ç –∏ –Ω—É–∂–¥–∏
- –í—Ä–µ–º–µ—Ç–æ –Ω–∞ –ø—Ä–∏–µ–º —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –æ–ø—Ç–∏–º–∞–ª–Ω–æ –∑–∞ —É—Å–≤–æ—è–≤–∞–Ω–µ
- –°–¢–†–û–ì–û –ó–ê–ë–†–ê–ù–ï–ù–û: –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ –µ–¥–Ω–∏ –∏ —Å—ä—â–∏ –¥–æ–±–∞–≤–∫–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∏
- –°–¢–†–û–ì–û –ó–ê–ë–†–ê–ù–ï–ù–û: –£–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∏ "–º—É–ª—Ç–∏–≤–∏—Ç–∞–º–∏–Ω–∏" –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –æ–±–æ—Å–Ω–æ–≤–∫–∞
- –í—Å—è–∫–∞ –¥–æ–±–∞–≤–∫–∞ –¢–†–Ø–ë–í–ê –¥–∞ –µ —Ä–∞–∑–ª–∏—á–Ω–∞ –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—è –∫–ª–∏–µ–Ω—Ç {name}
- –í–∑–µ–º–∏ –ø—Ä–µ–¥–≤–∏–¥ —É–Ω–∏–∫–∞–ª–Ω–∞—Ç–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –æ—Ç: {age} –≥–æ–¥. {gender}, {goal}, {medicalConditions}, {sportActivity}, —Å—Ç—Ä–µ—Å: {stressLevel}`;

        const DEFAULT_MEAL_PLAN_PROMPT = `–¢–∏ –¥–µ–π—Å—Ç–≤–∞—à –∫–∞—Ç–æ Advanced Dietary Logic Engine (ADLE) ‚Äì –ª–æ–≥–∏—á–µ—Å–∫–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ —Ä–µ–∂–∏–º–∏.

=== –ó–ê–î–ê–ß–ê ===
–ì–µ–Ω–µ—Ä–∏—Ä–∞–π –î–ù–ò {startDay}-{endDay} –æ—Ç 7-–¥–Ω–µ–≤–µ–Ω —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω –∑–∞ {name}.

=== –ö–õ–ò–ï–ù–¢ ===
–ò–º–µ: {name}, –¶–µ–ª: {goal}, –ö–∞–ª–æ—Ä–∏–∏: {recommendedCalories} kcal/–¥–µ–Ω
BMR: {bmr}, –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä: "{dietaryModifier}"{modificationsSection}
–°—Ç—Ä–µ—Å: {stressLevel}, –°—ä–Ω: {sleepHours}—á, –•—Ä–æ–Ω–æ—Ç–∏–ø: {chronotype}
{blueprintSection}
=== –°–¢–†–ê–¢–ï–ì–ò–Ø (–ö–û–ú–ü–ê–ö–¢–ù–ê) ===
–î–∏–µ—Ç–∞: {dietType}
–°—Ö–µ–º–∞: {weeklyMealPattern}
–•—Ä–∞–Ω–µ–Ω–∏—è: {mealTiming}
–ü—Ä–∏–Ω—Ü–∏–ø–∏: {keyPrinciples}
–ò–∑–±—è–≥–≤–∞–π: {dietDislike}, {foodsToAvoid}
–í–∫–ª—é—á–≤–∞–π: {dietLove}, {foodsToInclude}{previousDaysContext}

=== –ö–û–†–ï–õ–ê–¶–ò–û–ù–ù–ê –ê–î–ê–ü–¢–ê–¶–ò–Ø ===
–°–¢–†–ï–° –ò –•–†–ê–ù–ï–ù–ï:
- –°—Ç—Ä–µ—Å: {stressLevel}
- –ü—Ä–∏ –≤–∏—Å–æ–∫ —Å—Ç—Ä–µ—Å, –≤–∫–ª—é—á–∏ —Ö—Ä–∞–Ω–∏ –±–æ–≥–∞—Ç–∏ –Ω–∞:
  * –ú–∞–≥–Ω–µ–∑–∏–π (—Ç—ä–º–Ω–æ –∑–µ–ª–µ–Ω–∏ –ª–∏—Å—Ç–Ω–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, —è–¥–∫–∏, —Å–µ–º–µ–Ω–∞, –ø—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏)
  * –í–∏—Ç–∞–º–∏–Ω C (—Ü–∏—Ç—Ä—É—Å–∏, —á—É—à–∫–∏, –∑–µ–ª–µ)
  * –û–º–µ–≥–∞-3 (–º–∞–∑–Ω–∞ —Ä–∏–±–∞, –ª–µ–Ω–µ–Ω–æ —Å–µ–º–µ, –æ—Ä–µ—Ö–∏)
  * –ö–æ–º–ø–ª–µ–∫—Å B –≤–∏—Ç–∞–º–∏–Ω–∏ (—è–π—Ü–∞, –º–µ—Å–æ, –±–æ–±–æ–≤–∏)
- –ò–∑–±—è–≥–≤–∞–π —Å—Ç–∏–º—É–ª–∞–Ω—Ç–∏ (–∫–∞—Ñ–µ, –µ–Ω–µ—Ä–≥–∏–π–Ω–∏ –Ω–∞–ø–∏—Ç–∫–∏) –ø—Ä–∏ –≤–∏—Å–æ–∫ —Å—Ç—Ä–µ—Å

–•–†–û–ù–û–¢–ò–ü –ò –ö–ê–õ–û–†–ò–ô–ù–û –†–ê–ó–ü–†–ï–î–ï–õ–ï–ù–ò–ï:
- –•—Ä–æ–Ω–æ—Ç–∏–ø: {chronotype}
- "–†–∞–Ω–æ–±—É–¥–µ–Ω" / "–°–æ–≤–∞ –Ω–∞ —Å—É—Ç—Ä–∏–Ω—Ç–∞" ‚Üí –ü–æ-–æ–±–∏–ª–Ω–∞ –∑–∞–∫—É—Å–∫–∞ (30-35% –∫–∞–ª–æ—Ä–∏–∏), —É–º–µ—Ä–µ–Ω–∞ –≤–µ—á–µ—Ä—è (25%)
- "–í–µ—á–µ—Ä–µ–Ω —Ç–∏–ø" / "–ù–æ—â–Ω–∞ —Å–æ–≤–∞" ‚Üí –õ–µ–∫–∞ –∑–∞–∫—É—Å–∫–∞ (20%), –ø–æ-–æ–±–∏–ª–Ω–∞ –≤–µ—á–µ—Ä—è (35% –∫–∞–ª–æ—Ä–∏–∏)
- "–°–º–µ—Å–µ–Ω —Ç–∏–ø" ‚Üí –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–æ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (25-30-25-20%)

–°–™–ù –ò –•–†–ê–ù–ï–ù–ï:
- –°—ä–Ω: {sleepHours}—á
- –ü—Ä–∏ –º–∞–ª–∫–æ —Å—ä–Ω (< 6—á): –í–∫–ª—é—á–∏ —Ö—Ä–∞–Ω–∏ —Å —Ç—Ä–∏–ø—Ç–æ—Ñ–∞–Ω (—è–π—Ü–∞, –∫–∏—Å–µ–ª–æ –º–ª—è–∫–æ, –±–∞–Ω–∞–Ω–∏, —Å–∏—Ä–µ–Ω–µ) –∑–∞ –ø–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ —Å—ä–Ω—è
- –ò–∑–±—è–≥–≤–∞–π —Ç–µ–∂–∫–∏ —Ö—Ä–∞–Ω–∏ –≤–µ—á–µ—Ä –∞–∫–æ —Å—ä–Ω—è –µ –ø—Ä–µ–∫—ä—Å–≤–∞–Ω

=== –ê–†–•–ò–¢–ï–ö–¢–£–†–ê ===
–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: [PRO]=–ë–µ–ª—Ç—ä–∫, [ENG]=–ï–Ω–µ—Ä–≥–∏—è/–≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏, [VOL]=–ó–µ–ª–µ–Ω—á—É—Ü–∏/—Ñ–∏–±—Ä–∏, [FAT]=–ú–∞–∑–Ω–∏–Ω–∏, [CMPX]=–°–ª–æ–∂–Ω–∏ —è—Å—Ç–∏—è
–®–∞–±–ª–æ–Ω–∏: A) –†–ê–ó–î–ï–õ–ï–ù–ê –ß–ò–ù–ò–Ø=[PRO]+[ENG]+[VOL], B) –°–ú–ï–°–ï–ù–û=[PRO]+[ENG]+[VOL] –º–∏–∫—Å, C) –õ–ï–ö–û/–°–ê–ù–î–í–ò–ß, D) –ï–î–ò–ù–ï–ù –ë–õ–û–ö=[CMPX]+[VOL]
–§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ —Å–ø–æ—Ä–µ–¥ "{dietaryModifier}": –í–µ–≥–∞–Ω=–±–µ–∑ –∂–∏–≤–æ—Ç–∏–Ω—Å–∫–∏ [PRO]; –ö–µ—Ç–æ=–º–∏–Ω–∏–º—É–º [ENG]; –ë–µ–∑ –≥–ª—É—Ç–µ–Ω=[ENG] —Å–∞–º–æ –æ—Ä–∏–∑/–∫–∞—Ä—Ç–æ—Ñ–∏/–∫–∏–Ω–æ–∞/–µ–ª–¥–∞; –ü–∞–ª–µ–æ=–±–µ–∑ –∑—ä—Ä–Ω–µ–Ω–∏/–±–æ–±–æ–≤–∏/–º–ª–µ—á–Ω–∏{skipBreakfastNote}

=== ADLE v8 STRICT RULES (–ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –°–ü–ê–ó–í–ê–ù–ï) ===
–ü–†–ò–û–†–ò–¢–ï–¢ (–≤–∏–Ω–∞–≥–∏): 1) Hard bans ‚Üí 2) Mode filter (MODE –∏–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –±–∞–∑–æ–≤–∏ –ø—Ä–∞–≤–∏–ª–∞) ‚Üí 3) Template constraints ‚Üí 4) Hard rules (R1-R12) ‚Üí 5) Repair ‚Üí 6) Output

0) HARD BANS (0% –í–ò–ù–ê–ì–ò):
- –ª—É–∫ (–≤—Å—è–∫–∞–∫–≤–∞ —Ñ–æ—Ä–º–∞), –ø—É–µ—à–∫–æ –º–µ—Å–æ, –∏–∑–∫—É—Å—Ç–≤–µ–Ω–∏ –ø–æ–¥—Å–ª–∞–¥–∏—Ç–µ–ª–∏
- –º–µ–¥, –∑–∞—Ö–∞—Ä, –∫–æ–Ω—Ñ–∏—Ç—é—Ä, —Å–∏—Ä–æ–ø–∏
- –∫–µ—Ç—á—É–ø, –º–∞–π–æ–Ω–µ–∑–∞, BBQ/—Å–ª–∞–¥–∫–∏ —Å–æ—Å–æ–≤–µ
- –≥—Ä—ä—Ü–∫–æ –∫–∏—Å–µ–ª–æ –º–ª—è–∫–æ (–∏–∑–ø–æ–ª–∑–≤–∞–π –°–ê–ú–û –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –∫–∏—Å–µ–ª–æ –º–ª—è–∫–æ)
- –≥—Ä–∞—Ö + —Ä–∏–±–∞ (–∑–∞–±—Ä–∞–Ω–µ–Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è)

0.1) –†–Ø–î–ö–û (‚â§2 –ø—ä—Ç–∏/—Å–µ–¥–º–∏—á–Ω–æ): –ø—É–µ—à–∫–∞ —à—É–Ω–∫–∞, –±–µ–∫–æ–Ω

HARD RULES (R1-R12):
R1: –ë–µ–ª—Ç—ä–∫ –≥–ª–∞–≤–µ–Ω = —Ç–æ—á–Ω–æ 1. –í—Ç–æ—Ä–∏—á–µ–Ω –±–µ–ª—Ç—ä–∫ –°–ê–ú–û –∞–∫–æ (–∑–∞–∫—É—Å–∫–∞ AND —è–π—Ü–∞), 0-1.
R2: –ó–µ–ª–µ–Ω—á—É—Ü–∏ = 1-2. –ò–∑–±–µ—Ä–∏ –¢–û–ß–ù–û –ï–î–ù–ê —Ñ–æ—Ä–º–∞: –°–∞–ª–∞—Ç–∞ –ò–õ–ò –ü—Ä–µ—Å–Ω–∏ (–ù–ï –∏ –¥–≤–µ—Ç–µ –µ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ). –ö–∞—Ä—Ç–æ—Ñ–∏—Ç–µ –ù–ï –°–ê –∑–µ–ª–µ–Ω—á—É—Ü–∏.
R3: –ï–Ω–µ—Ä–≥–∏—è = 0-1 (–Ω–∏–∫–æ–≥–∞ 2).
R4: –ú–ª–µ—á–Ω–∏ –º–∞–∫—Å = 1 –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ (–∫–∏—Å–µ–ª–æ –º–ª—è–∫–æ –ò–õ–ò –∏–∑–≤–∞—Ä–∞ –ò–õ–ò —Å–∏—Ä–µ–Ω–µ), –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –∫–∞—Ç–æ —Å–æ—Å/–¥—Ä–µ—Å–∏–Ω–≥.
R5: –ú–∞–∑–Ω–∏–Ω–∏ = 0-1. –ê–∫–æ —è–¥–∫–∏/—Å–µ–º–µ–Ω–∞ ‚Üí –±–µ–∑ –∑–µ—Ö—Ç–∏–Ω/–º–∞—Å–ª–æ.
R6: –ü—Ä–∞–≤–∏–ª–æ –∑–∞ —Å–∏—Ä–µ–Ω–µ: –ê–∫–æ —Å–∏—Ä–µ–Ω–µ ‚Üí –±–µ–∑ –∑–µ—Ö—Ç–∏–Ω/–º–∞—Å–ª–æ. –ú–∞—Å–ª–∏–Ω–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏ —Å—ä—Å —Å–∏—Ä–µ–Ω–µ.
R7: –ü—Ä–∞–≤–∏–ª–æ –∑–∞ –±–µ–∫–æ–Ω: –ê–∫–æ –±–µ–∫–æ–Ω ‚Üí –ú–∞–∑–Ω–∏–Ω–∏=0.
R8: –ë–æ–±–æ–≤–∏-–∫–∞—Ç–æ-–æ—Å–Ω–æ–≤–Ω–æ (–±–æ–±/–ª–µ—â–∞/–Ω–∞—Ö—É—Ç/–≥—é–≤–µ—á –æ—Ç –≥—Ä–∞—Ö): –ï–Ω–µ—Ä–≥–∏—è=0 (–±–µ–∑ –æ—Ä–∏–∑/–∫–∞—Ä—Ç–æ—Ñ–∏/–ø–∞—Å—Ç–∞/–±—É–ª–≥—É—Ä/–æ–≤–µ—Å–µ–Ω–∏). –•–ª—è–± –º–æ–∂–µ –¥–∞ –µ –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω: +1 —Ñ–∏–ª–∏—è –ø—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç.
R9: –ü—Ä–∞–≤–∏–ª–æ –∑–∞ —Ö–ª—è–± (–∏–∑–≤—ä–Ω Template C): –†–∞–∑—Ä–µ—à–µ–Ω –°–ê–ú–û –∞–∫–æ –ï–Ω–µ—Ä–≥–∏—è=0. –ò–∑–∫–ª—é—á–µ–Ω–∏–µ: —Å –±–æ–±–æ–≤–∏-–∫–∞—Ç–æ-–æ—Å–Ω–æ–≤–Ω–æ (R8), —Ö–ª—è–± –º–æ–∂–µ –¥–∞ –µ –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω (1 —Ñ–∏–ª–∏—è). –ê–∫–æ –∏–º–∞ –ï–Ω–µ—Ä–≥–∏—è ‚Üí –•–ª—è–±=0.
R10: –ì—Ä–∞—Ö –∫–∞—Ç–æ –¥–æ–±–∞–≤–∫–∞ –∫—ä–º –º–µ—Å–æ: –ì—Ä–∞—Ö—ä—Ç –ù–ï –ï –µ–Ω–µ—Ä–≥–∏—è, –Ω–æ –ë–õ–û–ö–ò–†–ê —Å–ª–æ—Ç–∞ –ï–Ω–µ—Ä–≥–∏—è ‚Üí –ï–Ω–µ—Ä–≥–∏—è=0. –•–ª—è–± –º–æ–∂–µ –¥–∞ –µ –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω (+1 —Ñ–∏–ª–∏—è).
R11: Template C (—Å–∞–Ω–¥–≤–∏—á): –°–∞–º–æ –∑–∞ –∑–∞–∫—É—Å–∫–∏; –±–æ–±–æ–≤–∏ –∑–∞–±—Ä–∞–Ω–µ–Ω–∏; –±–µ–∑ –∑–∞–±—Ä–∞–Ω–µ–Ω–∏ —Å–æ—Å–æ–≤–µ/–ø–æ–¥—Å–ª–∞–¥–∏—Ç–µ–ª–∏.
R12: –ò–∑–≤—ä–Ω-whitelist –¥–æ–±–∞–≤—è–Ω–µ: –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ=—Å–∞–º–æ whitelist. –ò–∑–≤—ä–Ω-whitelist –°–ê–ú–û –∞–∫–æ –æ–±–µ–∫—Ç–∏–≤–Ω–æ –Ω—É–∂–Ω–æ (MODE/–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ/–Ω–∞–ª–∏—á–Ω–æ—Å—Ç), mainstream/—É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–æ, –Ω–∞–ª–∏—á–Ω–æ –≤ –ë—ä–ª–≥–∞—Ä–∏—è. –î–æ–±–∞–≤–∏ —Ä–µ–¥: Reason: ...

=== WHITELISTS (–†–ê–ó–†–ï–®–ï–ù–ò –•–†–ê–ù–ò) - –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –°–ü–ê–ó–í–ê–ù–ï ===
–ö–†–ò–¢–ò–ß–ù–û: –ò–∑–ø–æ–ª–∑–≤–∞–π –°–ê–ú–û —Ö—Ä–∞–Ω–∏ –æ—Ç —Ç–µ–∑–∏ —Å–ø–∏—Å—ä—Ü–∏! –ò–∑–≤—ä–Ω-whitelist –°–ê–ú–û —Å Reason: ...

WHITELIST PROTEIN (–∏–∑–±–µ—Ä–∏ —Ç–æ—á–Ω–æ 1 –≥–ª–∞–≤–µ–Ω –±–µ–ª—Ç—ä–∫):
- —è–π—Ü–∞ (eggs)
- –ø–∏–ª–µ—à–∫–æ (chicken)
- –≥–æ–≤–µ–∂–¥–æ (beef)
- –ø–æ—Å—Ç–Ω–∞ —Å–≤–∏–Ω—Å–∫–∞ (lean pork)
- —Ä–∏–±–∞ (white fish, —Å–∫—É–º—Ä–∏—è/mackerel, —Ä–∏–±–∞ —Ç–æ–Ω/canned tuna)
- –∫–∏—Å–µ–ª–æ –º–ª—è–∫–æ (yogurt - plain, –Ω–µ—Å–ª–∞–¥–∫–æ)
- –∏–∑–≤–∞—Ä–∞ (cottage cheese - plain)
- —Å–∏—Ä–µ–Ω–µ (cheese - —É–º–µ—Ä–µ–Ω–æ)
- –±–æ–± (beans)
- –ª–µ—â–∞ (lentils)
- –Ω–∞—Ö—É—Ç (chickpeas)
- –≥—Ä–∞—Ö (peas - –≤–∏–∂ 3.5)

–ó–ê–ë–†–ê–ù–ï–ù–ò –ë–ï–õ–¢–™–¶–ò (–ù–ï –∏–∑–ø–æ–ª–∑–≤–∞–π –±–µ–∑ Reason):
- –ø—É–µ—à–∫–æ –º–µ—Å–æ (turkey meat) - HARD BAN
- –∑–∞–µ—à–∫–æ (rabbit) - –ò–ó–í–™–ù whitelist
- –ø–∞—Ç–∏—Ü–∞ (duck) - –ò–ó–í–™–ù whitelist
- –≥—ä—Å–∫–∞ (goose) - –ò–ó–í–™–ù whitelist
- –∞–≥–Ω–µ (lamb) - –ò–ó–í–™–ù whitelist
- –¥–∏–≤–µ—á (game meat) - –ò–ó–í–™–ù whitelist
- –≤—Å–∏—á–∫–∏ –µ–∫–∑–æ—Ç–∏—á–Ω–∏ –º–µ—Å–∞ - –ò–ó–í–™–ù whitelist

WHITELIST VEGETABLES (–∏–∑–±–µ—Ä–∏ 1-2):
- –¥–æ–º–∞—Ç–∏, –∫—Ä–∞—Å—Ç–∞–≤–∏—Ü–∏, —á—É—à–∫–∏, –∑–µ–ª–µ, –º–æ—Ä–∫–æ–≤–∏
- —Å–∞–ª–∞—Ç–∞/–ª–∏—Å—Ç–Ω–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏ (lettuce/greens), —Å–ø–∞–Ω–∞–∫
- —Ç–∏–∫–≤–∏—á–∫–∏, –≥—ä–±–∏, –±—Ä–æ–∫–æ–ª–∏, –∫–∞—Ä—Ñ–∏–æ–ª
- –ø—Ä–µ—Å–Ω–∏ –Ω–∞—Ä—è–∑–∞–Ω–∏: –¥–æ–º–∞—Ç–∏/–∫—Ä–∞—Å—Ç–∞–≤–∏—Ü–∏/—á—É—à–∫–∏ (–ë–ï–ó –¥—Ä–µ—Å–∏–Ω–≥)

WHITELIST ENERGY (–∏–∑–±–µ—Ä–∏ 0-1):
- –æ–≤–µ—Å–µ–Ω–∏ —è–¥–∫–∏ (oats)
- –æ—Ä–∏–∑ (rice)
- –∫–∞—Ä—Ç–æ—Ñ–∏ (potatoes)
- –ø–∞—Å—Ç–∞ (pasta)
- –±—É–ª–≥—É—Ä (bulgur)
–ó–ê–ë–ï–õ–ï–ñ–ö–ê: –¶–∞—Ä–µ–≤–∏—Ü–∞ –ù–ï –µ –µ–Ω–µ—Ä–≥–∏—è!

WHITELIST FAT (–∏–∑–±–µ—Ä–∏ 0-1):
- –∑–µ—Ö—Ç–∏–Ω (olive oil)
- –º–∞—Å–ª–æ (butter - —É–º–µ—Ä–µ–Ω–æ)
- —è–¥–∫–∏/—Å–µ–º–µ–Ω–∞ (nuts/seeds - —É–º–µ—Ä–µ–Ω–æ)

–°–ü–ï–¶–ò–ê–õ–ù–ò –ü–†–ê–í–ò–õ–ê:
- –ì—Ä–∞—Ö + —Ä–∏–±–∞ = –°–¢–†–û–ì–û –ó–ê–ë–†–ê–ù–ï–ù–û
- –ó–µ–ª–µ–Ω—á—É—Ü–∏: –ï–î–ù–ê —Ñ–æ—Ä–º–∞ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–µ (–°–∞–ª–∞—Ç–∞ –ò–õ–ò –ü—Ä–µ—Å–Ω–∏ –Ω–∞—Ä—è–∑–∞–Ω–∏, –Ω–µ –∏ –¥–≤–µ—Ç–µ)
- –ú–∞—Å–ª–∏–Ω–∏ = –¥–æ–±–∞–≤–∫–∞ –∫—ä–º —Å–∞–ª–∞—Ç–∞ (–ù–ï –ú–∞–∑–Ω–∏–Ω–∏ —Å–ª–æ—Ç). –ê–∫–æ –º–∞—Å–ª–∏–Ω–∏ ‚Üí –ë–ï–ó –∑–µ—Ö—Ç–∏–Ω/–º–∞—Å–ª–æ
- –¶–∞—Ä–µ–≤–∏—Ü–∞ = –ù–ï –µ –µ–Ω–µ—Ä–≥–∏—è. –ú–∞–ª–∫–æ —Ü–∞—Ä–µ–≤–∏—Ü–∞ —Å–∞–º–æ –≤ —Å–∞–ª–∞—Ç–∏ –∫–∞—Ç–æ –¥–æ–±–∞–≤–∫–∞
- Template C (—Å–∞–Ω–¥–≤–∏—á) = –°–ê–ú–û –∑–∞ –∑–∞–∫—É—Å–∫–∏, –ù–ï –∑–∞ –æ—Å–Ω–æ–≤–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

=== –ö–†–ò–¢–ò–ß–ù–ò –ò–ó–ò–°–ö–í–ê–ù–ò–Ø ===
1. –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–ò –ú–ê–ö–†–û–°–ò: –í—Å—è–∫–æ —è—Å—Ç–∏–µ –¢–†–Ø–ë–í–ê –¥–∞ –∏–º–∞ —Ç–æ—á–Ω–∏ macros (protein, carbs, fats, fiber –≤ –≥—Ä–∞–º–æ–≤–µ)
2. –ü–†–ï–¶–ò–ó–ù–ò –ö–ê–õ–û–†–ò–ò: –ò–∑—á–∏—Å–ª–µ–Ω–∏ –∫–∞—Ç–æ protein√ó4 + carbs√ó4 + fats√ó9 –∑–∞ –í–°–Ø–ö–û —è—Å—Ç–∏–µ
3. –¶–ï–õ–ï–í–ê –î–ù–ï–í–ù–ê –°–£–ú–ê: –û–∫–æ–ª–æ {recommendedCalories} kcal –Ω–∞ –¥–µ–Ω (¬±{tolerance} kcal –µ –ø—Ä–∏–µ–º–ª–∏–≤–æ)
   - –¶–µ–ª—Ç–∞ –µ –û–†–ò–ï–ù–¢–ò–†, –ù–ï —Å—Ç—Ä–æ–≥–æ –∏–∑–∏—Å–∫–≤–∞–Ω–µ
   - –ü–æ-–≤–∞–∂–Ω–æ –µ –¥–∞ —Å–ø–∞–∑–∏—à –ø—Ä–∞–≤–∏–ª–Ω–∏—è –±—Ä–æ–π –∏ —Ä–µ–¥ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è, –æ—Ç–∫–æ–ª–∫–æ—Ç–æ –¥–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ—à —Ç–æ—á–Ω–æ –∫–∞–ª–æ—Ä–∏–∏—Ç–µ
4. –ë–†–û–ô –•–†–ê–ù–ï–ù–ò–Ø: 1-6 —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –¥–µ–Ω —Å–ø–æ—Ä–µ–¥ –¥–∏–µ—Ç–∏—á–Ω–∞—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ —Ü–µ–ª—Ç–∞
   - 1 —Ö—Ä–∞–Ω–µ–Ω–µ (OMAD): —Å–∞–º–æ –ø—Ä–∏ —è—Å–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ –∏–Ω—Ç–µ—Ä–º–∏—Ç–µ–Ω—Ç–Ω–æ –≥–ª–∞–¥—É–≤–∞–Ω–µ
   - 2 —Ö—Ä–∞–Ω–µ–Ω–∏—è: –ø—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ –∏–Ω—Ç–µ—Ä–º–∏—Ç–µ–Ω—Ç–Ω–æ –≥–ª–∞–¥—É–≤–∞–Ω–µ (16:8, 18:6)
   - 3 —Ö—Ä–∞–Ω–µ–Ω–∏—è: –ó–∞–∫—É—Å–∫–∞, –û–±—è–¥, –í–µ—á–µ—Ä—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –≤–∞—Ä–∏–∞–Ω—Ç)
   - 4 —Ö—Ä–∞–Ω–µ–Ω–∏—è: –ó–∞–∫—É—Å–∫–∞, –û–±—è–¥, –°–ª–µ–¥–æ–±–µ–¥–Ω–∞ –∑–∞–∫—É—Å–∫–∞, –í–µ—á–µ—Ä—è (–ø—Ä–∏ –Ω—É–∂–¥–∞ –æ—Ç –ø–æ-—á–µ—Å—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–µ)
   - 5 —Ö—Ä–∞–Ω–µ–Ω–∏—è: –ó–∞–∫—É—Å–∫–∞, –û–±—è–¥, –°–ª–µ–¥–æ–±–µ–¥–Ω–∞ –∑–∞–∫—É—Å–∫–∞, –í–µ—á–µ—Ä—è, –ö—ä—Å–Ω–∞ –∑–∞–∫—É—Å–∫–∞ (–ø—Ä–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ —Å–ª—É—á–∞–∏)
   - 6 —Ö—Ä–∞–Ω–µ–Ω–∏—è: —Ä—è–¥–∫–æ, —Å–∞–º–æ –ø—Ä–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞/—Å–ø–æ—Ä—Ç–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
   - –ö–†–ò–¢–ò–ß–ù–û: –ë—Ä–æ—è—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ –æ–ø—Ä–µ–¥–µ–ª—è –æ—Ç –°–¢–†–ê–¢–ï–ì–ò–Ø–¢–ê, –ù–ï –æ—Ç –Ω—É–∂–¥–∞—Ç–∞ –¥–∞ —Å–µ –¥–æ—Å—Ç–∏–≥–Ω–∞—Ç –∫–∞–ª–æ—Ä–∏–∏!
   - –ù–ò–ö–û–ì–ê –Ω–µ –¥–æ–±–∞–≤—è–π —Ö—Ä–∞–Ω–µ–Ω–∏—è –°–ê–ú–û –∑–∞ –¥–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ –∫–∞–ª–æ—Ä–∏–∏!
5. –†–ê–ó–ù–û–û–ë–†–ê–ó–ò–ï: –í—Å–µ–∫–∏ –¥–µ–Ω —Ä–∞–∑–ª–∏—á–µ–Ω –æ—Ç –ø—Ä–µ–¥–∏—à–Ω–∏—Ç–µ
6. –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∏ –±—ä–ª–≥–∞—Ä—Å–∫–∏/—Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏ —è—Å—Ç–∏—è

=== –ú–ï–î–ò–¶–ò–ù–°–ö–ò –ò –î–ò–ï–¢–ï–¢–ò–ß–ù–ò –ü–†–ò–ù–¶–ò–ü–ò –ó–ê –†–ï–î –ù–ê –•–†–ê–ù–ï–ù–ò–Ø ===
–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–ù–û: –°–ª–µ–¥–≤–∞–π –°–¢–†–û–ì–û –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ç–µ –∏ –¥–∏–µ—Ç–µ—Ç–∏—á–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –∑–∞ —Ä–µ–¥ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è—Ç–∞:

1. –ü–û–ó–í–û–õ–ï–ù–ò –¢–ò–ü–û–í–ï –•–†–ê–ù–ï–ù–ò–Ø (–≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ–Ω —Ä–µ–¥):
   - "–ó–∞–∫—É—Å–∫–∞" (—Å—É—Ç—Ä–∏–Ω) - –°–ê–ú–û –∫–∞—Ç–æ –ø—ä—Ä–≤–æ —Ö—Ä–∞–Ω–µ–Ω–µ –Ω–∞ –¥–µ–Ω—è
   - "–û–±—è–¥" (–æ–±–µ–¥) - –°–ê–ú–û —Å–ª–µ–¥ –∑–∞–∫—É—Å–∫–∞—Ç–∞ –∏–ª–∏ –∫–∞—Ç–æ –ø—ä—Ä–≤–æ —Ö—Ä–∞–Ω–µ–Ω–µ (–∞–∫–æ –Ω—è–º–∞ –∑–∞–∫—É—Å–∫–∞)
   - "–°–ª–µ–¥–æ–±–µ–¥–Ω–∞ –∑–∞–∫—É—Å–∫–∞" (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ, –º–µ–∂–¥—É –æ–±—è–¥ –∏ –≤–µ—á–µ—Ä—è)
   - "–í–µ—á–µ—Ä—è" (–≤–µ—á–µ—Ä) - –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–µ
   - "–ö—ä—Å–Ω–∞ –∑–∞–∫—É—Å–∫–∞" (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ, –°–ê–ú–û —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è, —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ —Å–ª—É—á–∞–∏)

2. –•–†–û–ù–û–õ–û–ì–ò–ß–ï–ù –†–ï–î: –•—Ä–∞–Ω–µ–Ω–∏—è—Ç–∞ –¢–†–Ø–ë–í–ê –¥–∞ —Å–ª–µ–¥–≤–∞—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–∏—è –¥–Ω–µ–≤–µ–Ω —Ä–∏—Ç—ä–º
   - –ù–ï –º–æ–∂–µ –¥–∞ –∏–º–∞ –∑–∞–∫—É—Å–∫–∞ —Å–ª–µ–¥ –æ–±—è–¥
   - –ù–ï –º–æ–∂–µ –¥–∞ –∏–º–∞ –æ–±—è–¥ —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è
   - –ù–ï –º–æ–∂–µ –¥–∞ –∏–º–∞ –≤–µ—á–µ—Ä—è –ø—Ä–µ–¥–∏ –æ–±—è–¥

3. –ö–™–°–ù–ê –ó–ê–ö–£–°–ö–ê - —Å—Ç—Ä–æ–≥–∏ –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è:
   –ö–û–ì–ê–¢–û –ï –î–û–ü–£–°–¢–ò–ú–ê:
   - –î—ä–ª—ä–≥ –ø–µ—Ä–∏–æ–¥ –º–µ–∂–¥—É –≤–µ—á–µ—Ä—è –∏ —Å—ä–Ω (> 4 —á–∞—Å–∞)
   - –ü—Ä–æ–±–ª–µ–º–∏ —Å—ä—Å —Å—ä–Ω—è –∑–∞—Ä–∞–¥–∏ –≥–ª–∞–¥
   - –î–∏–∞–±–µ—Ç —Ç–∏–ø 2 (—Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∫—Ä—ä–≤–Ω–∞—Ç–∞ –∑–∞—Ö–∞—Ä)
   - –ò–Ω—Ç–µ–Ω–∑–∏–≤–Ω–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤–µ—á–µ—Ä
   - –†–∞–±–æ—Ç–∞ –Ω–∞ —Å–º–µ–Ω–∏ (–Ω–æ—â–Ω–∏ —Å–º–µ–Ω–∏)
   
   –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–ò –£–°–õ–û–í–ò–Ø:
   - –°–ê–ú–û —Å–ª–µ–¥ "–í–µ—á–µ—Ä—è" (–Ω–∏–∫–æ–≥–∞ –ø—Ä–µ–¥–∏)
   - –ú–ê–ö–°–ò–ú–£–ú 1 –Ω–∞ –¥–µ–Ω
   - –°–ê–ú–û —Ö—Ä–∞–Ω–∏ —Å –ù–ò–°–™–ö –ì–õ–ò–ö–ï–ú–ò–ß–ï–ù –ò–ù–î–ï–ö–° (–ì–ò < 55):
     * –ö–∏—Å–µ–ª–æ –º–ª—è–∫–æ (150ml), –∫–µ—Ñ–∏—Ä
     * –Ø–¥–∫–∏: 30-40g –±–∞–¥–µ–º–∏/–æ—Ä–µ—Ö–∏/–ª–µ—à–Ω–∏—Ü–∏/–∫–∞—à—É
     * –Ø–≥–æ–¥–∏/–±–æ—Ä–æ–≤–∏–Ω–∫–∏/–º–∞–ª–∏–Ω–∏ (50-100g)
     * –ê–≤–æ–∫–∞–¥–æ (–ø–æ–ª–æ–≤–∏–Ω)
     * –°–µ–º–µ–Ω–∞: —á–∏–∞/–ª–µ–Ω–µ–Ω–æ/—Ç–∏–∫–≤–µ–Ω–∏ (1-2 —Å.–ª.)
   - –ú–ê–ö–°–ò–ú–£–ú {maxLateSnackCalories} –∫–∞–ª–æ—Ä–∏–∏
   - –ù–ï –∏–∑–ø–æ–ª–∑–≤–∞–π –∞–∫–æ –Ω–µ –µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ –æ—Ç –ø—Ä–æ—Ñ–∏–ª–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞!

4. –ö–ê–õ–û–†–ò–ô–ù–û –†–ê–ó–ü–†–ï–î–ï–õ–ï–ù–ò–ï: 
   - –†–∞–∑–ø—Ä–µ–¥–µ–ª–∏ –∫–∞–ª–æ—Ä–∏–∏—Ç–µ –≤ –∏–∑–±—Ä–∞–Ω–∏—Ç–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–æ—Ä–µ–¥ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞ (1-6 —Ö—Ä–∞–Ω–µ–Ω–∏—è)
   - –ê–∫–æ –ø–æ—Ä—Ü–∏–∏—Ç–µ —Å—Ç–∞–≤–∞—Ç —Ç–≤—ä—Ä–¥–µ –≥–æ–ª–µ–º–∏, —Ç–æ–≤–∞ –µ –ø—Ä–∏–µ–º–ª–∏–≤–æ - –ø–æ-–¥–æ–±—Ä–µ –æ—Ç –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è
   - –î–æ–ø—É—Å—Ç–∏–º–æ –µ –¥–∞ –∏–º–∞—à 1800 kcal –≤–º–µ—Å—Ç–æ 2000 kcal - —Ç–æ–≤–∞ –ù–ï –µ –ø—Ä–æ–±–ª–µ–º
   - –ê–ë–°–û–õ–Æ–¢–ù–û –ó–ê–ë–†–ê–ù–ï–ù–û –µ –¥–∞ –¥–æ–±–∞–≤—è—à —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–µ–¥ –≤–µ—á–µ—Ä—è –±–µ–∑ –æ–ø—Ä–∞–≤–¥–∞–Ω–∏–µ!

{mealNameFormatInstructions}

JSON –§–û–†–ú–ê–¢ (–≤—ä—Ä–Ω–∏ –°–ê–ú–û –¥–Ω–∏—Ç–µ {startDay}-{endDay}):
{
  "day{startDay}": {
    "meals": [
      {"type": "–ó–∞–∫—É—Å–∫–∞", "name": "–∏–º–µ —è—Å—Ç–∏–µ", "weight": "Xg", "description": "–æ–ø–∏—Å–∞–Ω–∏–µ", "benefits": "–ø–æ–ª–∑–∏", "calories": X, "macros": {"protein": X, "carbs": X, "fats": X, "fiber": X}},
      {"type": "–û–±—è–¥", "name": "–∏–º–µ —è—Å—Ç–∏–µ", "weight": "Xg", "description": "–æ–ø–∏—Å–∞–Ω–∏–µ", "benefits": "–ø–æ–ª–∑–∏", "calories": X, "macros": {"protein": X, "carbs": X, "fats": X, "fiber": X}},
      {"type": "–í–µ—á–µ—Ä—è", "name": "–∏–º–µ —è—Å—Ç–∏–µ", "weight": "Xg", "description": "–æ–ø–∏—Å–∞–Ω–∏–µ", "benefits": "–ø–æ–ª–∑–∏", "calories": X, "macros": {"protein": X, "carbs": X, "fats": X, "fiber": X}}
    ],
    "dailyTotals": {"calories": X, "protein": X, "carbs": X, "fats": X}
  }{multiDayExample}
}

–ì–µ–Ω–µ—Ä–∏—Ä–∞–π –¥–Ω–∏ {startDay}-{endDay} —Å –±–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–∏ —è—Å—Ç–∏—è –≤ –ø—Ä–∞–≤–∏–ª–µ–Ω —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ–Ω —Ä–µ–¥. –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –≤–∫–ª—é—á–∏ dailyTotals –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞!`;

        const DEFAULT_SUMMARY_PROMPT = `–°—ä–∑–¥–∞–π summary, –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∏ –¥–æ–ø—ä–ª–Ω–µ–Ω–∏—è –∑–∞ 7-–¥–Ω–µ–≤–µ–Ω —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω.

–ö–õ–ò–ï–ù–¢: {name}, –¶–µ–ª: {goal}
BMR: {bmr}, –¶–µ–ª–µ–≤–∏ –∫–∞–ª–æ—Ä–∏–∏: {recommendedCalories} kcal/–¥–µ–Ω
–†–µ–∞–ª–µ–Ω —Å—Ä–µ–¥–µ–Ω –ø—Ä–∏–µ–º: {avgCalories} kcal/–¥–µ–Ω
–†–µ–∞–ª–Ω–∏ —Å—Ä–µ–¥–Ω–∏ –º–∞–∫—Ä–æ—Å–∏: Protein {avgProtein}g, Carbs {avgCarbs}g, Fats {avgFats}g

–°–¢–†–ê–¢–ï–ì–ò–Ø (–ö–û–ú–ü–ê–ö–¢–ù–ê):
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ –ø–æ–¥–∫—Ä–µ–ø–∞: {psychologicalSupport}
- –î–æ–±–∞–≤–∫–∏: {supplementRecommendations}
- –•–∏–¥—Ä–∞—Ç–∞—Ü–∏—è: {hydrationStrategy}
- –í–∫–ª—é—á–≤–∞–π: {foodsToInclude}
- –ò–∑–±—è–≥–≤–∞–π: {foodsToAvoid}

JSON –§–û–†–ú–ê–¢ (–ö–†–ò–¢–ò–ß–ù–û - –∏–∑–ø–æ–ª–∑–≤–∞–π –°–ê–ú–û —á–∏—Å–ª–∞ –∑–∞ —á–∏—Å–ª–æ–≤–∏ –ø–æ–ª–µ—Ç–∞):
{
  "summary": {
    "bmr": {bmr},
    "dailyCalories": {avgCalories},
    "macros": {"protein": {avgProtein}, "carbs": {avgCarbs}, "fats": {avgFats}}
  },
  "recommendations": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —Ö—Ä–∞–Ω–∞ 1", "—Ö—Ä–∞–Ω–∞ 2", "—Ö—Ä–∞–Ω–∞ 3", "—Ö—Ä–∞–Ω–∞ 4", "—Ö—Ä–∞–Ω–∞ 5"],
  "forbidden": ["–∑–∞–±—Ä–∞–Ω–µ–Ω–∞ —Ö—Ä–∞–Ω–∞ 1", "—Ö—Ä–∞–Ω–∞ 2", "—Ö—Ä–∞–Ω–∞ 3", "—Ö—Ä–∞–Ω–∞ 4"],
  "psychology": {psychologySupport},
  "waterIntake": "{hydrationStrategy}",
  "supplements": {supplementRecommendationsArray}
}

–í–ê–ñ–ù–û: recommendations/forbidden=–°–ê–ú–û –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Ö—Ä–∞–Ω–∏ —Å–ø–æ—Ä–µ–¥ —Ü–µ–ª {goal}, –ù–ï –æ–±—â–∏ —Å—ä–≤–µ—Ç–∏.`;

        const DEFAULT_CONSULTATION_PROMPT = `–¢–ï–ö–£–© –†–ï–ñ–ò–ú: –ö–û–ù–°–£–õ–¢–ê–¶–ò–Ø

–í–ê–ñ–ù–ò –ü–†–ê–í–ò–õ–ê:
1. –ú–æ–∂–µ—à –¥–∞ —á–µ—Ç–µ—à –ø–ª–∞–Ω–∞, –Ω–æ –ù–ï –ú–û–ñ–ï–® –¥–∞ –≥–æ –ø—Ä–æ–º–µ–Ω—è—à.
2. –ë—ä–¥–∏ –ö–†–ê–¢–™–ö –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω - –º–∞–∫—Å–∏–º—É–º 3-4 –∏–∑—Ä–µ—á–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç –µ–∑–∏–∫.
3. –ê–∫–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç –∏—Å–∫–∞ –ø—Ä–æ–º—è–Ω–∞, –∫–∞–∂–∏: "–ó–∞ –ø—Ä–æ–º—è–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–π —Ä–µ–∂–∏–º–∞ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø–ª–∞–Ω–∞."
4. –ù–ò–ö–û–ì–ê –Ω–µ –∏–∑–ø–æ–ª–∑–≤–∞–π [REGENERATE_PLAN:...] –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
5. –í–∏–Ω–∞–≥–∏ –ø–æ–¥–¥—ä—Ä–∂–∞–π –º–æ—Ç–∏–≤–∏—Ä–∞—â —Ç–æ–Ω.
6. –§–æ—Ä–º–∞—Ç–∏—Ä–∞–π –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ —Å–∏ —è—Å–Ω–æ - –∏–∑–ø–æ–ª–∑–≤–∞–π –Ω–æ–≤–∏ —Ä–µ–¥–æ–≤–µ –∑–∞ —Ä–∞–∑–¥–µ–ª—è–Ω–µ –Ω–∞ –º–∏—Å–ª–∏.
7. –ó–∞–¥–∞–≤–∞–π –º–∞–∫—Å–∏–º—É–º 1 –≤—ä–ø—Ä–æ—Å –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä.

–ü–†–ò–ú–ï–†–ò:
- "–ó–∞–∫—É—Å–∫–∞—Ç–∞ —Å—ä–¥—ä—Ä–∂–∞ –æ–≤–µ—Å–µ–Ω–∏ —è–¥–∫–∏ —Å –±–∞–Ω–∞–Ω (350 –∫–∞–ª–æ—Ä–∏–∏). –ó–∞ –ø—Ä–æ–º—è–Ω–∞, –∞–∫—Ç–∏–≤–∏—Ä–∞–π —Ä–µ–∂–∏–º–∞ –∑–∞ –ø—Ä–æ–º—è–Ω–∞."
- "–ú–æ–∂–µ—à –¥–∞ –∑–∞–º–µ–Ω–∏—à —Ä–∏–±–∞—Ç–∞ —Å –ø–∏–ª–µ—à–∫–æ - –∏ –¥–≤–µ—Ç–µ —Å–∞ –æ—Ç–ª–∏—á–Ω–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ –Ω–∞ –ø—Ä–æ—Ç–µ–∏–Ω. –ó–∞ –ø—Ä–æ–º—è–Ω–∞, –∞–∫—Ç–∏–≤–∏—Ä–∞–π —Ä–µ–∂–∏–º–∞ –∑–∞ –ø—Ä–æ–º—è–Ω–∞."`;

        const DEFAULT_MODIFICATION_PROMPT = `–¢–ï–ö–£–© –†–ï–ñ–ò–ú: –ü–†–û–ú–Ø–ù–ê –ù–ê –ü–õ–ê–ù–ê

–í–ê–ñ–ù–ò –ü–†–ê–í–ò–õ–ê:
1. –¢–∏ —Å–∏ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω –¥–∏–µ—Ç–æ–ª–æ–≥. –ë—ä–¥–∏ –ö–†–ê–¢–™–ö –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω, –Ø–°–ï–ù –∏ –¥–∏—Ä–µ–∫—Ç–µ–Ω.
2. –ò–∑–ø–æ–ª–∑–≤–∞–π –ü–†–û–°–¢ –µ–∑–∏–∫, –ª–µ—Å–Ω–æ —Ä–∞–∑–±–∏—Ä–∞–µ–º.
3. –û–≥—Ä–∞–Ω–∏—á–∏ —Å–µ –¥–æ –ú–ê–ö–°–ò–ú–£–ú 3-4 –∏–∑—Ä–µ—á–µ–Ω–∏—è –≤ –æ—Ç–≥–æ–≤–æ—Ä.
4. –ó–∞–¥–∞–≤–∞–π –ú–ê–ö–°–ò–ú–£–ú 1 –≤—ä–ø—Ä–æ—Å –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä.
5. –§–æ—Ä–º–∞—Ç–∏—Ä–∞–π –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ —Å–∏ —è—Å–Ω–æ:
   - –ò–∑–ø–æ–ª–∑–≤–∞–π –Ω–æ–≤–∏ —Ä–µ–¥–æ–≤–µ –∑–∞ —Ä–∞–∑–¥–µ–ª—è–Ω–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –º–∏—Å–ª–∏
   - –ö–æ–≥–∞—Ç–æ –∏–∑–±—Ä–æ—è–≤–∞—à –æ–ø—Ü–∏–∏, —Å–ª–æ–∂–∏ –≤—Å—è–∫–∞ –Ω–∞ –Ω–æ–≤ —Ä–µ–¥ —Å —Ç–∏—Ä–µ (-)
   - –ò–∑–ø–æ–ª–∑–≤–∞–π –ø—Ä–∞–∑–Ω–∏ —Ä–µ–¥–æ–≤–µ –∑–∞ –ø–æ-–¥–æ–±—Ä–∞ —á–µ—Ç–∏–º–æ—Å—Ç –º–µ–∂–¥—É –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∏

2. –ö–æ–≥–∞—Ç–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç –∏—Å–∫–∞ –ø—Ä–æ–º—è–Ω–∞:
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –¥–∞–ª–∏ –µ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–æ –∑–∞ —Ü–µ–ª: {goal}
   - –û–±—è—Å–Ω–∏ –ö–†–ê–¢–ö–û –ø–æ—Å–ª–µ–¥–∏—Ü–∏—Ç–µ (—Å–∞–º–æ –æ—Å–Ω–æ–≤–Ω–æ—Ç–æ)
   - –ê–∫–æ –∏–º–∞ –ø–æ-–¥–æ–±—Ä–∞ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, –ø—Ä–µ–¥–ª–æ–∂–∏ —è —Å 1 –∏–∑—Ä–µ—á–µ–Ω–∏–µ
   - –ó–∞–ø–∏—Ç–∞–π —Å 1 –≤—ä–ø—Ä–æ—Å –∑–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ
   - –°–ª–µ–¥ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ, –ø—Ä–∏–ª–æ–∂–∏ —Å [REGENERATE_PLAN:{"modifications":["–æ–ø–∏—Å–∞–Ω–∏–µ"]}]

3. –†–ê–ó–ü–û–ó–ù–ê–í–ê–ù–ï –ù–ê –ü–û–¢–í–™–†–ñ–î–ï–ù–ò–ï:
   - "–¥–∞", "yes", "–¥–æ–±—Ä–µ", "–æ–∫", "–æ–∫–µ–π", "—Å–∏–≥—É—Ä–µ–Ω", "—Å–∏–≥—É—Ä–Ω–∞" = –ü–û–¢–í–™–†–ñ–î–ï–ù–ò–ï
   - –ê–∫–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç –ø–æ—Ç–≤—ä—Ä–¥–∏ (–∫–∞–∂–µ "–¥–∞"), –ù–ï –ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–∏ –ø—Ä–æ–º—è–Ω–∞—Ç–∞ –í–ï–î–ù–ê–ì–ê.
   - –ê–∫–æ –≤–µ—á–µ —Å–∏ –∑–∞–¥–∞–≤–∞–ª —Å—ä—â–∏—è –≤—ä–ø—Ä–æ—Å –≤ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞, –ù–ï –≥–æ –ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ - –ø—Ä–∏–ª–æ–∂–∏ –ø—Ä–æ–º—è–Ω–∞—Ç–∞!
   - –ù–ò–ö–û–ì–ê –Ω–µ –∑–∞–¥–∞–≤–∞–π –µ–¥–∏–Ω –∏ —Å—ä—â –≤—ä–ø—Ä–æ—Å –ø–æ–≤–µ—á–µ –æ—Ç –í–ï–î–ù–™–ñ.

4. –ù–ò–ö–û–ì–ê –Ω–µ –ø—Ä–∏–ª–∞–≥–∞–π –¥–∏—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–º—è–Ω–∞ –±–µ–∑ –æ–±—Å—ä–∂–¥–∞–Ω–µ! –í–∏–Ω–∞–≥–∏ –æ–±—è—Å–Ω–∏ –∏ –∫–æ–Ω—Å—É–ª—Ç–∏—Ä–∞–π –ø—ä—Ä–≤–æ.

5. –ó–ê –ü–†–ï–ú–ê–•–í–ê–ù–ï –ù–ê –ö–û–ù–ö–†–ï–¢–ù–ò –•–†–ê–ù–ò:
   - –ê–∫–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç –∏—Å–∫–∞ –¥–∞ –ø—Ä–µ–º–∞—Ö–Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —Ö—Ä–∞–Ω–∞ (–Ω–∞–ø—Ä. "–æ–≤–µ—Å–µ–Ω–∏ —è–¥–∫–∏"), –∏–∑–ø–æ–ª–∑–≤–∞–π —Å–ø–µ—Ü–∏–∞–ª–µ–Ω –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä:
   - –§–æ—Ä–º–∞—Ç: "exclude_food:–∏–º–µ_–Ω–∞_—Ö—Ä–∞–Ω–∞—Ç–∞" (–Ω–∞–ø—Ä. "exclude_food:–æ–≤–µ—Å–µ–Ω–∏ —è–¥–∫–∏")
   - –ü—Ä–∏–º–µ—Ä: [REGENERATE_PLAN:{"modifications":["exclude_food:–æ–≤–µ—Å–µ–Ω–∏ —è–¥–∫–∏"]}]
   - –¢–æ–≤–∞ —â–µ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞ –ø–ª–∞–Ω–∞ –ë–ï–ó —Ç–∞–∑–∏ —Ö—Ä–∞–Ω–∞

6. –ü–†–ò–ú–ï–† –° –§–û–†–ú–ê–¢–ò–†–ê–ù–ï:
   –ö–ª–∏–µ–Ω—Ç: "–ø—Ä–µ–º–∞—Ö–Ω–∏ –º–µ–∂–¥–∏–Ω–Ω–∏—Ç–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è"
   
   –û—Ç–≥–æ–≤–æ—Ä: "–†–∞–∑–±–∏—Ä–∞–º. –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ—Ç–æ –º–æ–∂–µ –¥–∞ –æ–ø—Ä–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–µ—Ç–æ, –Ω–æ –º–æ–∂–µ –∏ –¥–∞ –¥–æ–≤–µ–¥–µ –¥–æ –ø—Ä–µ—è–∂–¥–∞–Ω–µ.
   
   –ó–∞ —Ç–≤–æ—è—Ç–∞ —Ü–µ–ª –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞–º –µ–¥–Ω–∞ –æ—Ç –¥–≤–µ—Ç–µ:
   - –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –º–µ–∂–¥–∏–Ω–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (—Å–∞–º–æ 3 –æ—Å–Ω–æ–≤–Ω–∏)
   - –û—Å—Ç–∞–≤—è–Ω–µ –Ω–∞ 1 –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–∞ –∑–∞–∫—É—Å–∫–∞ (–ø–æ-–±–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–æ)
   
   –ö–∞–∫–≤–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—à?"
   
   [–ß–ê–ö–ê–ô –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–µ–¥–∏ REGENERATE_PLAN]
   
   –ö–ª–∏–µ–Ω—Ç: "–¥–∞" –∏–ª–∏ "–¥–æ–±—Ä–µ, –ø—Ä–µ–º–∞—Ö–Ω–∏ –≤—Å–∏—á–∫–∏"
   
   –û—Ç–≥–æ–≤–æ—Ä: "‚úì –†–∞–∑–±—Ä–∞–Ω–æ! –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–∞–º –ø–ª–∞–Ω–∞ —Å—ä—Å 3 –æ—Å–Ω–æ–≤–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è.
   
   [REGENERATE_PLAN:{"modifications":["3_meals_per_day"]}]"
   
   –ü–†–ò–ú–ï–† –ó–ê –ü–†–ï–ú–ê–•–í–ê–ù–ï –ù–ê –•–†–ê–ù–ê:
   –ö–ª–∏–µ–Ω—Ç: "–º–∞—Ö–Ω–∏ –æ–≤–µ—Å–µ–Ω–∏—Ç–µ —è–¥–∫–∏"
   
   –û—Ç–≥–æ–≤–æ—Ä: "–†–∞–∑–±–∏—Ä–∞–º. –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ—Ç–æ –Ω–∞ –æ–≤–µ—Å–µ–Ω–∏—Ç–µ —è–¥–∫–∏ —â–µ –Ω–∞–º–∞–ª–∏ —Ñ–∏–±—Ä–∏—Ç–µ –≤ –∑–∞–∫—É—Å–∫–∞—Ç–∞.
   
   –ò—Å–∫–∞—à –ª–∏ –¥–∞ –≥–∏ –ø—Ä–µ–º–∞—Ö–Ω–∞ –æ—Ç –≤—Å–∏—á–∫–∏ –¥–Ω–∏?"
   
   –ö–ª–∏–µ–Ω—Ç: "–¥–∞"
   
   –û—Ç–≥–æ–≤–æ—Ä: "‚úì –†–∞–∑–±—Ä–∞–Ω–æ! –ü—Ä–µ–º–∞—Ö–≤–∞–º –æ–≤–µ—Å–µ–Ω–∏—Ç–µ —è–¥–∫–∏ –æ—Ç –ø–ª–∞–Ω–∞.
   
   [REGENERATE_PLAN:{"modifications":["exclude_food:–æ–≤–µ—Å–µ–Ω–∏ —è–¥–∫–∏"]}]"

7. –ü–û–î–î–™–†–ñ–ê–ù–ò –ú–û–î–ò–§–ò–ö–ê–¶–ò–ò:
   - "no_intermediate_meals" - –±–µ–∑ –º–µ–∂–¥–∏–Ω–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
   - "3_meals_per_day" - 3 —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–æ
   - "4_meals_per_day" - 4 —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–æ
   - "vegetarian" - –≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∏ –ø–ª–∞–Ω
   - "no_dairy" - –±–µ–∑ –º–ª–µ—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏
   - "low_carb" - –Ω–∏—Å–∫–æ–≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–Ω–∞ –¥–∏–µ—Ç–∞
   - "increase_protein" - –ø–æ–≤–µ—á–µ –ø—Ä–æ—Ç–µ–∏–Ω–∏
   - "exclude_food:–∏–º–µ_–Ω–∞_—Ö—Ä–∞–Ω–∞" - –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —Ö—Ä–∞–Ω–∞

–ü–û–ú–ù–ò: 
- –§–æ—Ä–º–∞—Ç–∏—Ä–∞–π —è—Å–Ω–æ —Å –Ω–æ–≤–∏ —Ä–µ–¥–æ–≤–µ –∏ –∏–∑–±—Ä–æ—è–≤–∞–Ω–µ
- –ú–∞–∫—Å–∏–º—É–º 3-4 –∏–∑—Ä–µ—á–µ–Ω–∏—è
- –ú–∞–∫—Å–∏–º—É–º 1 –≤—ä–ø—Ä–æ—Å
- –ê–ö–û –∫–ª–∏–µ–Ω—Ç—ä—Ç –≤–µ—á–µ –ø–æ—Ç–≤—ä—Ä–¥–∏, –ù–ï –ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ - –ü–†–ò–õ–û–ñ–ò –í–ï–î–ù–ê–ì–ê!`;

        // Check if logged in
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (isLoggedIn === 'true') {
                showDashboard();
            }
        }

        // Login
        function login() {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showDashboard();
            } else {
                errorDiv.textContent = '–ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞!';
                errorDiv.style.display = 'block';
            }
        }

        // Logout
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
        }

        // Generic helper function to save prompts
        async function savePromptGeneric(type, elementId, localStorageKey, successMessage, errorMessage) {
            const prompt = document.getElementById(elementId).value.trim();
            
            // Empty prompts are allowed - they will cause the system to use defaults
            localStorage.setItem(localStorageKey, prompt);
            
            // Save to KV via worker API
            try {
                const response = await fetch(WORKER_URL + '/api/admin/save-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type, prompt: prompt || '' })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save to server');
                }
                
                showSuccess(successMessage);
            } catch (error) {
                console.error(`Error saving ${type} prompt:`, error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–µ: ' + error.message);
            }
        }

        // Generic helper function to reset prompts
        async function resetPromptGeneric(type, elementId, localStorageKey, successMessage) {
            if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–º–ø—Ç–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ?')) {
                document.getElementById(elementId).value = '';
                localStorage.removeItem(localStorageKey);
                
                // Delete from KV by saving empty string
                try {
                    const response = await fetch(WORKER_URL + '/api/admin/save-prompt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type, prompt: '' })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to reset on server');
                    }
                    
                    showSuccess(successMessage);
                } catch (error) {
                    console.error(`Error resetting ${type} prompt:`, error);
                    showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ: ' + error.message);
                }
            }
        }

        // Show Dashboard
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadSettings();
            loadStats();
            // Note: Blacklist, whitelist, and logging status are now loaded on-demand
            // when the user clicks the respective "Refresh" buttons to reduce backend load
        }

        // Load Settings
        async function loadSettings() {
            try {
                // Try to load from server (KV storage) first with caching
                try {
                    const config = await cachedFetch(
                        WORKER_URL + '/api/admin/get-config',
                        'admin:config',
                        CACHE_CONFIG.config
                    );
                    
                    if (config.success) {
                        // Use server data if available
                        if (config.provider) {
                            document.getElementById('aiProvider').value = config.provider;
                            localStorage.setItem('adminAIProvider', config.provider);
                        }
                        if (config.modelName) {
                            document.getElementById('aiModelName').value = config.modelName;
                            document.getElementById('currentModel').textContent = config.modelName.toUpperCase();
                            localStorage.setItem('adminAIModelName', config.modelName);
                        }
                            if (config.planPrompt) {
                                document.getElementById('aiPrompt').value = config.planPrompt;
                                localStorage.setItem('adminAIPrompt', config.planPrompt);
                            }
                            if (config.chatPrompt) {
                                // Store chat prompt even though there's no UI element for it yet
                                localStorage.setItem('adminChatPrompt', config.chatPrompt);
                            }
                            if (config.consultationPrompt) {
                                document.getElementById('consultationPrompt').value = config.consultationPrompt;
                                localStorage.setItem('adminConsultationPrompt', config.consultationPrompt);
                            }
                            if (config.modificationPrompt) {
                                document.getElementById('modificationPrompt').value = config.modificationPrompt;
                                localStorage.setItem('adminModificationPrompt', config.modificationPrompt);
                            }
                            if (config.analysisPrompt) {
                                document.getElementById('analysisPrompt').value = config.analysisPrompt;
                                localStorage.setItem('adminAnalysisPrompt', config.analysisPrompt);
                            }
                            if (config.strategyPrompt) {
                                document.getElementById('strategyPrompt').value = config.strategyPrompt;
                                localStorage.setItem('adminStrategyPrompt', config.strategyPrompt);
                            }
                            if (config.mealPlanPrompt) {
                                document.getElementById('mealPlanPrompt').value = config.mealPlanPrompt;
                                localStorage.setItem('adminMealPlanPrompt', config.mealPlanPrompt);
                            }
                            if (config.summaryPrompt) {
                                document.getElementById('summaryPrompt').value = config.summaryPrompt;
                                localStorage.setItem('adminSummaryPrompt', config.summaryPrompt);
                            }
                            if (config.correctionPrompt) {
                                document.getElementById('correctionPrompt').value = config.correctionPrompt;
                                localStorage.setItem('adminCorrectionPrompt', config.correctionPrompt);
                            }
                            return; // Successfully loaded from server
                        }
                } catch (serverError) {
                    console.warn('Could not load from server, using local cache:', serverError);
                }

                // Fallback to localStorage if server is unavailable
                const savedProvider = localStorage.getItem('adminAIProvider') || 'openai';
                document.getElementById('aiProvider').value = savedProvider;
                
                const savedModelName = localStorage.getItem('adminAIModelName') || 'gpt-4o-mini';
                document.getElementById('aiModelName').value = savedModelName;
                document.getElementById('currentModel').textContent = savedModelName.toUpperCase();

                const savedPrompt = localStorage.getItem('adminAIPrompt') || DEFAULT_PLAN_PROMPT;
                document.getElementById('aiPrompt').value = savedPrompt;

                const savedConsultationPrompt = localStorage.getItem('adminConsultationPrompt') || DEFAULT_CONSULTATION_PROMPT;
                document.getElementById('consultationPrompt').value = savedConsultationPrompt;

                const savedModificationPrompt = localStorage.getItem('adminModificationPrompt') || DEFAULT_MODIFICATION_PROMPT;
                document.getElementById('modificationPrompt').value = savedModificationPrompt;

                const savedAnalysisPrompt = localStorage.getItem('adminAnalysisPrompt') || '';
                document.getElementById('analysisPrompt').value = savedAnalysisPrompt;

                const savedStrategyPrompt = localStorage.getItem('adminStrategyPrompt') || '';
                document.getElementById('strategyPrompt').value = savedStrategyPrompt;

                const savedMealPlanPrompt = localStorage.getItem('adminMealPlanPrompt') || '';
                document.getElementById('mealPlanPrompt').value = savedMealPlanPrompt;

                const savedSummaryPrompt = localStorage.getItem('adminSummaryPrompt') || '';
                document.getElementById('summaryPrompt').value = savedSummaryPrompt;

                const savedCorrectionPrompt = localStorage.getItem('adminCorrectionPrompt') || '';
                document.getElementById('correctionPrompt').value = savedCorrectionPrompt;

            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Load Stats
        function loadStats() {
            // Mock stats - in production these would come from KV or analytics
            document.getElementById('totalUsers').textContent = '-';
            document.getElementById('totalPlans').textContent = '-';
        }

        // Save AI Model
        async function saveAIModel() {
            const provider = document.getElementById('aiProvider').value;
            const modelName = document.getElementById('aiModelName').value.trim();
            
            if (!modelName) {
                showError('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ –º–æ–¥–µ–ª!');
                return;
            }
            
            localStorage.setItem('adminAIProvider', provider);
            localStorage.setItem('adminAIModelName', modelName);
            
            // Save to KV via worker API
            try {
                const response = await fetch(WORKER_URL + '/api/admin/save-model', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ provider, modelName })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save to server');
                }
                
                // Invalidate config cache after successful save
                invalidateConfigCache();
                
                showSuccess('AI –º–æ–¥–µ–ª –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                document.getElementById('currentModel').textContent = modelName.toUpperCase();
            } catch (error) {
                console.error('Error saving model:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–µ: ' + error.message);
            }
        }

        // Save AI Prompt
        async function saveAIPrompt() {
            const prompt = document.getElementById('aiPrompt').value.trim();
            
            if (!prompt) {
                showError('–ü—Ä–æ–º–ø—Ç—ä—Ç –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
                return;
            }

            localStorage.setItem('adminAIPrompt', prompt);
            
            // Save to KV via worker API
            try {
                const response = await fetch(WORKER_URL + '/api/admin/save-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'plan', prompt })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save to server');
                }
                
                showSuccess('AI –ø—Ä–æ–º–ø—Ç –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('Error saving prompt:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–µ: ' + error.message);
            }
        }

        // Save Chat Prompt - Consultation Mode
        async function saveConsultationPrompt() {
            const prompt = document.getElementById('consultationPrompt').value.trim();
            
            if (!prompt) {
                showError('–ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–æ–Ω–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
                return;
            }

            localStorage.setItem('adminConsultationPrompt', prompt);
            
            // Save to KV via worker API
            try {
                const response = await fetch(WORKER_URL + '/api/admin/save-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'consultation', prompt })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save to server');
                }
                
                showSuccess('–ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–æ–Ω–µ–Ω –ø—Ä–æ–º–ø—Ç –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('Error saving consultation prompt:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–µ: ' + error.message);
            }
        }

        // Save Chat Prompt - Modification Mode
        async function saveModificationPrompt() {
            const prompt = document.getElementById('modificationPrompt').value.trim();
            
            if (!prompt) {
                showError('–ü—Ä–æ–º–ø—Ç—ä—Ç –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
                return;
            }

            localStorage.setItem('adminModificationPrompt', prompt);
            
            // Save to KV via worker API
            try {
                const response = await fetch(WORKER_URL + '/api/admin/save-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'modification', prompt })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save to server');
                }
                
                showSuccess('–ü—Ä–æ–º–ø—Ç –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('Error saving modification prompt:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–µ: ' + error.message);
            }
        }

        // Save Correction Prompt
        async function saveCorrectionPrompt() {
            await savePromptGeneric('correction', 'correctionPrompt', 'adminCorrectionPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!', '–ü—Ä–æ–º–ø—Ç—ä—Ç –∑–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
        }

        // Save Analysis Prompt
        async function saveAnalysisPrompt() {
            await savePromptGeneric('analysis', 'analysisPrompt', 'adminAnalysisPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ –∞–Ω–∞–ª–∏–∑ –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!', '–ü—Ä–æ–º–ø—Ç—ä—Ç –∑–∞ –∞–Ω–∞–ª–∏–∑ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
        }

        // Save Strategy Prompt
        async function saveStrategyPrompt() {
            await savePromptGeneric('strategy', 'strategyPrompt', 'adminStrategyPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!', '–ü—Ä–æ–º–ø—Ç—ä—Ç –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
        }

        // Save Meal Plan Prompt
        async function saveMealPlanPrompt() {
            await savePromptGeneric('meal_plan', 'mealPlanPrompt', 'adminMealPlanPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!', '–ü—Ä–æ–º–ø—Ç—ä—Ç –∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
        }

        // Save Summary Prompt
        async function saveSummaryPrompt() {
            await savePromptGeneric('summary', 'summaryPrompt', 'adminSummaryPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!', '–ü—Ä–æ–º–ø—Ç—ä—Ç –∑–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω!');
        }

        // Reset Analysis Prompt
        async function resetAnalysisPrompt() {
            await resetPromptGeneric('analysis', 'analysisPrompt', 'adminAnalysisPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ –∞–Ω–∞–ª–∏–∑ –∏–∑—Ç—Ä–∏—Ç. –©–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç.');
        }

        // Reset Strategy Prompt
        async function resetStrategyPrompt() {
            await resetPromptGeneric('strategy', 'strategyPrompt', 'adminStrategyPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–∑—Ç—Ä–∏—Ç. –©–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç.');
        }

        // Reset Meal Plan Prompt
        async function resetMealPlanPrompt() {
            await resetPromptGeneric('meal_plan', 'mealPlanPrompt', 'adminMealPlanPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω –∏–∑—Ç—Ä–∏—Ç. –©–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç.');
        }

        // Reset Summary Prompt
        async function resetSummaryPrompt() {
            await resetPromptGeneric('summary', 'summaryPrompt', 'adminSummaryPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –∏–∑—Ç—Ä–∏—Ç. –©–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç.');
        }

        // Reset Correction Prompt
        async function resetCorrectionPrompt() {
            await resetPromptGeneric('correction', 'correctionPrompt', 'adminCorrectionPrompt', 
                '–ü—Ä–æ–º–ø—Ç –∑–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –∏–∑—Ç—Ä–∏—Ç. –©–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç.');
        }

        // Reset Prompt
        function resetPrompt() {
            if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–º–ø—Ç–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ?')) {
                document.getElementById('aiPrompt').value = DEFAULT_PLAN_PROMPT;
                showSuccess('–ü—Ä–æ–º–ø—Ç –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ.');
            }
        }

        // View Default Prompt - Load default prompt from worker.js via API
        async function viewDefaultPrompt(promptType, elementId) {
            try {
                // Fetch the actual default prompt from worker.js with caching
                const data = await cachedFetch(
                    `${WORKER_URL}/api/admin/get-default-prompt?type=${promptType}`,
                    `admin:defaultPrompt:${promptType}`,
                    CACHE_CONFIG.defaultPrompts
                );
                
                if (data.success && data.prompt) {
                    document.getElementById(elementId).value = data.prompt;
                    showSuccess(`–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è—Ç –ø—Ä–æ–º–ø—Ç –æ—Ç worker.js –∑–∞ ${promptType} –µ –∑–∞—Ä–µ–¥–µ–Ω –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –ú–æ–∂–µ—Ç–µ –¥–∞ –≥–æ –ø—Ä–µ–≥–ª–µ–¥–∞—Ç–µ –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç–µ.`);
                } else {
                    showError(`–ì—Ä–µ—à–∫–∞: –ù—è–º–∞ –Ω–∞–ª–∏—á–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ø—Ä–æ–º–ø—Ç –∑–∞ —Ç–∏–ø "${promptType}".`);
                }
            } catch (error) {
                console.error('Error fetching default prompt:', error);
                showError(`–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω –ø—Ä–æ–º–ø—Ç: ${error.message}`);
            }
        }

        // Color Scheme Functions
        const colorSchemes = {
            'purple-pink': {
                primary: '#10b981',
                primaryAccent: '#34d399',
                secondary: '#3b82f6',
                tertiary: '#ff7f6a',
                soft: '#ecfdf5',
                name: '–ó–µ–ª–µ–Ω–æ-–°–∏–Ω—å–æ-–ö–æ—Ä–∞–ª'
            },
            'green-blue': {
                primary: '#4CAF50',
                primaryAccent: '#66BB6A',
                secondary: '#42A5F5',
                tertiary: '#ff8a65',
                soft: '#E8F5E9',
                name: '–ó–µ–ª–µ–Ω–æ-–°–∏–Ω—è-–ö–æ—Ä–∞–ª'
            },
            'blue-indigo': {
                primary: '#3B82F6',
                primaryAccent: '#60A5FA',
                secondary: '#6366F1',
                tertiary: '#ff7f6a',
                soft: '#EFF6FF',
                name: '–°–∏–Ω—å–æ-–ò–Ω–¥–∏–≥–æ-–ö–æ—Ä–∞–ª'
            },
            'orange-red': {
                primary: '#F97316',
                primaryAccent: '#FB923C',
                secondary: '#EF4444',
                tertiary: '#ff7f6a',
                soft: '#FFF7ED',
                name: '–û—Ä–∞–Ω–∂–µ–≤–æ-–ß–µ—Ä–≤–µ–Ω–æ-–ö–æ—Ä–∞–ª'
            },
            'custom': {
                primary: '#10b981',
                primaryAccent: '#34d399',
                secondary: '#3b82f6',
                tertiary: '#ff7f6a',
                soft: '#ecfdf5',
                name: '–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∞'
            }
        };

        function previewColorScheme() {
            const scheme = document.getElementById('colorScheme').value;
            const customSection = document.getElementById('customColorSection');
            
            // Show/hide custom color picker
            if (scheme === 'custom') {
                customSection.style.display = 'block';
                // Load saved custom colors or use defaults
                const savedCustomColors = localStorage.getItem('customColors');
                if (savedCustomColors) {
                    const colors = JSON.parse(savedCustomColors);
                    document.getElementById('customPrimary').value = colors.primary;
                    document.getElementById('customSecondary').value = colors.secondary;
                    document.getElementById('customAccent').value = colors.tertiary;
                }
                // Add event listeners to update preview in real-time (remove old ones first to avoid duplicates)
                const primaryInput = document.getElementById('customPrimary');
                const secondaryInput = document.getElementById('customSecondary');
                const accentInput = document.getElementById('customAccent');
                
                primaryInput.removeEventListener('input', updateCustomPreview);
                secondaryInput.removeEventListener('input', updateCustomPreview);
                accentInput.removeEventListener('input', updateCustomPreview);
                
                primaryInput.addEventListener('input', updateCustomPreview);
                secondaryInput.addEventListener('input', updateCustomPreview);
                accentInput.addEventListener('input', updateCustomPreview);
                updateCustomPreview();
            } else {
                customSection.style.display = 'none';
                const colors = colorSchemes[scheme];
                const preview = document.getElementById('colorPreview');
                
                preview.innerHTML = `
                    <div style="padding: 30px; border-radius: 12px; text-align: center; color: white; font-weight: bold; background: ${colors.primary};">
                        –û—Å–Ω–æ–≤–µ–Ω
                    </div>
                    <div style="padding: 30px; border-radius: 12px; text-align: center; color: white; font-weight: bold; background: ${colors.secondary};">
                        –í—Ç–æ—Ä–∏—á–µ–Ω
                    </div>
                    <div style="padding: 30px; border-radius: 12px; text-align: center; font-weight: bold; color: white; background: ${colors.tertiary};">
                        –ê–∫—Ü–µ–Ω—Ç
                    </div>
                `;
            }
        }
        
        function updateCustomPreview() {
            const primary = document.getElementById('customPrimary').value;
            const secondary = document.getElementById('customSecondary').value;
            const accent = document.getElementById('customAccent').value;
            const preview = document.getElementById('colorPreview');
            
            preview.innerHTML = `
                <div style="padding: 30px; border-radius: 12px; text-align: center; color: white; font-weight: bold; background: ${primary};">
                    –û—Å–Ω–æ–≤–µ–Ω
                </div>
                <div style="padding: 30px; border-radius: 12px; text-align: center; color: white; font-weight: bold; background: ${secondary};">
                    –í—Ç–æ—Ä–∏—á–µ–Ω
                </div>
                <div style="padding: 30px; border-radius: 12px; text-align: center; font-weight: bold; color: white; background: ${accent};">
                    –ê–∫—Ü–µ–Ω—Ç
                </div>
            `;
        }

        async function saveColorScheme() {
            const scheme = document.getElementById('colorScheme').value;
            
            try {
                if (scheme === 'custom') {
                    // Save custom colors
                    const customColors = {
                        primary: document.getElementById('customPrimary').value,
                        secondary: document.getElementById('customSecondary').value,
                        tertiary: document.getElementById('customAccent').value,
                        // Generate light version (slightly lighter) and dark version
                        primaryAccent: lightenColor(document.getElementById('customPrimary').value, 20),
                        soft: lightenColor(document.getElementById('customPrimary').value, 80)
                    };
                    localStorage.setItem('customColors', JSON.stringify(customColors));
                    localStorage.setItem('colorScheme', scheme);
                    showSuccess('–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∞—Ç–∞ —Ü–≤–µ—Ç–æ–≤–∞ —Å—Ö–µ–º–∞ –µ –∑–∞–ø–∞–∑–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                } else {
                    localStorage.setItem('colorScheme', scheme);
                    showSuccess(`–¶–≤–µ—Ç–æ–≤–∞—Ç–∞ —Å—Ö–µ–º–∞ "${colorSchemes[scheme].name}" –µ –∑–∞–ø–∞–∑–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!`);
                }
                
                // In a real implementation, this would save to the backend
                // await fetch('/api/admin/color-scheme', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ scheme })
                // });
            } catch (error) {
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—Ç–∞ —Å—Ö–µ–º–∞: ' + error.message);
            }
        }
        
        // Helper function to lighten colors for soft backgrounds and light theme variants
        function lightenColor(hex, percent) {
            // Parse hex color to integer
            const num = parseInt(hex.replace('#', ''), 16);
            // Calculate amount to add (percent of 255)
            const amt = Math.round(2.55 * percent);
            // Extract RGB channels using bit shifting and add amount
            const R = (num >> 16) + amt;  // Red channel (bits 16-23)
            const G = (num >> 8 & 0x00FF) + amt;  // Green channel (bits 8-15)
            const B = (num & 0x0000FF) + amt;  // Blue channel (bits 0-7)
            // Clamp values to 0-255 range and reconstruct hex
            return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        // Load saved color scheme
        function loadColorScheme() {
            const savedScheme = localStorage.getItem('colorScheme') || 'purple-pink';
            document.getElementById('colorScheme').value = savedScheme;
            previewColorScheme();
        }

        // --- Blacklist Management ---
        let currentBlacklist = [];

        // Load blacklist from KV storage
        async function loadBlacklist() {
            const container = document.getElementById('blacklistDisplay');
            try {
                const result = await cachedFetch(
                    WORKER_URL + '/api/admin/get-blacklist',
                    'admin:blacklist',
                    CACHE_CONFIG.blacklist
                );
                
                currentBlacklist = result.blacklist || [];
                displayBlacklist();
                showSuccess('–ß–µ—Ä–Ω–∏—è—Ç —Å–ø–∏—Å—ä–∫ –µ –∑–∞—Ä–µ–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('Error loading blacklist:', error);
                // Reset to empty - defaults will be loaded on next successful fetch from backend
                currentBlacklist = [];
                displayBlacklist();
                showError('–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥–∏ —á–µ—Ä–Ω–∏—è—Ç —Å–ø–∏—Å—ä–∫. –ú–æ–ª—è, –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.');
            }
        }

        // Display blacklist items
        function displayBlacklist() {
            const container = document.getElementById('blacklistDisplay');
            if (currentBlacklist.length === 0) {
                container.innerHTML = '<p style="color: var(--text-gray); text-align: center;">–ù—è–º–∞ —Ö—Ä–∞–Ω–∏ –≤ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫.</p>';
                return;
            }

            const itemsHTML = currentBlacklist.map((item, index) => `
                <div style="display: inline-flex; align-items: center; background: var(--white); padding: 8px 12px; border-radius: 20px; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <span style="color: var(--text-dark);">${escapeHtml(item)}</span>
                    <button onclick="removeFromBlacklist(${index})" style="background: none; border: none; color: var(--accent-light-red); cursor: pointer; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');

            container.innerHTML = `<div style="display: flex; flex-wrap: wrap; gap: 8px;">${itemsHTML}</div>`;
        }

        // Add item to blacklist
        async function addToBlacklist() {
            const input = document.getElementById('blacklistInput');
            const item = input.value.trim().toLowerCase();
            
            if (!item) {
                showError('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ —Ö—Ä–∞–Ω–∞');
                return;
            }

            if (currentBlacklist.includes(item)) {
                showError('–¢–∞–∑–∏ —Ö—Ä–∞–Ω–∞ –≤–µ—á–µ –µ –≤ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫');
                return;
            }

            try {
                const response = await fetch(WORKER_URL + '/api/admin/add-to-blacklist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ item: item })
                });

                if (!response.ok) {
                    throw new Error('Failed to add to blacklist');
                }

                const result = await response.json();
                currentBlacklist = result.blacklist || [...currentBlacklist, item];
                
                // Invalidate blacklist cache after successful modification
                invalidateBlacklistCache();
                
                displayBlacklist();
                input.value = '';
                showSuccess(`"${item}" –µ –¥–æ–±–∞–≤–µ–Ω–∞ –≤ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫!`);
            } catch (error) {
                console.error('Error adding to blacklist:', error);
                // Fallback to local update
                currentBlacklist.push(item);
                displayBlacklist();
                input.value = '';
                showSuccess(`"${item}" –µ –¥–æ–±–∞–≤–µ–Ω–∞ –ª–æ–∫–∞–ª–Ω–æ –≤ —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫!`);
            }
        }

        // Remove item from blacklist
        async function removeFromBlacklist(index) {
            const item = currentBlacklist[index];
            if (!confirm(`–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –ø—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ "${item}" –æ—Ç —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫?`)) {
                return;
            }

            try {
                const response = await fetch(WORKER_URL + '/api/admin/remove-from-blacklist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ item: item })
                });

                if (!response.ok) {
                    throw new Error('Failed to remove from blacklist');
                }

                const result = await response.json();
                currentBlacklist = result.blacklist || currentBlacklist.filter((_, i) => i !== index);
                
                // Invalidate blacklist cache after successful modification
                invalidateBlacklistCache();
                
                displayBlacklist();
                showSuccess(`"${item}" –µ –ø—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ –æ—Ç —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫!`);
            } catch (error) {
                console.error('Error removing from blacklist:', error);
                // Fallback to local update
                currentBlacklist.splice(index, 1);
                displayBlacklist();
                showSuccess(`"${item}" –µ –ø—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ –ª–æ–∫–∞–ª–Ω–æ –æ—Ç —á–µ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫!`);
            }
        }

        // --- Push Notifications Management ---
        
        // Load notification settings on page load
        async function loadNotificationSettings() {
            try {
                const result = await cachedFetch(
                    WORKER_URL + '/api/admin/notification-settings',
                    'admin:notification-settings',
                    CACHE_CONFIG.short
                );
                
                if (result.success && result.settings) {
                    const settings = result.settings;
                    
                    // Cache global settings in localStorage for client-side use
                    localStorage.setItem('globalNotificationSettings', JSON.stringify(settings));
                    // Use version from backend, not client-generated
                    if (result.version) {
                        localStorage.setItem('globalNotificationSettingsVersion', result.version.toString());
                    }
                    
                    // Global enable
                    document.getElementById('notificationsEnabled').checked = settings.enabled !== false;
                    
                    // Chat notifications
                    document.getElementById('chatNotificationsEnabled').checked = settings.chatMessages !== false;
                    
                    // Water reminders
                    document.getElementById('waterRemindersEnabled').checked = settings.waterReminders?.enabled !== false;
                    document.getElementById('waterFrequency').value = settings.waterReminders?.frequency || 2;
                    document.getElementById('waterStartHour').value = settings.waterReminders?.startHour || 8;
                    document.getElementById('waterEndHour').value = settings.waterReminders?.endHour || 22;
                    
                    // Meal reminders
                    document.getElementById('mealRemindersEnabled').checked = settings.mealReminders?.enabled !== false;
                    document.getElementById('breakfastTime').value = settings.mealReminders?.breakfast || '08:00';
                    document.getElementById('lunchTime').value = settings.mealReminders?.lunch || '13:00';
                    document.getElementById('dinnerTime').value = settings.mealReminders?.dinner || '19:00';
                    document.getElementById('snackRemindersEnabled').checked = settings.mealReminders?.snacks === true;
                    
                    // Update status badge
                    updateNotificationStatusBadge(settings.enabled);
                    
                    showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ!');
                } else {
                    throw new Error('Invalid response');
                }
            } catch (error) {
                console.error('Error loading notification settings:', error);
                showError('–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥—è—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è.');
            }
        }
        
        // Save notification settings
        async function saveNotificationSettings() {
            try {
                const settings = {
                    enabled: document.getElementById('notificationsEnabled').checked,
                    chatMessages: document.getElementById('chatNotificationsEnabled').checked,
                    waterReminders: {
                        enabled: document.getElementById('waterRemindersEnabled').checked,
                        frequency: parseInt(document.getElementById('waterFrequency').value) || 2,
                        startHour: parseInt(document.getElementById('waterStartHour').value) || 8,
                        endHour: parseInt(document.getElementById('waterEndHour').value) || 22
                    },
                    mealReminders: {
                        enabled: document.getElementById('mealRemindersEnabled').checked,
                        breakfast: document.getElementById('breakfastTime').value || '08:00',
                        lunch: document.getElementById('lunchTime').value || '13:00',
                        dinner: document.getElementById('dinnerTime').value || '19:00',
                        snacks: document.getElementById('snackRemindersEnabled').checked
                    }
                };
                
                const response = await fetch(WORKER_URL + '/api/admin/notification-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Clear cache
                    clearCacheKey('admin:notification-settings');
                    updateNotificationStatusBadge(settings.enabled);
                    
                    // Cache global settings in localStorage for client-side scheduling
                    localStorage.setItem('globalNotificationSettings', JSON.stringify(settings));
                    // Use version from backend response
                    if (result.version) {
                        localStorage.setItem('globalNotificationSettingsVersion', result.version.toString());
                    }
                    
                    showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ! –ö–ª–∏–µ–Ω—Ç–∏—Ç–µ —â–µ –ø–æ–ª—É—á–∞—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏—Ç–µ.');
                } else {
                    throw new Error(result.error || 'Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving notification settings:', error);
                showError('–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞–ø–∞–∑—è—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ: ' + error.message);
            }
        }
        
        // Update notification status badge
        function updateNotificationStatusBadge(enabled) {
            const badge = document.getElementById('notificationEnabledBadge');
            if (enabled) {
                badge.textContent = '‚úì –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–∏';
                badge.style.background = '#d4edda';
                badge.style.color = '#155724';
            } else {
                badge.textContent = '‚úó –î–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–∏';
                badge.style.background = '#f8d7da';
                badge.style.color = '#721c24';
            }
        }
        
        // Send test notification
        async function sendTestNotification() {
            try {
                // Prompt for user ID or use default test ID
                const userId = prompt(
                    '–í—ä–≤–µ–¥–µ—Ç–µ User ID –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª —Å –∞–∫—Ç–∏–≤–µ–Ω push subscription:\n\n' +
                    '–ó–∞–±–µ–ª–µ–∂–∫–∞: –ú–æ–∂–µ—Ç–µ –¥–∞ –Ω–∞–º–µ—Ä–∏—Ç–µ User ID –≤ browser console –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è ' +
                    '(localStorage.getItem("userId")) –∏–ª–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ "admin-test" –∑–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ.',
                    'admin-test'
                );
                
                if (!userId) {
                    return; // User cancelled
                }
                
                const response = await fetch(WORKER_URL + '/api/push/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userId,
                        title: '–¢–µ—Å—Ç–æ–≤–æ –∏–∑–≤–µ—Å—Ç–∏–µ –æ—Ç NutriPlan',
                        body: '–¢–æ–≤–∞ –µ —Ç–µ—Å—Ç–æ–≤–æ –∏–∑–≤–µ—Å—Ç–∏–µ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞.',
                        url: '/admin.html',
                        notificationType: 'general'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('–¢–µ—Å—Ç–æ–≤–æ—Ç–æ –∏–∑–≤–µ—Å—Ç–∏–µ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
                } else {
                    throw new Error(result.message || result.error || 'Failed to send notification');
                }
            } catch (error) {
                console.error('Error sending test notification:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ –∏–∑–≤–µ—Å—Ç–∏–µ: ' + error.message);
            }
        }
        
        // Check VAPID key status
        async function checkVapidKeyStatus() {
            try {
                const response = await fetch(WORKER_URL + '/api/push/vapid-public-key');
                const result = await response.json();
                
                const statusEl = document.getElementById('vapidKeyStatus');
                if (result.success && result.publicKey && result.publicKey !== 'VAPID_PUBLIC_KEY_NOT_CONFIGURED') {
                    statusEl.textContent = '‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω';
                    statusEl.style.color = '#28a745';
                } else {
                    statusEl.textContent = '‚úó –ù–µ –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω';
                    statusEl.style.color = '#dc3545';
                }
            } catch (error) {
                console.error('Error checking VAPID key:', error);
                document.getElementById('vapidKeyStatus').textContent = '? –ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
            }
        }

        // --- Admin Messaging Functions ---
        async function sendAdminMessage() {
            const userId = document.getElementById('messageUserId').value.trim();
            const message = document.getElementById('messageText').value.trim();

            if (!userId || !message) {
                showError('–ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–µ—Ç–µ User ID –∏ —Å—ä–æ–±—â–µ–Ω–∏–µ.');
                return;
            }

            try {
                const response = await fetch(WORKER_URL + '/api/admin/send-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, message })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('–°—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
                    document.getElementById('messageUserId').value = '';
                    document.getElementById('messageText').value = '';
                } else {
                    throw new Error(result.error || 'Failed to send message');
                }
            } catch (error) {
                console.error('Error sending admin message:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ: ' + error.message);
            }
        }

        // --- Notification Templates Functions ---
        let currentTemplateData = null; // Store loaded templates to preserve times and other metadata

        async function loadNotificationTemplates() {
            try {
                const result = await cachedFetch(
                    WORKER_URL + '/api/admin/notification-templates',
                    'admin:notification-templates',
                    CACHE_CONFIG.short
                );

                if (result.success && result.templates) {
                    const t = result.templates;
                    currentTemplateData = t; // Store for preserving metadata during saves
                    
                    // Cache templates in localStorage for client-side use
                    localStorage.setItem('notificationTemplates', JSON.stringify(t));
                    // Use version from backend, not client-generated
                    if (result.version) {
                        localStorage.setItem('notificationTemplatesVersion', result.version.toString());
                    }

                    // Meal templates
                    document.getElementById('templateMealBreakfastTitle').value = t.meals?.breakfast?.title || '';
                    document.getElementById('templateMealBreakfastBody').value = t.meals?.breakfast?.body || '';
                    document.getElementById('templateMealLunchTitle').value = t.meals?.lunch?.title || '';
                    document.getElementById('templateMealLunchBody').value = t.meals?.lunch?.body || '';
                    document.getElementById('templateMealDinnerTitle').value = t.meals?.dinner?.title || '';
                    document.getElementById('templateMealDinnerBody').value = t.meals?.dinner?.body || '';
                    document.getElementById('templateMealSnackTitle').value = t.meals?.snack?.title || '';
                    document.getElementById('templateMealSnackBody').value = t.meals?.snack?.body || '';

                    // Water template
                    document.getElementById('templateWaterTitle').value = t.water?.title || '';
                    document.getElementById('templateWaterBody').value = t.water?.body || '';

                    // Sleep template
                    document.getElementById('templateSleepTitle').value = t.sleep?.title || '';
                    document.getElementById('templateSleepBody').value = t.sleep?.body || '';

                    // Activity templates
                    document.getElementById('templateActivityMorningTitle').value = t.activity?.morning?.title || '';
                    document.getElementById('templateActivityMorningBody').value = t.activity?.morning?.body || '';
                    document.getElementById('templateActivityDayTitle').value = t.activity?.day?.title || '';
                    document.getElementById('templateActivityDayBody').value = t.activity?.day?.body || '';

                    // Supplements template
                    document.getElementById('templateSupplementsTitle').value = t.supplements?.title || '';
                    document.getElementById('templateSupplementsBody').value = t.supplements?.body || '';

                    showSuccess('–®–∞–±–ª–æ–Ω–∏—Ç–µ —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ!');
                }
            } catch (error) {
                console.error('Error loading notification templates:', error);
                showError('–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥—è—Ç —à–∞–±–ª–æ–Ω–∏—Ç–µ.');
            }
        }

        async function saveNotificationTemplates() {
            try {
                // Preserve times from loaded templates or use defaults
                const templates = {
                    meals: {
                        breakfast: {
                            title: document.getElementById('templateMealBreakfastTitle').value,
                            body: document.getElementById('templateMealBreakfastBody').value,
                            time: currentTemplateData?.meals?.breakfast?.time || '08:00'
                        },
                        lunch: {
                            title: document.getElementById('templateMealLunchTitle').value,
                            body: document.getElementById('templateMealLunchBody').value,
                            time: currentTemplateData?.meals?.lunch?.time || '13:00'
                        },
                        dinner: {
                            title: document.getElementById('templateMealDinnerTitle').value,
                            body: document.getElementById('templateMealDinnerBody').value,
                            time: currentTemplateData?.meals?.dinner?.time || '19:00'
                        },
                        snack: {
                            title: document.getElementById('templateMealSnackTitle').value,
                            body: document.getElementById('templateMealSnackBody').value,
                            time: currentTemplateData?.meals?.snack?.time || '10:30'
                        }
                    },
                    water: {
                        title: document.getElementById('templateWaterTitle').value,
                        body: document.getElementById('templateWaterBody').value,
                        frequency: currentTemplateData?.water?.frequency || 2
                    },
                    sleep: {
                        title: document.getElementById('templateSleepTitle').value,
                        body: document.getElementById('templateSleepBody').value,
                        time: currentTemplateData?.sleep?.time || '22:00'
                    },
                    activity: {
                        morning: {
                            title: document.getElementById('templateActivityMorningTitle').value,
                            body: document.getElementById('templateActivityMorningBody').value,
                            time: currentTemplateData?.activity?.morning?.time || '07:00'
                        },
                        day: {
                            title: document.getElementById('templateActivityDayTitle').value,
                            body: document.getElementById('templateActivityDayBody').value,
                            time: currentTemplateData?.activity?.day?.time || '15:00'
                        }
                    },
                    supplements: {
                        title: document.getElementById('templateSupplementsTitle').value,
                        body: document.getElementById('templateSupplementsBody').value,
                        times: currentTemplateData?.supplements?.times || []
                    }
                };

                const response = await fetch(WORKER_URL + '/api/admin/notification-templates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ templates })
                });

                const result = await response.json();

                if (result.success) {
                    clearCache('admin:notification-templates');
                    
                    // Cache templates in localStorage for client-side use
                    localStorage.setItem('notificationTemplates', JSON.stringify(templates));
                    // Use version from backend response
                    if (result.version) {
                        localStorage.setItem('notificationTemplatesVersion', result.version.toString());
                    }
                    
                    showSuccess('–®–∞–±–ª–æ–Ω–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ! –ö–ª–∏–µ–Ω—Ç–∏—Ç–µ —â–µ –ø–æ–ª—É—á–∞—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏—Ç–µ –ø—Ä–∏ —Å–ª–µ–¥–≤–∞—â–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ.');
                    console.log('Templates cached in localStorage with version:', result.version);
                } else {
                    throw new Error(result.error || 'Failed to save templates');
                }
            } catch (error) {
                console.error('Error saving notification templates:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ —à–∞–±–ª–æ–Ω–∏.');
            }
        }

        // --- Whitelist Management ---
        let currentWhitelist = [];

        // Load whitelist from KV storage
        async function loadWhitelist() {
            const container = document.getElementById('whitelistDisplay');
            try {
                const result = await cachedFetch(
                    WORKER_URL + '/api/admin/get-whitelist',
                    'admin:whitelist',
                    CACHE_CONFIG.whitelist
                );
                
                currentWhitelist = result.whitelist || [];
                displayWhitelist();
                showSuccess('–ë–µ–ª–∏—è—Ç —Å–ø–∏—Å—ä–∫ –µ –∑–∞—Ä–µ–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('Error loading whitelist:', error);
                // Reset to empty - defaults will be loaded on next successful fetch from backend
                currentWhitelist = [];
                displayWhitelist();
                showError('–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥–∏ –±–µ–ª–∏—è—Ç —Å–ø–∏—Å—ä–∫. –ú–æ–ª—è, –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.');
            }
        }

        // Display whitelist items
        function displayWhitelist() {
            const container = document.getElementById('whitelistDisplay');
            if (currentWhitelist.length === 0) {
                container.innerHTML = '<p style="color: var(--text-gray); text-align: center;">–ù—è–º–∞ —Ö—Ä–∞–Ω–∏ –≤ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫.</p>';
                return;
            }

            const itemsHTML = currentWhitelist.map((item, index) => `
                <div style="display: inline-flex; align-items: center; background: var(--white); padding: 8px 12px; border-radius: 20px; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <span style="color: var(--text-dark);">${escapeHtml(item)}</span>
                    <button onclick="removeFromWhitelist(${index})" style="background: none; border: none; color: #28a745; cursor: pointer; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');

            container.innerHTML = `<div style="display: flex; flex-wrap: wrap; gap: 8px;">${itemsHTML}</div>`;
        }

        // Add item to whitelist
        async function addToWhitelist() {
            const input = document.getElementById('whitelistInput');
            const item = input.value.trim().toLowerCase();
            
            if (!item) {
                showError('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ —Ö—Ä–∞–Ω–∞');
                return;
            }

            if (currentWhitelist.includes(item)) {
                showError('–¢–∞–∑–∏ —Ö—Ä–∞–Ω–∞ –≤–µ—á–µ –µ –≤ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫');
                return;
            }

            try {
                const response = await fetch(WORKER_URL + '/api/admin/add-to-whitelist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ item: item })
                });

                if (!response.ok) {
                    throw new Error('Failed to add to whitelist');
                }

                const result = await response.json();
                currentWhitelist = result.whitelist || [...currentWhitelist, item];
                
                // Invalidate whitelist cache after successful modification
                invalidateWhitelistCache();
                
                displayWhitelist();
                input.value = '';
                showSuccess(`"${item}" –µ –¥–æ–±–∞–≤–µ–Ω–∞ –≤ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫!`);
            } catch (error) {
                console.error('Error adding to whitelist:', error);
                // Fallback to local update
                currentWhitelist.push(item);
                displayWhitelist();
                input.value = '';
                showSuccess(`"${item}" –µ –¥–æ–±–∞–≤–µ–Ω–∞ –ª–æ–∫–∞–ª–Ω–æ –≤ –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫!`);
            }
        }

        // Remove item from whitelist
        async function removeFromWhitelist(index) {
            const item = currentWhitelist[index];
            if (!confirm(`–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –ø—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ "${item}" –æ—Ç –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫?`)) {
                return;
            }

            try {
                const response = await fetch(WORKER_URL + '/api/admin/remove-from-whitelist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ item: item })
                });

                if (!response.ok) {
                    throw new Error('Failed to remove from whitelist');
                }

                const result = await response.json();
                currentWhitelist = result.whitelist || currentWhitelist.filter((_, i) => i !== index);
                
                // Invalidate whitelist cache after successful modification
                invalidateWhitelistCache();
                
                displayWhitelist();
                showSuccess(`"${item}" –µ –ø—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ –æ—Ç –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫!`);
            } catch (error) {
                console.error('Error removing from whitelist:', error);
                // Fallback to local update
                currentWhitelist.splice(index, 1);
                displayWhitelist();
                showSuccess(`"${item}" –µ –ø—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ –ª–æ–∫–∞–ª–Ω–æ –æ—Ç –±–µ–ª–∏—è —Å–ø–∏—Å—ä–∫!`);
            }
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load Problem Reports
        async function loadReports() {
            const container = document.getElementById('reportsContainer');
            container.innerHTML = '<p style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>';
            
            try {
                const result = await cachedFetch(
                    WORKER_URL + '/api/admin/get-reports',
                    'admin:reports',
                    CACHE_CONFIG.reports
                );
                
                if (result.success && result.reports) {
                    if (result.reports.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">–ù—è–º–∞ –¥–æ–∫–ª–∞–¥–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ.</p>';
                        return;
                    }
                    
                    // Display reports
                    let html = '';
                    result.reports.forEach(report => {
                        const date = new Date(report.timestamp);
                        const dateStr = date.toLocaleString('bg-BG');
                        
                        html += `
                            <div class="report-item">
                                <div class="report-header">
                                    <div class="report-user">
                                        <i class="fas fa-user-circle"></i>
                                        <span>${escapeHtml(report.userName)}</span>
                                        <span class="report-badge badge-${report.status || 'unread'}">${report.status === 'read' ? '–ü—Ä–æ—á–µ—Ç–µ–Ω' : '–ù–µ–ø—Ä–æ—á–µ—Ç–µ–Ω'}</span>
                                    </div>
                                    <div class="report-time">
                                        <i class="fas fa-clock"></i> ${dateStr}
                                    </div>
                                </div>
                                <div class="report-message">
                                    ${escapeHtml(report.message)}
                                </div>
                                <div class="report-meta">
                                    <span><i class="fas fa-hashtag"></i> ID: ${report.id}</span>
                                    <span><i class="fas fa-id-badge"></i> User ID: ${escapeHtml(report.userId)}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    showSuccess(`–ó–∞—Ä–µ–¥–µ–Ω–∏ ${result.reports.length} –¥–æ–∫–ª–∞–¥–∞`);
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                container.innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 20px;"><i class="fas fa-exclamation-circle"></i> –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–æ–∫–ª–∞–¥–∏</p>';
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–æ–∫–ª–∞–¥–∏: ' + error.message);
            }
        }

        // Load clients list
        let allClientsData = []; // Store all clients for filtering
        
        async function loadClientsList() {
            const container = document.getElementById('clientsListContainer');
            const statsContainer = document.getElementById('clientsStatsContainer');
            container.innerHTML = '<p style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>';
            
            try {
                const response = await fetch(WORKER_URL + '/api/admin/get-clients-list');
                const result = await response.json();
                
                if (result.success && result.clients) {
                    allClientsData = result.clients; // Store for filtering
                    
                    // Update stats
                    document.getElementById('totalClients').textContent = result.total;
                    document.getElementById('showingClients').textContent = result.showing;
                    statsContainer.style.display = 'block';
                    
                    if (result.clients.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">–ù—è–º–∞ –∫–ª–∏–µ–Ω—Ç–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ.</p>';
                        return;
                    }
                    
                    displayClients(result.clients);
                    showSuccess(`–ó–∞—Ä–µ–¥–µ–Ω–∏ ${result.clients.length} –∫–ª–∏–µ–Ω—Ç–∞ –æ—Ç –æ–±—â–æ ${result.total}`);
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('Error loading clients:', error);
                container.innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 20px;"><i class="fas fa-exclamation-circle"></i> –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏</p>';
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏: ' + error.message);
            }
        }
        
        function displayClients(clients) {
            const container = document.getElementById('clientsListContainer');
            
            if (clients.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∏.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            
            clients.forEach(client => {
                const submittedDate = new Date(client.submittedAt || client.timestamp);
                const dateStr = submittedDate.toLocaleString('bg-BG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                html += `
                    <div class="client-card" data-client-id="${escapeHtml(client.id)}" data-client-name="${escapeHtml(client.name)}" style="background: var(--card-bg); padding: 20px; border-radius: 12px; border: 2px solid #e0e0e0; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                            <div style="flex: 1; min-width: 200px;">
                                <h3 style="margin: 0 0 5px 0; color: var(--text-dark);">
                                    <i class="fas fa-user"></i> ${escapeHtml(client.name)}
                                </h3>
                                <p style="margin: 5px 0; color: var(--text-gray); font-size: 0.9rem;">
                                    <i class="fas fa-envelope"></i> ${escapeHtml(client.email)}
                                </p>
                                <p style="margin: 5px 0; color: var(--text-gray); font-size: 0.9rem;">
                                    <i class="fas fa-bullseye"></i> –¶–µ–ª: ${escapeHtml(client.goal)}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <p style="margin: 0; color: var(--text-gray); font-size: 0.85rem;">
                                    <i class="fas fa-clock"></i> ${dateStr}
                                </p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn client-view-btn" style="flex: 1; min-width: 120px; background: var(--accent-blue);">
                                <i class="fas fa-eye"></i> –ü—Ä–µ–≥–ª–µ–¥
                            </button>
                            <button class="btn client-download-btn" style="flex: 1; min-width: 120px; background: #28a745;">
                                <i class="fas fa-download"></i> –ò–∑—Ç–µ–≥–ª–∏ JSON
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Add event listeners for buttons using event delegation
            container.querySelectorAll('.client-view-btn').forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.client-card');
                    const clientId = card.getAttribute('data-client-id');
                    viewClientDetails(clientId);
                });
            });
            
            container.querySelectorAll('.client-download-btn').forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.client-card');
                    const clientId = card.getAttribute('data-client-id');
                    const clientName = card.getAttribute('data-client-name');
                    downloadClientData(clientId, clientName);
                });
            });
        }
        
        function filterClients() {
            const searchTerm = document.getElementById('clientsSearchInput').value.toLowerCase();
            
            if (!allClientsData || allClientsData.length === 0) {
                return;
            }
            
            const filtered = allClientsData.filter(client => {
                const name = (client.name || '').toLowerCase();
                const email = (client.email || '').toLowerCase();
                const goal = (client.goal || '').toLowerCase();
                return name.includes(searchTerm) || email.includes(searchTerm) || goal.includes(searchTerm);
            });
            
            displayClients(filtered);
            document.getElementById('showingClients').textContent = filtered.length;
        }
        
        async function viewClientDetails(clientId) {
            try {
                const response = await fetch(`${WORKER_URL}/api/admin/get-client-data?clientId=${encodeURIComponent(clientId)}`);
                const result = await response.json();
                
                if (!result.success || !result.client) {
                    throw new Error('Failed to load client data');
                }
                
                const client = result.client;
                const submittedDate = new Date(client.submittedAt || client.timestamp);
                const dateStr = submittedDate.toLocaleString('bg-BG');
                
                // Create a modal to display client details
                let detailsHtml = `
                    <div class="client-modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;">
                        <div class="client-modal-content" style="background: var(--bg-color); padding: 30px; border-radius: 12px; max-width: 800px; max-height: 90vh; overflow-y: auto; width: 100%;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="margin: 0; color: var(--text-dark);">
                                    <i class="fas fa-user-circle"></i> ${escapeHtml(client.answers.name || 'N/A')}
                                </h2>
                                <button class="client-modal-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-gray);">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div style="background: var(--soft-red); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                <p style="margin: 5px 0; color: var(--text-dark);">
                                    <strong><i class="fas fa-clock"></i> –î–∞—Ç–∞ –Ω–∞ –ø–æ–¥–∞–≤–∞–Ω–µ:</strong> ${dateStr}
                                </p>
                                <p style="margin: 5px 0; color: var(--text-dark);">
                                    <strong><i class="fas fa-hashtag"></i> ID:</strong> ${escapeHtml(client.id)}
                                </p>
                                <p style="margin: 5px 0; color: var(--text-dark);">
                                    <strong><i class="fas fa-envelope"></i> Email:</strong> ${escapeHtml(client.answers.email || 'N/A')}
                                </p>
                            </div>
                            
                            <h3 style="color: var(--text-dark); margin-bottom: 15px;">–û—Ç–≥–æ–≤–æ—Ä–∏ –æ—Ç –≤—ä–ø—Ä–æ—Å–Ω–∏–∫–∞:</h3>
                            <div style="background: var(--card-bg); padding: 20px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
                `;
                
                // Display all answers
                for (const [key, value] of Object.entries(client.answers)) {
                    let displayValue = value;
                    if (Array.isArray(value)) {
                        displayValue = value.join(', ');
                    }
                    detailsHtml += `
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0;">
                            <strong style="color: var(--text-dark); display: block; margin-bottom: 5px;">${escapeHtml(key)}:</strong>
                            <span style="color: var(--text-gray);">${escapeHtml(String(displayValue))}</span>
                        </div>
                    `;
                }
                
                detailsHtml += `
                            </div>
                            
                            ${client.files && client.files.length > 0 ? `
                                <h3 style="color: var(--text-dark); margin: 20px 0 15px 0;">–ü—Ä–∏–∫–∞—á–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:</h3>
                                <div style="background: var(--card-bg); padding: 15px; border-radius: 8px;">
                                    ${client.files.map(file => `
                                        <div style="margin-bottom: 10px; color: var(--text-dark);">
                                            <i class="fas fa-file"></i> ${escapeHtml(file.name)} 
                                            <span style="color: var(--text-gray); font-size: 0.85rem;">(${(file.size / 1024).toFixed(2)} KB)</span>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                <button class="btn client-modal-download" data-client-id="${escapeHtml(client.id)}" data-client-name="${escapeHtml(client.answers.name || 'client')}" style="background: #28a745;">
                                    <i class="fas fa-download"></i> –ò–∑—Ç–µ–≥–ª–∏ JSON
                                </button>
                                <button class="btn client-modal-close-btn" style="background: var(--text-gray);">
                                    <i class="fas fa-times"></i> –ó–∞—Ç–≤–æ—Ä–∏
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', detailsHtml);
                
                // Add event listeners for modal buttons
                const modal = document.querySelector('.client-modal-overlay');
                const modalContent = modal.querySelector('.client-modal-content');
                
                // Close modal when clicking overlay (but not modal content)
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                // Close buttons
                modal.querySelectorAll('.client-modal-close, .client-modal-close-btn').forEach(btn => {
                    btn.addEventListener('click', () => modal.remove());
                });
                
                // Download button
                const downloadBtn = modal.querySelector('.client-modal-download');
                downloadBtn.addEventListener('click', function() {
                    const clientId = this.getAttribute('data-client-id');
                    const clientName = this.getAttribute('data-client-name');
                    downloadClientData(clientId, clientName);
                });
                
            } catch (error) {
                console.error('Error viewing client details:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏: ' + error.message);
            }
        }
        
        async function downloadClientData(clientId, clientName) {
            try {
                const response = await fetch(`${WORKER_URL}/api/admin/get-client-data?clientId=${encodeURIComponent(clientId)}`);
                const result = await response.json();
                
                if (!result.success || !result.client) {
                    throw new Error('Failed to load client data');
                }
                
                // Create a blob and download
                const blob = new Blob([JSON.stringify(result.client, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `client_${clientName.replace(/[^a-z0-9]/gi, '_')}_${clientId}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSuccess('–§–∞–π–ª—ä—Ç –±–µ—à–µ –∏–∑—Ç–µ–≥–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');
            } catch (error) {
                console.error('Error downloading client data:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—Ç–µ–≥–ª—è–Ω–µ: ' + error.message);
            }
        }

        // Load AI communication logs
        // =====================================================
        // AI Logging Toggle Functions
        // =====================================================
        
        /**
         * Load and display the current logging status
         */
        async function loadLoggingStatus() {
            try {
                const response = await fetch(`${WORKER_URL}/api/admin/get-logging-status`);
                const result = await response.json();
                
                if (result.success) {
                    const statusText = document.getElementById('loggingStatusText');
                    const enableBtn = document.getElementById('enableLoggingBtn');
                    const disableBtn = document.getElementById('disableLoggingBtn');
                    
                    if (result.enabled) {
                        statusText.textContent = '–í–∫–ª—é—á–µ–Ω–æ ‚úì';
                        statusText.style.color = '#28a745';
                        enableBtn.disabled = true;
                        enableBtn.style.opacity = '0.5';
                        disableBtn.disabled = false;
                        disableBtn.style.opacity = '1';
                    } else {
                        statusText.textContent = '–ò–∑–∫–ª—é—á–µ–Ω–æ ‚úó';
                        statusText.style.color = '#dc3545';
                        enableBtn.disabled = false;
                        enableBtn.style.opacity = '1';
                        disableBtn.disabled = true;
                        disableBtn.style.opacity = '0.5';
                    }
                } else {
                    console.error('Failed to load logging status:', result.error);
                }
            } catch (error) {
                console.error('Error loading logging status:', error);
                document.getElementById('loggingStatusText').textContent = '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ';
            }
        }
        
        /**
         * Toggle AI logging on/off
         */
        async function toggleLogging(enable) {
            try {
                const response = await fetch(`${WORKER_URL}/api/admin/set-logging-status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ enabled: enable })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess(result.message);
                    // Reload the status
                    await loadLoggingStatus();
                } else {
                    showError('–ì—Ä–µ—à–∫–∞: ' + result.error);
                }
            } catch (error) {
                console.error('Error toggling logging:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message);
            }
        }

        // =====================================================
        // AI Logs Functions
        // =====================================================
        
        async function loadAILogs() {
            const container = document.getElementById('aiLogsContainer');
            const statsDiv = document.getElementById('aiLogsStats');
            
            // Parse and validate limit and offset
            let limit = parseInt(document.getElementById('logsLimit').value);
            let offset = parseInt(document.getElementById('logsOffset').value);
            
            // Validate and sanitize inputs
            if (isNaN(limit) || limit <= 0) {
                limit = 50;
                document.getElementById('logsLimit').value = 50;
            }
            if (isNaN(offset) || offset < 0) {
                offset = 0;
                document.getElementById('logsOffset').value = 0;
            }
            
            // Cap maximum limit to prevent excessive load
            if (limit > 200) {
                limit = 200;
                document.getElementById('logsLimit').value = 200;
            }
            
            container.innerHTML = '<p style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>';
            statsDiv.style.display = 'none';
            
            try {
                // Load the logs (automatic cleanup removed per user request)
                const result = await cachedFetch(
                    `${WORKER_URL}/api/admin/get-ai-logs?limit=${limit}&offset=${offset}`,
                    `admin:aiLogs:${limit}:${offset}`,
                    CACHE_CONFIG.aiLogs
                );
                
                if (result.success && result.logs) {
                    if (result.logs.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">–ù—è–º–∞ –ª–æ–≥–æ–≤–µ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ.</p>';
                        return;
                    }
                    
                    // Calculate statistics - only count logs with responses for average duration
                    let totalInputTokens = 0;
                    let totalOutputTokens = 0;
                    let totalDuration = 0;
                    let logsWithResponses = 0;
                    let successCount = 0;
                    
                    result.logs.forEach(log => {
                        totalInputTokens += log.estimatedInputTokens || 0;
                        if (log.response) {
                            totalOutputTokens += log.response.estimatedOutputTokens || 0;
                            totalDuration += log.response.duration || 0;
                            logsWithResponses++;
                            if (log.response.success) successCount++;
                        }
                    });
                    
                    const avgDuration = logsWithResponses > 0 ? (totalDuration / logsWithResponses).toFixed(0) : 0;
                    
                    // Update statistics
                    document.getElementById('totalLogs').textContent = result.total;
                    document.getElementById('avgDuration').textContent = `${avgDuration} ms`;
                    document.getElementById('totalInputTokens').textContent = totalInputTokens.toLocaleString();
                    document.getElementById('totalOutputTokens').textContent = totalOutputTokens.toLocaleString();
                    statsDiv.style.display = 'block';
                    
                    // Display logs
                    let html = '';
                    result.logs.forEach(log => {
                        const requestDate = new Date(log.timestamp);
                        const requestDateStr = requestDate.toLocaleString('bg-BG');
                        
                        const hasResponse = log.response !== null && log.response !== undefined;
                        const statusColor = hasResponse && log.response.success ? '#27ae60' : '#e74c3c';
                        const statusIcon = hasResponse && log.response.success ? 'check-circle' : 'times-circle';
                        const statusText = hasResponse ? (log.response.success ? '–£—Å–ø–µ—à–µ–Ω' : '–ì—Ä–µ—à–∫–∞') : '–ë–µ–∑ –æ—Ç–≥–æ–≤–æ—Ä';
                        
                        const stepNameBg = {
                            'step1_analysis': '–°—Ç—ä–ø–∫–∞ 1: –ê–Ω–∞–ª–∏–∑',
                            'step2_strategy': '–°—Ç—ä–ø–∫–∞ 2: –°—Ç—Ä–∞—Ç–µ–≥–∏—è',
                            'step3_meal_plan_full': '–°—Ç—ä–ø–∫–∞ 3: –ü—ä–ª–µ–Ω –ü–ª–∞–Ω',
                            'step3_meal_plan_chunk_1': '–°—Ç—ä–ø–∫–∞ 3: –ë–ª–æ–∫ 1',
                            'step3_meal_plan_chunk_2': '–°—Ç—ä–ø–∫–∞ 3: –ë–ª–æ–∫ 2',
                            'step3_meal_plan_chunk_3': '–°—Ç—ä–ø–∫–∞ 3: –ë–ª–æ–∫ 3',
                            'step3_meal_plan_chunk_4': '–°—Ç—ä–ø–∫–∞ 3: –ë–ª–æ–∫ 4',
                            'step4_summary': '–°—Ç—ä–ø–∫–∞ 4: –û–±–æ–±—â–µ–Ω–∏–µ',
                            'chat_consultation': '–ß–∞—Ç: –ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏—è',
                            'plan_correction': '–ö–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ –ü–ª–∞–Ω',
                            'fallback_plan_generation': '–†–µ–∑–µ—Ä–≤–µ–Ω –ü–ª–∞–Ω'
                        }[log.stepName] || log.stepName;
                        
                        html += `
                            <div class="report-item" style="border-left: 4px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                    <div>
                                        <strong style="font-size: 1.1rem; color: var(--text-dark);">
                                            <i class="fas fa-${statusIcon}" style="color: ${statusColor};"></i>
                                            ${stepNameBg}
                                        </strong>
                                        <div style="margin-top: 5px; color: var(--text-gray); font-size: 0.85rem;">
                                            <i class="fas fa-clock"></i> ${requestDateStr}
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <span style="background: ${statusColor}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.85rem;">
                                            ${statusText}
                                        </span>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--text-gray);">
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray); margin-bottom: 3px;">–ü—Ä–æ–≤–∞–π–¥—ä—Ä / –ú–æ–¥–µ–ª</div>
                                        <div style="font-weight: 600;">${log.provider} / ${log.modelName}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray); margin-bottom: 3px;">–í—Ö–æ–¥–Ω–∏ –¢–æ–∫–µ–Ω–∏</div>
                                        <div style="font-weight: 600; color: #3498db;">${log.estimatedInputTokens?.toLocaleString() || 0}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray); margin-bottom: 3px;">–ò–∑—Ö–æ–¥–Ω–∏ –¢–æ–∫–µ–Ω–∏</div>
                                        <div style="font-weight: 600; color: #e67e22;">${hasResponse ? (log.response.estimatedOutputTokens?.toLocaleString() || 0) : '-'}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray); margin-bottom: 3px;">–í—Ä–µ–º–µ –∑–∞ –û—Ç–≥–æ–≤–æ—Ä</div>
                                        <div style="font-weight: 600; color: #9b59b6;">${hasResponse ? (log.response.duration + ' ms') : '-'}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray); margin-bottom: 3px;">–î—ä–ª–∂–∏–Ω–∞ –Ω–∞ –ü—Ä–æ–º–ø—Ç</div>
                                        <div style="font-weight: 600;">${log.promptLength?.toLocaleString() || 0} chars</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray); margin-bottom: 3px;">–î—ä–ª–∂–∏–Ω–∞ –Ω–∞ –û—Ç–≥–æ–≤–æ—Ä</div>
                                        <div style="font-weight: 600;">${hasResponse ? (log.response.responseLength?.toLocaleString() || 0) + ' chars' : '-'}</div>
                                    </div>
                                </div>
                                
                                ${hasResponse && log.response.error ? `
                                    <div style="margin-top: 15px; padding: 10px; background: #ffe6e6; border-radius: 8px; color: #e74c3c;">
                                        <strong><i class="fas fa-exclamation-triangle"></i> –ì—Ä–µ—à–∫–∞:</strong> ${escapeHtml(log.response.error)}
                                    </div>
                                ` : ''}
                                
                                <!-- Prompt Content Section -->
                                ${log.prompt ? `
                                    <details style="margin-top: 15px; padding: 10px; background: var(--bg-color); border-radius: 8px; border: 1px solid var(--text-gray);">
                                        <summary style="cursor: pointer; font-weight: 600; color: var(--text-dark); padding: 5px;">
                                            <i class="fas fa-paper-plane"></i> –ò–∑–ø—Ä–∞—Ç–µ–Ω –ü—Ä–æ–º–ø—Ç (${log.promptLength?.toLocaleString() || 0} chars)
                                        </summary>
                                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 10px;">
                                            <div style="display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.75rem;">
                                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #3498db; border-radius: 2px; margin-right: 5px;"></span><strong>–°–∏–Ω:</strong> –°–∏—Å—Ç–µ–º–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞</div>
                                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #27ae60; border-radius: 2px; margin-right: 5px;"></span><strong>–ó–µ–ª–µ–Ω:</strong> –ö–ª–∏–µ–Ω—Ç—Å–∫–∏ –¥–∞–Ω–Ω–∏</div>
                                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #e67e22; border-radius: 2px; margin-right: 5px;"></span><strong>–û—Ä–∞–Ω–∂–µ–≤:</strong> –ò–∑—á–∏—Å–ª–µ–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç –±–µ–∫–µ–Ω–¥</div>
                                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #e91e63; border-radius: 2px; margin-right: 5px;"></span><strong>–†–æ–∑–æ–≤:</strong> AI –∞–Ω–∞–ª–∏–∑ –æ—Ç –ø—Ä–µ–¥—Ö–æ–¥–µ–Ω –µ—Ç–∞–ø</div>
                                            </div>
                                        </div>
                                        <pre style="margin-top: 10px; padding: 10px; background: var(--white); border-radius: 4px; overflow-x: auto; max-height: 400px; font-size: 0.85rem; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word;">${colorCodePrompt(log.prompt)}</pre>
                                    </details>
                                ` : ''}
                                
                                <!-- Response Content Section -->
                                ${hasResponse && log.response.response ? `
                                    <details style="margin-top: 15px; padding: 10px; background: var(--bg-color); border-radius: 8px; border: 1px solid var(--text-gray);">
                                        <summary style="cursor: pointer; font-weight: 600; color: var(--text-dark); padding: 5px;">
                                            <i class="fas fa-reply"></i> –ü–æ–ª—É—á–µ–Ω –û—Ç–≥–æ–≤–æ—Ä (${log.response.responseLength?.toLocaleString() || 0} chars)
                                        </summary>
                                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 10px;">
                                            <div style="display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.75rem;">
                                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #9b59b6; border-radius: 2px; margin-right: 5px;"></span><strong>–õ–∏–ª–∞–≤:</strong> –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç AI</div>
                                            </div>
                                        </div>
                                        <pre style="margin-top: 10px; padding: 10px; background: var(--white); border-radius: 4px; overflow-x: auto; max-height: 400px; font-size: 0.85rem; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word;">${colorCodeResponse(log.response.response)}</pre>
                                    </details>
                                ` : ''}
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    
                    // Add pagination info
                    if (result.total > result.limit) {
                        const paginationInfo = document.createElement('div');
                        paginationInfo.style.textAlign = 'center';
                        paginationInfo.style.marginTop = '20px';
                        paginationInfo.style.color = 'var(--text-gray)';
                        const nextOffset = offset + limit;
                        const prevOffset = Math.max(0, offset - limit);
                        paginationInfo.innerHTML = `
                            <p>–ü–æ–∫–∞–∑–∞–Ω–∏ ${result.logs.length} –æ—Ç ${result.total} –ª–æ–≥–æ–≤–µ</p>
                            ${nextOffset < result.total ? `
                                <button class="btn" onclick="document.getElementById('logsOffset').value = ${nextOffset}; loadAILogs();" style="margin-top: 10px;">
                                    <i class="fas fa-arrow-right"></i> –ü–æ–∫–∞–∂–∏ –°–ª–µ–¥–≤–∞—â–∏
                                </button>
                            ` : ''}
                            ${offset > 0 ? `
                                <button class="btn" onclick="document.getElementById('logsOffset').value = ${prevOffset}; loadAILogs();" style="margin-top: 10px; margin-left: 10px;">
                                    <i class="fas fa-arrow-left"></i> –ü–æ–∫–∞–∂–∏ –ü—Ä–µ–¥–∏—à–Ω–∏
                                </button>
                            ` : ''}
                        `;
                        container.appendChild(paginationInfo);
                    }
                    
                    showSuccess(`–ó–∞—Ä–µ–¥–µ–Ω–∏ ${result.logs.length} –ª–æ–≥–æ–≤–µ`);
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('Error loading AI logs:', error);
                container.innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 20px;"><i class="fas fa-exclamation-circle"></i> –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ª–æ–≥–æ–≤–µ</p>';
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ª–æ–≥–æ–≤–µ: ' + error.message);
            }
        }

        /**
         * Export AI logs to a text file
         */
        async function exportAILogs() {
            try {
                // Show loading message
                showSuccess('–ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ª–æ–≥–æ–≤–µ...');
                
                // Fetch export from API
                const response = await fetch(`${WORKER_URL}/api/admin/export-ai-logs`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // Get the text content
                const blob = await response.blob();
                
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').replace('T', '_').substring(0, 19);
                a.download = `ai_communication_logs_${timestamp}.txt`;
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showSuccess('–õ–æ–≥–æ–≤–µ—Ç–µ —Å–∞ —É—Å–ø–µ—à–Ω–æ –µ–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–Ω–∏!');
            } catch (error) {
                console.error('Error exporting AI logs:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –µ–∫—Å–ø–æ—Ä—Ç –Ω–∞ –ª–æ–≥–æ–≤–µ: ' + error.message);
            }
        }

        /**
         * Color-code AI prompt to distinguish:
         * 1. System instructions and rules (blue)
         * 2. Client data from user input (green)
         * 3. Backend calculated values (orange)
         * 4. AI analysis from previous step (pink)
         */
        function colorCodePrompt(prompt) {
            if (!prompt) return '';
            
            let html = '';
            const lines = prompt.split('\n');
            let currentSection = 'instruction'; // instruction, client_data, backend_data, ai_previous
            
            // Section header keywords
            const sectionKeywords = {
                client_data: ['–ö–õ–ò–ï–ù–¢–°–ö–ò –ü–†–û–§–ò–õ', 'CLIENT PROFILE', '–ö–õ–ò–ï–ù–¢:'],
                backend_data: ['–ò–ó–ß–ò–°–õ–ï–ù–ò –°–¢–û–ô–ù–û–°–¢–ò', 'CALCULATED VALUES'],
                ai_previous: ['–ê–ù–ê–õ–ò–ó (–ö–û–ú–ü–ê–ö–¢–ï–ù)', '–ê–ù–ê–õ–ò–ó (', 'ANALYSIS (', '–ü–†–ï–î–ò–®–ï–ù –ê–ù–ê–õ–ò–ó'],
                instruction: ['–¢–í–û–Ø–¢–ê –ó–ê–î–ê–ß–ê', 'YOUR TASK', '–§–û–†–ú–ê–¢ –ù–ê –û–¢–ì–û–í–û–†', 'RESPONSE FORMAT', 
                             '–ü–†–ï–î–ü–û–ß–ò–¢–ê–ù–ò–Ø:', '–í–ê–ñ–ù–û:', '–ö–†–ò–¢–ò–ß–ù–û']
            };
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const escapedLine = escapeHtml(line);
                
                // Detect section boundaries - check if line starts with or contains section keywords
                let sectionChanged = false;
                
                // Check for client data section
                if (sectionKeywords.client_data.some(kw => line.includes(kw))) {
                    currentSection = 'client_data';
                    html += `<span style="color: #27ae60; font-weight: bold;">${escapedLine}</span>\n`;
                    sectionChanged = true;
                }
                // Check for backend data section (must have section marker ‚ïê‚ïê‚ïê or specific format)
                else if (sectionKeywords.backend_data.some(kw => line.includes(kw)) || 
                         (line.includes('Backend') && line.includes('‚ïê‚ïê‚ïê'))) {
                    currentSection = 'backend_data';
                    html += `<span style="color: #e67e22; font-weight: bold;">${escapedLine}</span>\n`;
                    sectionChanged = true;
                }
                // Check for AI previous analysis section (must have specific markers)
                else if (sectionKeywords.ai_previous.some(kw => line.includes(kw))) {
                    currentSection = 'ai_previous';
                    html += `<span style="color: #e91e63; font-weight: bold;">${escapedLine}</span>\n`;
                    sectionChanged = true;
                }
                // Check for instruction section (keywords with colon or at start)
                else if (sectionKeywords.instruction.some(kw => line.includes(kw))) {
                    currentSection = 'instruction';
                    html += `<span style="color: #3498db; font-weight: bold;">${escapedLine}</span>\n`;
                    sectionChanged = true;
                }
                
                // If section didn't change, apply color for current section
                if (!sectionChanged) {
                    if (currentSection === 'instruction') {
                        html += `<span style="color: #3498db;">${escapedLine}</span>\n`;
                    } else if (currentSection === 'client_data') {
                        html += `<span style="color: #27ae60;">${escapedLine}</span>\n`;
                    } else if (currentSection === 'backend_data') {
                        html += `<span style="color: #e67e22;">${escapedLine}</span>\n`;
                    } else if (currentSection === 'ai_previous') {
                        html += `<span style="color: #e91e63;">${escapedLine}</span>\n`;
                    }
                }
            }
            
            return html;
        }
        
        /**
         * Color-code AI response (analyzed data from AI)
         * AI-generated content is shown in purple/magenta
         */
        function colorCodeResponse(response) {
            if (!response) return '';
            
            // AI response is all analyzed data, show in purple
            const escapedResponse = escapeHtml(response);
            return `<span style="color: #9b59b6;">${escapedResponse}</span>`;
        }
        
        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Helper Functions
        function showSuccess(message) {
            const div = document.getElementById('successMessage');
            div.textContent = message;
            div.style.display = 'block';
            setTimeout(() => div.style.display = 'none', 5000);
        }

        function showError(message) {
            const div = document.getElementById('errorMessage');
            div.textContent = message;
            div.style.display = 'block';
            setTimeout(() => div.style.display = 'none', 5000);
        }

        // Initialize
        checkAuth();
        loadColorScheme();
        
        // Load notification settings and check VAPID key status on page load
        loadNotificationSettings();
        loadNotificationTemplates();
        checkVapidKeyStatus();

        // --- PWA Install Banner Functionality ---
        let deferredPrompt;
        
        // Constants
        const INSTALL_BANNER_DISMISS_DAYS = 7; // Number of days before showing banner again
        const MILLISECONDS_PER_DAY = 1000 * 60 * 60 * 24;
        const PWA_DEBUG = true; // Set to true for debugging PWA installation issues
        
        // Helper function to check if banner was recently dismissed
        function wasBannerRecentlyDismissed() {
            const dismissedTime = localStorage.getItem('installBannerDismissed');
            if (dismissedTime) {
                const daysSinceDismissed = (Date.now() - parseInt(dismissedTime)) / MILLISECONDS_PER_DAY;
                // Show again after configured number of days
                if (daysSinceDismissed < INSTALL_BANNER_DISMISS_DAYS) {
                    if (PWA_DEBUG) console.log('Install banner was recently dismissed');
                    return true;
                }
            }
            return false;
        }
        
        // Detect device type
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isChrome = /Chrome/i.test(navigator.userAgent) && !/Edg/i.test(navigator.userAgent);
        const isEdge = /Edg/i.test(navigator.userAgent);
        const isSafari = /Safari/i.test(navigator.userAgent) && !/Chrome/i.test(navigator.userAgent);
        const isFirefox = /Firefox/i.test(navigator.userAgent);
        const isOpera = /OPR|Opera/i.test(navigator.userAgent);
        const isSamsung = /SamsungBrowser/i.test(navigator.userAgent);
        
        // Get browser name and icon for display
        function getBrowserInfo() {
            if (isChrome && isAndroid) return { name: 'Chrome', icon: 'fab fa-chrome' };
            if (isChrome && !isAndroid) return { name: 'Chrome', icon: 'fab fa-chrome' };
            if (isEdge) return { name: 'Edge', icon: 'fab fa-edge' };
            if (isSafari && isIOS) return { name: 'Safari', icon: 'fab fa-safari' };
            if (isSafari) return { name: 'Safari', icon: 'fab fa-safari' };
            if (isFirefox) return { name: 'Firefox', icon: 'fab fa-firefox' };
            if (isOpera) return { name: 'Opera', icon: 'fab fa-opera' };
            if (isSamsung) return { name: 'Samsung Internet', icon: 'fas fa-mobile-alt' };
            return { name: 'Browser', icon: 'fas fa-globe' };
        }
        
        // Update banner icon based on platform
        function updateBannerIcon() {
            const iconEl = document.getElementById('installBannerIcon');
            if (!iconEl) return;
            
            let iconClass = 'fas fa-mobile-alt';
            
            if (isAndroid) {
                iconClass = 'fab fa-android';
            } else if (isIOS) {
                iconClass = 'fab fa-apple';
            } else if (!isMobile) {
                iconClass = 'fas fa-desktop';
            }
            
            iconEl.innerHTML = `<i class="${iconClass}"></i>`;
        }
        
        // Update browser badge
        function updateBrowserBadge(showBrowser = true) {
            const browserBadge = document.getElementById('installBannerBrowser');
            const browserText = document.getElementById('installBannerBrowserText');
            
            if (browserBadge && browserText && showBrowser) {
                const browserInfo = getBrowserInfo();
                browserText.textContent = browserInfo.name;
                const iconEl = browserBadge.querySelector('i');
                if (iconEl) {
                    iconEl.className = browserInfo.icon;
                }
                browserBadge.style.display = 'inline-flex';
            } else if (browserBadge) {
                browserBadge.style.display = 'none';
            }
        }
        
        // Capture the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            if (PWA_DEBUG) console.log('beforeinstallprompt fired');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show the install banner only if not recently dismissed
            if (!wasBannerRecentlyDismissed()) {
                showInstallBanner();
                
                // Auto-trigger installation prompt after 3 seconds for better automatic experience
                // This ensures users don't miss the installation opportunity
                setTimeout(() => {
                    if (deferredPrompt && !isInStandaloneMode()) {
                        if (PWA_DEBUG) console.log('Auto-triggering install prompt after 3 seconds');
                        triggerInstallPrompt();
                    }
                }, 3000);
            }
        });

        // Show install banner
        function showInstallBanner() {
            if (PWA_DEBUG) console.log('Showing install banner');
            const installBanner = document.getElementById('installBanner');
            if (installBanner) {
                // Update banner text for automatic installation
                const titleEl = installBanner.querySelector('.install-banner-title');
                const textEl = installBanner.querySelector('.install-banner-text');
                
                if (titleEl) titleEl.textContent = 'üéâ –ì–æ—Ç–æ–≤–æ –∑–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è!';
                if (textEl) textEl.textContent = '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —â–µ —Å–µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–ª–µ–¥ 3 —Å–µ–∫—É–Ω–¥–∏';
                
                installBanner.classList.add('show');
                if (PWA_DEBUG) console.log('Install banner displayed successfully');
            } else {
                if (PWA_DEBUG) console.error('Install banner element not found');
            }
        }
        
        // Show platform-specific install guidance if beforeinstallprompt doesn't fire
        function showPlatformInstallGuidance() {
            // Don't show if already dismissed recently
            if (wasBannerRecentlyDismissed()) return;
            
            // Don't show if already installed
            if (isInStandaloneMode()) return;
            
            const installBanner = document.getElementById('installBanner');
            if (!installBanner) return;
            
            // Update banner content based on platform
            const titleEl = document.getElementById('installBannerTitle');
            const textEl = document.getElementById('installBannerText');
            const installBtn = document.getElementById('installBtn');
            
            // Update icon and browser badge
            updateBannerIcon();
            updateBrowserBadge(true);
            
            if (!isMobile && (isChrome || isEdge)) {
                // Desktop Chrome/Edge - guide to address bar
                const browserName = isChrome ? 'Chrome' : 'Edge';
                if (titleEl) titleEl.textContent = `üíª –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –≤ ${browserName}`;
                if (textEl) textEl.textContent = '–ü–æ—Ç—ä—Ä—Å–∏ –∏–∫–æ–Ω–∞—Ç–∞ –∑–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è (‚äï) –≤ –∞–¥—Ä–µ—Å–Ω–∞—Ç–∞ –ª–µ–Ω—Ç–∞';
                if (installBtn) {
                    installBtn.innerHTML = '<i class="fas fa-info-circle"></i><span>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</span>';
                    installBtn.onclick = () => {
                        alert('–ó–∞ –¥–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:\n\n1. –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ –∏–∫–æ–Ω–∞—Ç–∞ –∑–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è (‚äï –∏–ª–∏ ‚¨á) –≤ –∞–¥—Ä–µ—Å–Ω–∞—Ç–∞ –ª–µ–Ω—Ç–∞ –≤ –≥–æ—Ä–Ω–∏—è –¥–µ—Å–µ–Ω —ä–≥—ä–ª\n2. –ö–ª–∏–∫–Ω–µ—Ç–µ –≤—ä—Ä—Ö—É –Ω–µ—è –∏ –∏–∑–±–µ—Ä–µ—Ç–µ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π"\n3. –ò–ª–∏ –æ—Ç–≤–æ—Ä–µ—Ç–µ –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (‚ãÆ) –∏ –∏–∑–±–µ—Ä–µ—Ç–µ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π NutriPlan..."');
                    };
                }
                installBanner.classList.add('show');
            } else if (isIOS && isSafari) {
                // iOS Safari - guide to Share button
                if (titleEl) titleEl.textContent = 'üì± –î–æ–±–∞–≤–∏ –∫—ä–º iPhone/iPad';
                if (textEl) textEl.textContent = '–ù–∞—Ç–∏—Å–Ω–∏ –±—É—Ç–æ–Ω–∞ Share (‚¨ÜÔ∏è) –∏ –∏–∑–±–µ—Ä–∏ "Add to Home Screen" (–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω)';
                if (installBtn) {
                    installBtn.innerHTML = '<i class="fas fa-share"></i><span>–í–∏–∂ –∫–∞–∫</span>';
                    installBtn.onclick = () => {
                        alert('–ó–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∫—ä–º –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω:\n\n1. –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –±—É—Ç–æ–Ω–∞ Share/–°–ø–æ–¥–µ–ª—è–Ω–µ (‚¨ÜÔ∏è) –≤ –¥–æ–ª–Ω–∞—Ç–∞ —á–∞—Å—Ç –Ω–∞ –µ–∫—Ä–∞–Ω–∞\n2. –ü—Ä–µ–≤—ä—Ä—Ç–µ—Ç–µ –Ω–∞–¥–æ–ª—É –∏ –∏–∑–±–µ—Ä–µ—Ç–µ "Add to Home Screen" (–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω) (–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω)\n3. –ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ, –∫–∞—Ç–æ –Ω–∞—Ç–∏—Å–Ω–µ—Ç–µ "Add" (–î–æ–±–∞–≤–∏)');
                    };
                }
                installBanner.classList.add('show');
            } else if (isAndroid && (isChrome || isEdge)) {
                // Android Chrome/Edge - fallback when beforeinstallprompt doesn't fire
                const browserName = isChrome ? 'Chrome' : 'Edge';
                if (titleEl) titleEl.textContent = `üì± –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –≤ ${browserName}`;
                if (textEl) textEl.textContent = '–ù–∞—Ç–∏—Å–Ω–∏ –º–µ–Ω—é—Ç–æ (‚ãÆ) –∏ –∏–∑–±–µ—Ä–∏ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"';
                if (installBtn) {
                    installBtn.innerHTML = '<i class="fas fa-info-circle"></i><span>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</span>';
                    installBtn.onclick = () => {
                        alert('üì± –ö–∞–∫ –¥–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–º –Ω–∞ Android?\n\n‚úÖ –ë–™–†–ó –ù–ê–ß–ò–ù:\n1. –û—Ç–≤–æ—Ä–µ—Ç–µ –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (‚ãÆ) –≤ –≥–æ—Ä–Ω–∏—è –¥–µ—Å–µ–Ω —ä–≥—ä–ª\n2. –ò–∑–±–µ—Ä–µ—Ç–µ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –∏–ª–∏ "–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω"\n3. –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π" –≤ –¥–∏–∞–ª–æ–≥–∞\n\n‚úÖ –ê–õ–¢–ï–†–ù–ê–¢–ò–í–ê:\n‚Ä¢ –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ –∏–∫–æ–Ω–∞—Ç–∞ (‚äï) –≤ –∞–¥—Ä–µ—Å–Ω–∞—Ç–∞ –ª–µ–Ω—Ç–∞\n‚Ä¢ –ö–ª–∏–∫–Ω–µ—Ç–µ –∏ –∏–∑–±–µ—Ä–µ—Ç–µ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π"\n\nüí° –í–ê–ñ–ù–û: –ê–∫–æ –Ω–µ –≤–∏–∂–¥–∞—Ç–µ –æ–ø—Ü–∏—è—Ç–∞ –≤–µ–¥–Ω–∞–≥–∞:\n‚Ä¢ –ü—Ä–µ–∑–∞—Ä–µ–¥–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ (F5)\n‚Ä¢ –ò–∑—á–∞–∫–∞–π—Ç–µ 2-3 —Å–µ–∫—É–Ω–¥–∏\n‚Ä¢ –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –Ω—è–∫–æ–π –±—É—Ç–æ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞');
                    };
                }
                installBanner.classList.add('show');
            } else if (isSamsung && isAndroid) {
                // Samsung Internet on Android
                if (titleEl) titleEl.textContent = 'üì± –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –≤ Samsung Internet';
                if (textEl) textEl.textContent = '–ù–∞—Ç–∏—Å–Ω–∏ –º–µ–Ω—é—Ç–æ –∏ –∏–∑–±–µ—Ä–∏ "–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω"';
                if (installBtn) {
                    installBtn.innerHTML = '<i class="fas fa-info-circle"></i><span>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</span>';
                    installBtn.onclick = () => {
                        alert('–ó–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∫—ä–º –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω:\n\n1. –û—Ç–≤–æ—Ä–µ—Ç–µ –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (–æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –≤ –≥–æ—Ä–Ω–∞—Ç–∞ —á–∞—Å—Ç)\n2. –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ –æ–ø—Ü–∏—è—Ç–∞ "–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω" –∏–ª–∏ –ø–æ–¥–æ–±–Ω–∞\n3. –ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ—Ç–æ');
                    };
                }
                installBanner.classList.add('show');
            } else if (isFirefox && isAndroid) {
                // Firefox on Android
                if (titleEl) titleEl.textContent = 'üì± –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –≤ Firefox';
                if (textEl) textEl.textContent = '–ù–∞—Ç–∏—Å–Ω–∏ –º–µ–Ω—é—Ç–æ (‚ãÆ) –∏ –∏–∑–±–µ—Ä–∏ "–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π"';
                if (installBtn) {
                    installBtn.innerHTML = '<i class="fas fa-info-circle"></i><span>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</span>';
                    installBtn.onclick = () => {
                        alert('–ó–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∫—ä–º –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω:\n\n1. –û—Ç–≤–æ—Ä–µ—Ç–µ –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (–æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –≤ –≥–æ—Ä–Ω–∞—Ç–∞ —á–∞—Å—Ç)\n2. –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ –æ–ø—Ü–∏—è—Ç–∞ "–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω" –∏–ª–∏ –ø–æ–¥–æ–±–Ω–∞\n3. –ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ—Ç–æ');
                    };
                }
                installBanner.classList.add('show');
            } else if (isMobile) {
                // Other mobile browsers - generic guidance
                if (titleEl) titleEl.textContent = 'üì± –î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω';
                if (textEl) textEl.textContent = '–û—Ç–≤–æ—Ä–∏ –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ –∏ –∏–∑–±–µ—Ä–∏ "–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω"';
                if (installBtn) {
                    installBtn.innerHTML = '<i class="fas fa-info-circle"></i><span>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</span>';
                    installBtn.onclick = () => {
                        alert('–ó–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∫—ä–º –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω:\n\n1. –û—Ç–≤–æ—Ä–µ—Ç–µ –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (–æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –≤ –≥–æ—Ä–Ω–∞—Ç–∞ —á–∞—Å—Ç)\n2. –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ –æ–ø—Ü–∏—è—Ç–∞ "–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω" –∏–ª–∏ –ø–æ–¥–æ–±–Ω–∞\n3. –ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ—Ç–æ');
                    };
                }
                installBanner.classList.add('show');
            }
        }

        // Hide install banner
        function hideInstallBanner() {
            const installBanner = document.getElementById('installBanner');
            if (installBanner) {
                installBanner.classList.remove('show');
            }
        }
        
        // Trigger install prompt (reusable function)
        async function triggerInstallPrompt() {
            if (!deferredPrompt) {
                if (PWA_DEBUG) console.log('No deferred prompt available');
                return false;
            }
            
            try {
                // Show the install prompt
                if (PWA_DEBUG) console.log('Triggering install prompt');
                deferredPrompt.prompt();
                
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                if (PWA_DEBUG) console.log(`User response to the install prompt: ${outcome}`);
                
                // Hide the banner
                hideInstallBanner();
                
                // Clear the deferred prompt
                deferredPrompt = null;
                
                return outcome === 'accepted';
            } catch (error) {
                if (PWA_DEBUG) console.error('Error triggering install prompt:', error);
                return false;
            }
        }

        // iOS Install Banner Functions
        function showIosInstallBanner() {
            const hasDismissed = localStorage.getItem('ios_install_dismissed');

            if (isIOS && !isInStandaloneMode() && !hasDismissed) {
                const iosBanner = document.getElementById('ios-banner');
                const shareIconImg = document.getElementById('ios-share-icon-img');
                
                if (iosBanner) {
                    // Set the share icon SVG
                    if (shareIconImg) {
                        shareIconImg.src = getShareIconSvg();
                    }
                    iosBanner.style.display = 'block';
                    if (PWA_DEBUG) console.log('iOS install banner shown');
                }
            }
        }

        // Function to dismiss iOS banner
        function dismissIosBanner() {
            localStorage.setItem('ios_install_dismissed', 'true');
            const iosBanner = document.getElementById('ios-banner');
            if (iosBanner) {
                iosBanner.style.display = 'none';
            }
            if (PWA_DEBUG) console.log('iOS install banner dismissed');
        }

        // Initialize iOS banner after a delay
        if (isIOS && isSafari) {
            setTimeout(() => {
                showIosInstallBanner();
            }, 3000); // Show after 3 seconds on iOS
        }

        // Handle install button click
        const installBtn = document.getElementById('installBtn');
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                await triggerInstallPrompt();
            });
        }

        // Handle dismiss button click
        const dismissInstallBtn = document.getElementById('dismissInstallBtn');
        if (dismissInstallBtn) {
            dismissInstallBtn.addEventListener('click', () => {
                hideInstallBanner();
                
                // Store dismissal in localStorage (to not show again for 7 days)
                localStorage.setItem('installBannerDismissed', Date.now().toString());
            });
        }

        // Listen for app installed event
        window.addEventListener('appinstalled', () => {
            if (PWA_DEBUG) console.log('PWA was installed');
            hideInstallBanner();
            deferredPrompt = null;
        });
        
        // Don't show fallback guidance - only show banner when beforeinstallprompt fires
        // This ensures automatic installation prompt instead of manual instructions
        window.addEventListener('load', () => {
            setTimeout(() => {
                // Only log for debugging - don't show manual instructions
                if (!deferredPrompt && !isInStandaloneMode()) {
                    if (PWA_DEBUG) {
                        console.log('beforeinstallprompt has not fired after 2 seconds');
                        console.log('Waiting for automatic prompt - no manual instructions shown');
                    }
                }
            }, 2000);
            
            // For Android Chrome/Edge: Re-check after user engagement
            if (isAndroid && (isChrome || isEdge)) {
                let engagementStartTime = Date.now();
                let hasInteracted = false;
                
                // Track user interaction
                const interactionEvents = ['click', 'touchstart', 'scroll', 'keydown'];
                const markInteraction = () => {
                    if (!hasInteracted) {
                        hasInteracted = true;
                        if (PWA_DEBUG) console.log('User interaction detected, starting engagement timer');
                    }
                };
                
                interactionEvents.forEach(event => {
                    document.addEventListener(event, markInteraction, { once: true, passive: true });
                });
                
                // Check again after 32 seconds if user has interacted
                setTimeout(() => {
                    if (hasInteracted && !deferredPrompt && !isInStandaloneMode()) {
                        const elapsedTime = Math.floor((Date.now() - engagementStartTime) / 1000);
                        if (PWA_DEBUG) {
                            console.log(`%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'color: #3b82f6');
                            console.log('%cüîÑ Re-checking PWA Installability', 'color: #3b82f6; font-weight: bold');
                            console.log(`%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'color: #3b82f6');
                            console.log(`User has been engaged for ${elapsedTime} seconds`);
                            console.log(`beforeinstallprompt still has not fired`);
                            console.log('Waiting for automatic prompt - app may already be installed or PWA criteria not met');
                            console.log(`%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'color: #3b82f6');
                        }
                        // Don't show manual instructions - wait for automatic prompt only
                    }
                }, 32000); // Check after 32 seconds (30s requirement + 2s buffer)
            }
        });

        // Debug: Check PWA installability after page load
        if (PWA_DEBUG) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    // Detect device type
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    const isAndroid = /Android/i.test(navigator.userAgent);
                    const isChrome = /Chrome/i.test(navigator.userAgent) && !/Edg/i.test(navigator.userAgent);
                    const isEdge = /Edg/i.test(navigator.userAgent);
                    
                    if (!deferredPrompt) {
                        console.log('PWA Debug: beforeinstallprompt has not fired yet');
                        console.log('PWA Debug: Checking installability criteria:');
                        console.log('- Service Worker:', 'serviceWorker' in navigator ? 'Supported' : 'Not supported');
                        console.log('- HTTPS:', location.protocol === 'https:' ? 'Yes' : 'No');
                        console.log('- Manifest link:', document.querySelector('link[rel="manifest"]') ? 'Found' : 'Missing');
                        console.log('- Platform:', isMobile ? 'Mobile' : 'Desktop');
                        console.log('- Browser:', isChrome ? 'Chrome' : (isEdge ? 'Edge' : 'Other'));
                        
                        // Check if already installed
                        if (isInStandaloneMode()) {
                            console.log('- Already installed: Yes (running as standalone app)');
                        } else {
                            console.log('- Already installed: No');
                            
                            // Different explanations for desktop vs mobile
                            if (!isMobile && (isChrome || isEdge)) {
                                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #10b981');
                                console.log('%c‚úì PWA IS INSTALLABLE!', 'color: #10b981; font-weight: bold; font-size: 14px');
                                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #10b981');
                                console.log('%cINFO: On Desktop Chrome/Edge, the beforeinstallprompt event often does NOT fire.', 'color: #3b82f6; font-weight: bold');
                                console.log('%cInstead, Chrome shows an INSTALL ICON in the address bar (omnibox).', 'color: #3b82f6; font-weight: bold');
                                console.log('');
                                console.log('%cTo install this app:', 'font-weight: bold');
                                console.log('  1. Look for the install icon (‚äï or ‚¨á) in the address bar on the right side');
                                console.log('  2. Click the icon to install the app');
                                console.log('  3. Or open Chrome menu (‚ãÆ) ‚Üí "Install NutriPlan..."');
                                console.log('');
                                console.log('%cFor automatic install prompts, test on Android Chrome/Edge.', 'color: #f59e0b');
                                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #10b981');
                            } else if (isAndroid && (isChrome || isEdge)) {
                                console.log('- Possible reasons why event has not fired:');
                                console.log('  1. User engagement criteria not met (needs 30+ seconds + interaction)');
                                console.log('  2. Manifest.json not valid or not accessible');
                                console.log('  3. Icons not loading properly');
                                console.log('  4. Service worker not registered successfully');
                                console.log('  5. PWA criteria not fully met');
                            } else {
                                console.log('- Note: beforeinstallprompt is only supported on Chrome/Edge (mainly Android)');
                                console.log('- For other browsers, users can install manually via browser menu');
                            }
                        }
                    } else {
                        console.log('%c‚úÖ PWA Debug: beforeinstallprompt fired successfully!', 'color: #10b981; font-weight: bold');
                        console.log('PWA is ready for installation with custom install prompt.');
                    }
                }, 3000);
            });
        }

        // --- PWA Service Worker Registration ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // --- PWA Helper Functions ---
        // Check if app is running in standalone mode
        function isInStandaloneMode() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   (('standalone' in window.navigator) && (window.navigator.standalone));
        }

        // Get SVG data URL for iOS share icon
        function getShareIconSvg() {
            return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M18 16v2H6v-2H4v4h16v-4zM12 4l-5 5h3v6h4v-6h3z'/%3E%3C/svg%3E";
        }
    </script>
</body>
</html>

# –ü—Ä–æ–≤–µ—Ä–∫–∞: –†–∞–±–æ—Ç–∏ –ª–∏ whitelist enforcement —Ä–µ–∞–ª–Ω–æ? (Validation Report)

## –î–∞—Ç–∞: 2026-02-03

## –í—ä–ø—Ä–æ—Å –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
> "–¥–æ–±—Ä–µ, –Ω–∞–ª–∏ –ø—Ä–µ–¥–∏ —Ç–æ–≤–∞ –≤—ä–≤–µ–¥–æ—Ö–º–µ –≤—ä–∑–º–æ–∂–Ω–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –¥–æ–ø—É—Å—Ç–∏–º–∏ —Ö—Ä–∞–Ω–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ—Ç –µ–∫–∑–æ—Ç–∏—á–Ω–∏ —Ö—Ä–∞–Ω–∏ –∏–ª–∏ —Å—Ç—Ä–∞–Ω–Ω–∏, —Ç–æ–≤–∞ —Ä–∞–±–æ—Ç–∏ –ª–∏ —Ä–µ–∞–ª–Ω–æ? –≤–∫–∞—Ä–∞–Ω–æ –ª–∏ –µ? –∫–∞–∫ —Å –º–∏–Ω–∏–º—É–º –Ω–∞–º–µ—Å–∞ –∏ —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è –º–æ–∂–µ–º –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ–º –º–∞–∫—Å–∏–º–∞–ª–µ–Ω –µ—Ñ–µ–∫—Ç"

## –ö—Ä–∞—Ç—ä–∫ –æ—Ç–≥–æ–≤–æ—Ä
‚úÖ **–î–ê, whitelist enforcement –†–ê–ë–û–¢–ò –∏ –µ –ê–ö–¢–ò–í–ï–ù –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞!**

## –ü–æ–¥—Ä–æ–±–µ–Ω –∞–Ω–∞–ª–∏–∑

### 1. –ö—ä–¥–µ –µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–æ? ‚úÖ

#### A) –í AI –ø—Ä–æ–º–ø—Ç–∏—Ç–µ (2 –º–µ—Å—Ç–∞)
```javascript
// –§–∞–π–ª: worker.js

// 1. –ó–∞ –ø—Ä–æ–≥—Ä–µ—Å–∏–≤–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ (line ~2368)
function generateMealPlanChunkPrompt() {
  // ...
  // === WHITELISTS (–†–ê–ó–†–ï–®–ï–ù–ò –•–†–ê–ù–ò) - –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –°–ü–ê–ó–í–ê–ù–ï ===
  // WHITELIST PROTEIN (–∏–∑–±–µ—Ä–∏ —Ç–æ—á–Ω–æ 1 –≥–ª–∞–≤–µ–Ω –±–µ–ª—Ç—ä–∫):
  // - —è–π—Ü–∞, –ø–∏–ª–µ—à–∫–æ, –≥–æ–≤–µ–∂–¥–æ, –ø–æ—Å—Ç–Ω–∞ —Å–≤–∏–Ω—Å–∫–∞, —Ä–∏–±–∞...
  // –ó–ê–ë–†–ê–ù–ï–ù–ò –ë–ï–õ–¢–™–¶–ò (–ù–ï –∏–∑–ø–æ–ª–∑–≤–∞–π –±–µ–∑ Reason):
  // - –∑–∞–µ—à–∫–æ (rabbit), –ø–∞—Ç–∏—Ü–∞ (duck), –≥—ä—Å–∫–∞ (goose)...
}

// 2. –ó–∞ –µ–¥–Ω–æ—Å—Ç—ä–ø–∫–æ–≤–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ (line ~2715)
function generateMealPlanPrompt() {
  // –°—ä—â–∏—Ç–µ WHITELIST —Å–µ–∫—Ü–∏–∏
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ  
**–†–∞–∑–º–µ—Ä**: ~414 —Ç–æ–∫–µ–Ω–∞ (—Ä–∞–∑—É–º–µ–Ω —Ä–∞–∑–º–µ—Ä)  
**–ï—Ñ–µ–∫—Ç**: AI –≤–∏–∂–¥–∞ –¢–û–ß–ù–û –∫–æ–∏ —Ö—Ä–∞–Ω–∏ —Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏

#### B) –í backend –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞ (line ~1050)
```javascript
// –§–∞–π–ª: worker.js

function validatePlan(plan, userData) {
  // ...
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ non-whitelist –±–µ–ª—Ç—ä—Ü–∏ (line ~1401-1418)
  for (const protein of ADLE_V8_NON_WHITELIST_PROTEINS) {
    const regex = new RegExp(`(^|[^–∞-—èa-z])${escapedProtein}`, 'i');
    if (regex.test(mealText)) {
      if (!hasReasonJustification(meal)) {
        // –ì–†–ï–®–ö–ê: –ù–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–∞ —Ö—Ä–∞–Ω–∞ –±–µ–∑ –æ–±–æ—Å–Ω–æ–≤–∫–∞
        errors.push(...);
      }
    }
  }
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ  
**–ü—Ä–æ–≤–µ—Ä—è–≤–∞**: –∑–∞–µ—à–∫–æ, –ø–∞—Ç–∏—Ü–∞, –≥—ä—Å–∫–∞, –∞–≥–Ω–µ, –¥–∏–≤–µ—á  
**–ï—Ñ–µ–∫—Ç**: –£–ª–∞–≤—è –Ω–∞—Ä—É—à–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

### 2. –ò–∑–ø–æ–ª–∑–≤–∞ –ª–∏ —Å–µ —Ä–µ–∞–ª–Ω–æ? ‚úÖ

#### –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç–æ–∫–∞:

```
1. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –≥–µ–Ω–µ—Ä–∏—Ä–∞ –ø–ª–∞–Ω
   ‚Üì
2. handleGeneratePlan() (line ~487)
   ‚Üì
3. generatePlanMultiStep() (line ~1557)
   ‚Üì
4. ENABLE_PROGRESSIVE_GENERATION = true (line ~1042)
   ‚Üì
5. generateMealPlanProgressive() (line ~2119)
   ‚Üì
6. generateMealPlanChunkPrompt() ‚Üê –ò–ó–ü–û–õ–ó–í–ê WHITELIST! (line ~2284)
   ‚Üì
7. AI –≥–µ–Ω–µ—Ä–∏—Ä–∞ –ø–ª–∞–Ω —Å–ø–æ—Ä–µ–¥ whitelist
   ‚Üì
8. validatePlan() ‚Üê –ü–†–û–í–ï–†–Ø–í–ê WHITELIST! (line ~498)
   ‚Üì
9. –ê–∫–æ –∏–º–∞ –≥—Ä–µ—à–∫–∞ ‚Üí correction loop (line ~504-535)
   ‚Üì
10. –í–∞–ª–∏–¥–µ–Ω –ø–ª–∞–Ω ‚Üí –≤—Ä—ä—â–∞ —Å–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—ä–ª–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è  
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ –∫–æ—Ä–µ–∫—Ü–∏–∏**: –î–æ MAX_CORRECTION_ATTEMPTS  
**–ï—Ñ–µ–∫—Ç**: –°–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ —Å–∞–º–æ–∫–æ—Ä–∏–≥–∏—Ä–∞

### 3. –ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ª–∏ –µ? ‚úÖ

#### –ö–∞–∫–≤–æ –ø–æ—Å—Ç–∏–≥–∞–º–µ:

| –ê—Å–ø–µ–∫—Ç | –ü—Ä–µ–¥–∏ | –°–µ–≥–∞ | –ü–æ–¥–æ–±—Ä–µ–Ω–∏–µ |
|--------|-------|------|------------|
| AI —Ä–∞–∑–±–∏—Ä–∞ whitelist | ‚ùå –ù–µ—è—Å–Ω–æ | ‚úÖ –ï–∫—Å–ø–ª–∏—Ü–∏—Ç–Ω–æ | +100% |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | ‚ùå –ù—è–º–∞ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ | +100% |
| –£–ª–∞–≤—è–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∏ | ‚ùå –ù–µ | ‚úÖ –° –∫–æ—Ä–µ–∫—Ü–∏—è | +100% |
| –¢–æ–∫–µ–Ω overhead | - | ~414 —Ç–æ–∫–µ–Ω–∞ | –ü—Ä–∏–µ–º–ª–∏–≤–æ |
| –°—ä–æ–±—â–µ–Ω–∏—è –∑–∞ –≥—Ä–µ—à–∫–∏ | ‚ùå –ù—è–º–∞ | ‚úÖ –¢–æ—á–Ω–∏ | +100% |

**–û–±—â–æ –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ**: üöÄ **–î—Ä–∞–º–∞—Ç–∏—á–Ω–æ**

### 4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∏ —Å –º–∏–Ω–∏–º—É–º –Ω–∞–º–µ—Å–∞? ‚úÖ

#### –ó–∞—â–æ –µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å –º–∏–Ω–∏–º–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏:

1. **–î–≤–æ–π–Ω–∞ –∑–∞—â–∏—Ç–∞** (AI + Backend):
   - AI –ø—Ä–æ–º–ø—Ç—ä—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –≥—Ä–µ—à–∫–∏
   - Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞ —É–ª–∞–≤—è –ø—Ä–æ–ø—É—Å–∫–∏—Ç–µ
   - –ö–æ—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∏—è—Ç loop –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ø—Ä–∞–≤—è

2. **–ù—É–ª–µ–≤–∞ –Ω–∞–º–µ—Å–∞ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è**:
   - –í—Å–∏—á–∫–æ –µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
   - –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –Ω–µ –≤–∏–∂–¥–∞ –≥—Ä–µ—à–∫–∏—Ç–µ
   - –°–∏—Å—Ç–µ–º–∞—Ç–∞ —Å–∞–º–∞ —Å–µ –ø–æ–ø—Ä–∞–≤—è

3. **–ú–∏–Ω–∏–º–∞–ª–µ–Ω –∫–æ–¥** (—Å–∞–º–æ worker.js):
   - +173 —Ä–µ–¥–∞ –∫–æ–¥
   - 2 —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–µ–Ω–∏ (prompts)
   - 1 —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–µ–Ω–∞ (validation)
   - 3 helper —Ñ—É–Ω–∫—Ü–∏–∏

4. **–ú–∞–∫—Å–∏–º–∞–ª–µ–Ω –µ—Ñ–µ–∫—Ç**:
   - –ë–ª–æ–∫–∏—Ä–∞ –í–°–ï –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–∏ –±–µ–ª—Ç—ä—Ü–∏
   - –†–∞–±–æ—Ç–∏ –∑–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –ò –∞–Ω–≥–ª–∏–π—Å–∫–∏
   - –°–ø—Ä–∞–≤—è —Å–µ —Å —Ä–∞–∑–ª–∏—á–Ω–∏ —Ñ–æ—Ä–º–∏ –Ω–∞ –¥—É–º–∏—Ç–µ

### 5. –¢–µ—Å—Ç–æ–≤–µ ‚úÖ

```bash
$ node test-whitelist-validation.js

=== Testing Whitelist Validation ===

Test 1: Valid meal with chicken (whitelisted)
  ‚úì PASSED: 0 errors, 0 warnings

Test 2: Invalid meal with rabbit (not whitelisted, no reason)
  ‚úì PASSED: 1 errors, 0 warnings

Test 3: Valid meal with rabbit WITH reason
  ‚úì PASSED: 0 errors, 1 warnings

Test 4: Invalid meal with duck (not whitelisted)
  ‚úì PASSED: 2 errors, 0 warnings

Test 5: Valid meal with beef (whitelisted)
  ‚úì PASSED: 0 errors, 0 warnings

Test 6: Invalid meal with lamb (not whitelisted)
  ‚úì PASSED: 1 errors, 0 warnings

=== Test Summary ===
Total: 6
Passed: 6 ‚úÖ
Failed: 0
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ –º–∏–Ω–∞–≤–∞—Ç  
**–ü–æ–∫—Ä–∏—Ç–∏–µ**: Whitelisted, non-whitelisted, justified exceptions

### 6. –°–∏–≥—É—Ä–Ω–æ—Å—Ç ‚úÖ

```bash
$ CodeQL Security Scan
‚úÖ 0 issues found
```

- ‚úÖ Regex escaping (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ ReDoS)
- ‚úÖ –í–∞–ª–∏–¥–∏—Ä–∞–Ω–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ (–Ω–µ user input)
- ‚úÖ Helper —Ñ—É–Ω–∫—Ü–∏–∏ (maintainability)

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ:

1. **"–†–∞–±–æ—Ç–∏ –ª–∏ —Ä–µ–∞–ª–Ω–æ?"**  
   ‚úÖ **–î–ê** - –ê–∫—Ç–∏–≤–Ω–æ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–∞—â–æ

2. **"–í–∫–∞—Ä–∞–Ω–æ –ª–∏ –µ?"**  
   ‚úÖ **–î–ê** - –ü—ä–ª–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å correction loop

3. **"–ö–∞–∫ —Å –º–∏–Ω–∏–º—É–º –Ω–∞–º–µ—Å–∞ –ø–æ—Å—Ç–∏–≥–∞–º–µ –º–∞–∫—Å–∏–º–∞–ª–µ–Ω –µ—Ñ–µ–∫—Ç?"**  
   ‚úÖ **–ü–û–°–¢–ò–ì–ù–ê–¢–û**:
   - –î–≤–æ–π–Ω–∞ –∑–∞—â–∏—Ç–∞ (AI + Backend)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è
   - –ù—É–ª–µ–≤–∞ –Ω–∞–º–µ—Å–∞ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
   - –ú–∏–Ω–∏–º–∞–ª–µ–Ω –∫–æ–¥ (+173 —Ä–µ–¥–∞)
   - –ú–∞–∫—Å–∏–º–∞–ª–µ–Ω –µ—Ñ–µ–∫—Ç (–±–ª–æ–∫–∏—Ä–∞ –≤—Å–∏—á–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è)

## –ö–∞–∫–≤–æ –ù–ï —Ç—Ä—è–±–≤–∞ –¥–∞ –ø—Ä–∞–≤–∏–º

‚ùå **–ù–ï –¥–æ–±–∞–≤—è–π –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Å–ª–æ–µ–≤–µ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –∏–º–∞–º–µ –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ  
‚ùå **–ù–ï —É—Å–ª–æ–∂–Ω—è–≤–∞–π –ø—Ä–æ–º–ø—Ç–∏—Ç–µ –ø–æ–≤–µ—á–µ** - 414 —Ç–æ–∫–µ–Ω–∞ –µ –æ–ø—Ç–∏–º–∞–ª–Ω–æ  
‚ùå **–ù–ï –¥–æ–±–∞–≤—è–π UI –∑–∞ whitelist management** - —Å—Ç–∞—Ç–∏—á–Ω–∏—è—Ç —Å–ø–∏—Å—ä–∫ –µ –¥–æ–±—ä—Ä  
‚ùå **–ù–ï –ø–∏—à–∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ** - 6 —Ç–µ—Å—Ç–∞ –ø–æ–∫—Ä–∏–≤–∞—Ç –≤—Å–∏—á–∫–æ –Ω—É–∂–Ω–æ

## –ö–∞–∫–≤–æ –ú–û–ñ–ï–ú –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)

‚úÖ **–î–æ–±–∞–≤–∏ –ª–æ–≥–≤–∞–Ω–µ** –Ω–∞ –∑–∞–ª–æ–≤–µ–Ω–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞  
‚úÖ **–î–æ–±–∞–≤–∏ –º–µ—Ç—Ä–∏–∫–∏** –∫–æ–ª–∫–æ —á–µ—Å—Ç–æ —Å–µ –Ω–∞–ª–∞–≥–∞ –∫–æ—Ä–µ–∫—Ü–∏—è  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–∞–π** –∑–∞ –±—ä–¥–µ—â–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏—Ü–∏ (‚úÖ –≤–µ—á–µ –Ω–∞–ø—Ä–∞–≤–µ–Ω–æ)

## –ü—Ä–µ–ø–æ—Ä—ä–∫–∞

üéØ **–°–ò–°–¢–ï–ú–ê–¢–ê –†–ê–ë–û–¢–ò –û–¢–õ–ò–ß–ù–û! –ù–ï –ï –ù–£–ñ–ù–ê –î–û–ü–™–õ–ù–ò–¢–ï–õ–ù–ê –†–ê–ë–û–¢–ê.**

–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞ –µ:
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª–Ω–∞
- ‚úÖ –ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞
- ‚úÖ –¢–µ—Å—Ç–≤–∞–Ω–∞
- ‚úÖ –°–∏–≥—É—Ä–Ω–∞

**–ü–æ—Å—Ç–∏–≥–Ω–∞—Ç –µ –º–∞–∫—Å–∏–º–∞–ª–µ–Ω –µ—Ñ–µ–∫—Ç —Å –º–∏–Ω–∏–º–∞–ª–Ω–∞ –Ω–∞–º–µ—Å–∞!** üéâ

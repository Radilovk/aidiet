# Пътна Карта за Внедряване на Решенията
*Базирано на issue-resolutions-2026-02-05.json*

## Обобщение
От общо 36 идентифицирани проблема:
- **21** изискват действие (13 custom решения + 8 accept)
- **15** пропуснати (skip)

---

## ФАЗА 1: Математически Основи и Калкулации
*Приоритет: ВИСОК | Зависимости: Няма*

### 1.1 Рекалибриране на Активност (Issue #7)
**Текущ проблем:** Объркване в activity factor изчисленията

**Ново решение:**
- Дневна активност: нива 1-3
- Спортни дни: 0-7 дни/седмица
- Обединена скала: 1-10 (дневна активност + спортни дни)
- Пример: активност=3, спорт=2дни → общо=5
- Пример: активност=1, спорт=3дни → общо=4

**Засегнати файлове:**
- `worker.js` - калкулация на TDEE
- Prompt инструкции за AI модела

---

### 1.2 TDEE и Калориен Дефицит (Issues #9, #10)
**Текущ проблем:** Нереалистични примери и дублирани фактори

**Ново решение:**
- Базов максимален дефицит: 25%
- AI може да коригира при специфични стратегии (интермитентно гладуване и др.)
- Преизчисляване на реалистични TDEE множители
- Елиминиране на дублирани дефиниции

**Засегнати файлове:**
- `worker.js` - TDEE формули
- Документация - примери

---

### 1.3 Макронутриенти Съотношения (Issues #2, #28)
**Текущ проблем:** Circular logic и некоректни протеинови изчисления

**Ново решение:**
- Формула базирана на процентни съотношения (не циркулярна)
- Протеинови нужди различни за жени/мъжи
- Backend формули видими за AI модела
- AI модел потвърждава или коригира базовите калкулации

**Засегнати файлове:**
- `worker.js` - макронутриентни формули
- AI prompt - експлицитни инструкции

---

## ФАЗА 2: AI Модел Подобрения
*Приоритет: ВИСОК | Зависимости: ФАЗА 1*

### 2.1 Лекарствени Взаимодействия (Issue #3)
**Текущ проблем:** AI не взема предвид медикаменти и добавки

**Ново решение:**
- AI задължително анализира описани медикаменти
- AI проверява взаимодействия хранене-лекарства
- AI избягва противоречащи хранителни добавки

**Засегнати файлове:**
- AI prompt - секция за медикаменти
- `worker.js` - добавяне на медикаментозна информация в контекста

---

### 2.2 Хронотип Адаптация (Issue #15)
**Текущ проблем:** Липсва алгоритъм за chronotype

**Ново решение:**
- AI модел прави свободна преценка (не фиксирана логика)
- Хронотип свързан с:
  - Психологически профил
  - Здравен статус
  - Пикови енергийни периоди
- AI решава необходимостта от адаптации

**Засегнати файлове:**
- AI prompt - chronotype инструкции
- Въпросник данни - осигуряване на chronotype данни

---

### 2.3 Вероятност за Успех (Issue #20)
**Текущ проблем:** Липсва calculation логика

**Ново решение:**
- AI модел определя success chance
- Базирано на пълния профил и контекст
- Без hardcoded формули

**Засегнати файлове:**
- AI prompt - инструкция за success rate
- План display - визуализация на вероятността

---

### 2.4 AI Стъпки Прецизиране (Issue #1)
**Текущ проблем:** Противоречие в броя стъпки

**Ново решение:**
- Структура: 4 основни стъпки
- Стъпка 3 има 4 подстъпки
- Общо: 7 стъпки + 1 валидираща = 8
- Документация актуализирана

**Засегнати файлове:**
- README.md - описание на стъпките
- `worker.js` - коментари

---

## ФАЗА 3: Сигурност и Валидация
*Приоритет: СРЕДЕН | Зависимости: Няма*

### 3.1 API Защити (Issue #5)
**Текущ проблем:** Липсва authentication

**Ново решение:**
- Rate limiting на заявки
- Basic token validation
- Без пречене на функционалността

**Засегнати файлове:**
- Cloudflare Worker - rate limiting
- `worker.js` - request validation

---

### 3.2 XSS Предпазване (Issue #23)
**Текущ проблем:** Недостатъчна защита

**Ново решение:**
- Базова санитизация на входни полета
- HTML escape при display
- Елементарен, но ефективен подход

**Засегнати файлове:**
- `questionnaire.html` - input sanitization
- `plan.html` - output escaping
- `analysis.html` - output escaping

---

### 3.3 Текстова Валидация (Issue #33)
**Текущ проблем:** Липсват лимити

**Ново решение:**
- Максимум 200 символа за текстови полета
- Визуален индикатор за остатъчни символи
- Graceful handling при превишаване

**Засегнати файлове:**
- `questionnaire.html` - maxlength атрибути
- CSS - counter визуализация

---

## ФАЗА 4: UX и Концептуални Промени
*Приоритет: НИСЪК | Зависимости: Няма*

### 4.1 Meal Timing Семантика (Issue #30)
**Текущ проблем:** Еднакви часове за всички

**Ново решение:**
- Работа с концепции, не точни часове:
  - "закуска" (рано сутрин)
  - "обяд" (обедно време)
  - "следобедна закуска" (следобед)
  - "вечеря" (вечер)
  - "късно хранене" (нощ)
- AI интерпретира според клиентския профил

**Засегнати файлове:**
- AI prompt - meal timing инструкции
- План формат - гъвкави етикети

---

### 4.2 Повторение Метрика (Issue #11)
**Текущ проблем:** Противоречиви правила

**Ново решение:**
- Избор на ЕДНА проста метрика
- Максимално приложима
- Релевантна за целта

**Засегнати файлове:**
- Логика за генериране на план
- AI prompt

---

## ФАЗА 5: Документация и Структура
*Приоритет: НИСЪК | Зависимости: ФАЗА 1-4*

### 5.1 Дублирани Дефиниции (Issues #24, #25)
**Текущ проблем:** Схеми и activity factors повтарят се

**Ново решение:**
- Merge на дублирани секции
- Единна референция

**Засегнати файлове:**
- Документация файлове

---

### 5.2 TOC и Индексация (Issues #26, #27)
**Текущ проблем:** Некоректна нумерация, липсва индекс

**Ново решение:**
- Корекция на table of contents
- Добавяне на тематичен индекс
- Подобрена навигация

**Засегнати файлове:**
- Документация файлове

---

### 5.3 Числови Диапазони (Issue #31)
**Текущ проблем:** Липсват range спецификации

**Ново решение:**
- Дефиниране на min/max за числа
- Валидация boundaries
- Документиране на очаквани стойности

**Засегнати файлове:**
- Документация
- Валидация логика

---

### 5.4 Array Validation (Issue #34)
**Текущ проблем:** Неясни правила

**Ново решение:**
- Прецизиране на array constraints
- Минимална/максимална дължина
- Тип елементи

**Засегнати файлове:**
- Документация

---

### 5.5 Sleep Formula (Issue #19)
**Текущ проблем:** Липсва формула

**Ново решение:**
- Accept - приемане на предложената формула
- Документиране

**Засегнати файлове:**
- Документация

---

## График на Изпълнение

```
Седмица 1: ФАЗА 1 (Математика)
│ ├─ Ден 1-2: Activity Factor + TDEE
│ └─ Ден 3-4: Макронутриенти

Седмица 2: ФАЗА 2 (AI Модел)
│ ├─ Ден 1-2: Медикаменти + Хронотип
│ └─ Ден 3-4: Success Rate + AI Стъпки

Седмица 3: ФАЗА 3 (Сигурност)
│ ├─ Ден 1-2: API Защити
│ └─ Ден 3-4: XSS + Валидация

Седмица 4: ФАЗА 4-5 (UX + Docs)
│ ├─ Ден 1-2: Meal Timing + Метрики
│ └─ Ден 3-5: Документация
```

---

## Критерии за Приемане

### За всяка фаза:
1. ✅ Код review завършен
2. ✅ Ръчно тестване проведено
3. ✅ Документация актуализирана
4. ✅ Няма регресии в съществуваща функционалност

### Специфични метрики:
- **ФАЗА 1:** Математически формули валидирани с примерни изчисления
- **ФАЗА 2:** AI output качество проверено с тестови профили
- **ФАЗА 3:** Сигурност одобрена от security scan
- **ФАЗА 4:** UX подобрения потвърдени от user feedback
- **ФАЗА 5:** Документация пълна и коректна

---

## Рискове и Митигация

| Риск | Вероятност | Въздействие | Митигация |
|------|-----------|-------------|-----------|
| Breaking changes в AI API | Средна | Високо | Версиониране на prompts |
| Математически грешки | Ниска | Високо | Unit тестове + peer review |
| Performance деградация | Средна | Средно | Benchmark преди/след |
| UX объркване | Ниска | Средно | Beta testing с потребители |

---

*Документ генериран на: 2026-02-06*
*Базиран на: issue-resolutions-2026-02-05.json*

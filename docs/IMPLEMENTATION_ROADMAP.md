# Пътна Карта за Внедряване на Решенията
*Базирано на issue-resolutions-2026-02-05.json*

## Обобщение
От общо 36 идентифицирани проблема:
- **21** изискват действие (13 custom решения + 8 accept)
- **15** пропуснати (skip)

**Статус:**
- ✅ **ФАЗА 1 ЗАВЪРШЕНА** (2026-02-06) - Issues #2, #7, #9, #10, #28
- ✅ **ФАЗА 2 ЗАВЪРШЕНА** (2026-02-06) - Issues #1, #3, #15, #20
- ⏳ **ФАЗА 3** - Предстояща
- ⏳ **ФАЗА 4-5** - Предстоящи

---

## ✅ ФАЗА 1: Математически Основи и Калкулации
*Приоритет: ВИСОК | Зависимости: Няма*  
**Статус: ЗАВЪРШЕНА (2026-02-06)**

Виж детайли: [PHASE1_IMPLEMENTATION.md](PHASE1_IMPLEMENTATION.md)

### ✅ 1.1 Рекалибриране на Активност (Issue #7)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- Създадена `calculateUnifiedActivityScore()` функция
- Дневна активност: нива 1-3
- Спортни дни: 0-7 дни/седмица
- Обединена скала: 1-10 (дневна активност + спортни дни)
- Пример: активност=3, спорт=2дни → общо=5
- Пример: активност=1, спорт=3дни → общо=4

**Променени файлове:**
- ✅ `worker.js` - нова функция calculateUnifiedActivityScore()
- ✅ AI prompt - детайлни изчисления експонирани

---

### ✅ 1.2 TDEE и Калориен Дефицит (Issues #9, #10)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- Обновена `calculateTDEE()` с плавни множители (1.2-1.95)
- Създадена `calculateSafeDeficit()` функция
- Базов максимален дефицит: 25%
- AI може да коригира при специфични стратегии (интермитентно гладуване и др.)
- Елиминирани дублирани дефиниции
- 10 стъпки вместо 5 категории

**Променени файлове:**
- ✅ `worker.js` - обновени TDEE формули
- ✅ AI prompt - показани max deficit и референтни калории

---

### ✅ 1.3 Макронутриенти Съотношения (Issues #2, #28)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- Създадена `calculateMacronutrientRatios()` функция
- Формула базирана на процентни съотношения (НЕ циркулярна)
- Протеинови нужди различни за жени (1.0-1.8 g/kg) и мъжи (1.2-2.0 g/kg)
- Backend формули видими за AI модела
- AI модел потвърждава или коригира базовите калкулации
- Валидация: сума = 100%

**Променени файлове:**
- ✅ `worker.js` - нови макронутриентни формули
- ✅ AI prompt - експлицитни backend изчисления

---

## ✅ ФАЗА 2: AI Модел Подобрения
*Приоритет: ВИСОК | Зависимости: ФАЗА 1*  
**Статус: ЗАВЪРШЕНА (2026-02-06)**

Виж детайли: [PHASE2_IMPLEMENTATION.md](PHASE2_IMPLEMENTATION.md)

### ✅ 2.1 Лекарствени Взаимодействия (Issue #3)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- AI задължително анализира описани медикаменти
- 4-стъпков процес:
  1. Анализ на влияние на медикаменти
  2. Проверка взаимодействия храна-лекарство
  3. Идентификация на противопоказани добавки
  4. Препоръки за подпомагащи храни
- Активира се само при medications === 'Да'

**Променени файлове:**
- ✅ `worker.js` - enhanced AI prompt с medication checks

---

### ✅ 2.2 Хронотип Адаптация (Issue #15)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- AI прави свободна преценка (НЕ hardcoded логика)
- 4 корелационни анализа:
  1. Психологически профил ↔ Хронотип
  2. Здравен статус ↔ Хронотип  
  3. Енергийни периоди ↔ Хронотип
  4. Сън ↔ Хронотип ↔ Хранене
- AI сам решава необходимите адаптации

**Променени файлове:**
- ✅ `worker.js` - enhanced chronotype instructions

---

### ✅ 2.3 Вероятност за Успех (Issue #20)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- AI определя success chance БЕЗ hardcoded формули
- Холистична оценка базирана на пълен профил
- 11 позитивни фактора
- 10 негативни фактора
- Специфични корекции за диети, метаболизъм, психология

**Променени файлове:**
- ✅ `worker.js` - enhanced success chance prompt

---

### ✅ 2.4 AI Стъпки Прецизиране (Issue #1)
**Статус:** ИМПЛЕМЕНТИРАНО

**Решение:**
- Структура: 4 основни стъпки
- Стъпка 3 има 4 подстъпки (дни 1-2, 3-4, 5-6, 7)
- 1 валидираща стъпка
- Общо: 7 + 1 = 8 AI заявки
- Документация актуализирана

**Променени файлове:**
- ✅ `README.md` - updated AI steps structure
- ✅ `worker.js` - updated header comments

---

## ФАЗА 3: Сигурност и Валидация
*Приоритет: СРЕДЕН | Зависимости: Няма*

### 3.1 API Защити (Issue #5)
**Текущ проблем:** Липсва authentication

**Ново решение:**
- Rate limiting на заявки
- Basic token validation
- Без пречене на функционалността

**Засегнати файлове:**
- Cloudflare Worker - rate limiting
- `worker.js` - request validation

---

### 3.2 XSS Предпазване (Issue #23)
**Текущ проблем:** Недостатъчна защита

**Ново решение:**
- Базова санитизация на входни полета
- HTML escape при display
- Елементарен, но ефективен подход

**Засегнати файлове:**
- `questionnaire.html` - input sanitization
- `plan.html` - output escaping
- `analysis.html` - output escaping

---

### 3.3 Текстова Валидация (Issue #33)
**Текущ проблем:** Липсват лимити

**Ново решение:**
- Максимум 200 символа за текстови полета
- Визуален индикатор за остатъчни символи
- Graceful handling при превишаване

**Засегнати файлове:**
- `questionnaire.html` - maxlength атрибути
- CSS - counter визуализация

---

## ФАЗА 4: UX и Концептуални Промени
*Приоритет: НИСЪК | Зависимости: Няма*

### 4.1 Meal Timing Семантика (Issue #30)
**Текущ проблем:** Еднакви часове за всички

**Ново решение:**
- Работа с концепции, не точни часове:
  - "закуска" (рано сутрин)
  - "обяд" (обедно време)
  - "следобедна закуска" (следобед)
  - "вечеря" (вечер)
  - "късно хранене" (нощ)
- AI интерпретира според клиентския профил

**Засегнати файлове:**
- AI prompt - meal timing инструкции
- План формат - гъвкави етикети

---

### 4.2 Повторение Метрика (Issue #11)
**Текущ проблем:** Противоречиви правила

**Ново решение:**
- Избор на ЕДНА проста метрика
- Максимално приложима
- Релевантна за целта

**Засегнати файлове:**
- Логика за генериране на план
- AI prompt

---

## ФАЗА 5: Документация и Структура
*Приоритет: НИСЪК | Зависимости: ФАЗА 1-4*

### 5.1 Дублирани Дефиниции (Issues #24, #25)
**Текущ проблем:** Схеми и activity factors повтарят се

**Ново решение:**
- Merge на дублирани секции
- Единна референция

**Засегнати файлове:**
- Документация файлове

---

### 5.2 TOC и Индексация (Issues #26, #27)
**Текущ проблем:** Некоректна нумерация, липсва индекс

**Ново решение:**
- Корекция на table of contents
- Добавяне на тематичен индекс
- Подобрена навигация

**Засегнати файлове:**
- Документация файлове

---

### 5.3 Числови Диапазони (Issue #31)
**Текущ проблем:** Липсват range спецификации

**Ново решение:**
- Дефиниране на min/max за числа
- Валидация boundaries
- Документиране на очаквани стойности

**Засегнати файлове:**
- Документация
- Валидация логика

---

### 5.4 Array Validation (Issue #34)
**Текущ проблем:** Неясни правила

**Ново решение:**
- Прецизиране на array constraints
- Минимална/максимална дължина
- Тип елементи

**Засегнати файлове:**
- Документация

---

### 5.5 Sleep Formula (Issue #19)
**Текущ проблем:** Липсва формула

**Ново решение:**
- Accept - приемане на предложената формула
- Документиране

**Засегнати файлове:**
- Документация

---

## График на Изпълнение

```
Седмица 1: ФАЗА 1 (Математика)
│ ├─ Ден 1-2: Activity Factor + TDEE
│ └─ Ден 3-4: Макронутриенти

Седмица 2: ФАЗА 2 (AI Модел)
│ ├─ Ден 1-2: Медикаменти + Хронотип
│ └─ Ден 3-4: Success Rate + AI Стъпки

Седмица 3: ФАЗА 3 (Сигурност)
│ ├─ Ден 1-2: API Защити
│ └─ Ден 3-4: XSS + Валидация

Седмица 4: ФАЗА 4-5 (UX + Docs)
│ ├─ Ден 1-2: Meal Timing + Метрики
│ └─ Ден 3-5: Документация
```

---

## Критерии за Приемане

### За всяка фаза:
1. ✅ Код review завършен
2. ✅ Ръчно тестване проведено
3. ✅ Документация актуализирана
4. ✅ Няма регресии в съществуваща функционалност

### Специфични метрики:
- **ФАЗА 1:** Математически формули валидирани с примерни изчисления
- **ФАЗА 2:** AI output качество проверено с тестови профили
- **ФАЗА 3:** Сигурност одобрена от security scan
- **ФАЗА 4:** UX подобрения потвърдени от user feedback
- **ФАЗА 5:** Документация пълна и коректна

---

## Рискове и Митигация

| Риск | Вероятност | Въздействие | Митигация |
|------|-----------|-------------|-----------|
| Breaking changes в AI API | Средна | Високо | Версиониране на prompts |
| Математически грешки | Ниска | Високо | Unit тестове + peer review |
| Performance деградация | Средна | Средно | Benchmark преди/след |
| UX объркване | Ниска | Средно | Beta testing с потребители |

---

*Документ генериран на: 2026-02-06*
*Базиран на: issue-resolutions-2026-02-05.json*

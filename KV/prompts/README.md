# AI Prompts Directory

Тази папка съдържа всички AI промптове, използвани за генериране на хранителни планове и консултации.

## Файлове с промптове

### Стъпки на генериране на план

1. **admin_analysis_prompt.txt** - Анализ на здравословния профил
   - Входни данни: Пълен профил на потребителя
   - Изходни данни: Холистичен анализ с BMR, TDEE, макроси, психопрофил
   - Използва се в: `generateAnalysisPrompt()`

2. **admin_strategy_prompt.txt** - Определяне на диетична стратегия
   - Входни данни: Потребителски данни + Анализ
   - Изходни данни: Персонализирана стратегия с хранителен модел, време на хранене
   - Използва се в: `generateStrategyPrompt()`

3. **admin_meal_plan_prompt.txt** - Генериране на хранителен план
   - Входни данни: Данни + Анализ + Стратегия
   - Изходни данни: 7-дневен хранителен план с детайлни ястия
   - Използва се в: `generateMealPlanChunkPrompt()`

4. **admin_summary_prompt.txt** - Обобщение на плана
   - Входни данни: Данни + Анализ + План
   - Изходни данни: Резюме, препоръки, добавки
   - Използва се в: `generateMealPlanSummaryPrompt()`

### Чат режими

5. **admin_consultation_prompt.txt** - Режим на консултация
   - Използва се за четене и обяснение на плана БЕЗ промени
   - Използва се в: `generateChatPrompt()` с mode='consultation'

6. **admin_modification_prompt.txt** - Режим на промяна на плана
   - Използва се за обсъждане и прилагане на промени в плана
   - Използва се в: `generateChatPrompt()` с mode='modification'

7. **admin_correction_prompt.txt** - Корекция на грешки
   - Използва се за коригиране на невалидни планове
   - Използва се в: Validation error flow

## Формат на промптовете

Всички промптове използват JavaScript template literals с placeholders:
- `${data.name}` - Име на потребителя
- `${data.age}` - Възраст
- `${data.goal}` - Цел (отслабване, поддържане, набиране)
- `${bmr}` - Базова метаболитна скорост
- `${recommendedCalories}` - Препоръчителни калории
- И други променливи според контекста на всеки промпт

**ВАЖНО**: Промптовете съдържат JavaScript код и template literals (${...}) точно както са дефинирани в worker.js. Те се оценяват динамично при генериране на плана.

## Как се използват

1. **В worker.js**: Промптовете са дефинирани директно в функциите като `generateAnalysisPrompt()`, `generateStrategyPrompt()`, и т.н. като default стойности
2. **В KV/prompts**: Тези файлове съдържат СЪЩИТЕ default промптове извлечени от worker.js за лесна референция и качване към KV
3. **В KV storage**: Промптовете могат да се качат с `upload-kv-keys.sh` скрипта за персонализация
4. **В runtime**: Worker първо проверява за custom промптове в KV storage, ако няма такива използва hardcoded defaults от worker.js

## Качване към Cloudflare KV

За да качите промптовете към Cloudflare:

```bash
cd /path/to/aidiet
./KV/upload-kv-keys.sh
```

Това ще качи всички промптове от тази папка към KV storage.

## Редактиране

За да редактирате промптове:

1. **Локално**: Редактирайте файловете в тази папка
2. **В admin panel**: https://aidiet.radilov-k.workers.dev/admin.html
3. **Директно в KV**: Чрез Cloudflare Dashboard

**ВАЖНО**: 
- При редактиране на default промптове в worker.js, ЗАДЪЛЖИТЕЛНО актуализирайте съответния файл тук!
- При редактиране на файловете тук, те стават активни САМО след качване в KV storage
- Файловете в тази папка са синхронизирани с default промптовете в worker.js (последна синхронизация: 2026-02-15)

## Бележки

- Промптовете са на български език за по-добро разбиране от AI на локален контекст
- Всеки промпт е оптимизиран за конкретната стъпка в процеса
- Форматът е ИДЕНТИЧЕН с default промптовете hardcoded в worker.js
- Промптовете съдържат JavaScript template literals и динамичен код, който се оценява при runtime

## Последни Промени (19 Февруари 2026)

**ОПТИМИЗАЦИЯ И ОПРОСТЯВАНЕ НА ПРОМПТОВЕТЕ**

Промптовете са опростени и подобрени за по-ясна комуникация с AI модела:

- **admin_analysis_prompt.txt**: 397 → 212 реда (47% намаление)
  - Премахнати декоративни сепаратори и дублирана информация
  - Изяснена логика за корекции на калориите
  - Консистентна схема за всички полета
  - Премахнати повтарящи се ВАЖНО секции

- **admin_strategy_prompt.txt**: 190 → 113 реда (41% намаление)
  - Премахната вложена условна логика
  - Консолидирани инструкции за хранене
  - Опростена секторна структура

- **admin_meal_plan_prompt.txt**: 180 → 121 реда (33% намаление)
  - Премахнат ADLE технически жаргон
  - Директни примери вместо кодирани категории ([PRO], [ENG], [VOL])
  - Опростена whitelist/blacklist логика
  - Ясни и разбираеми инструкции

- **admin_summary_prompt.txt**: 65 → 59 реда (9% намаление)
  - Премахната излишна информация
  - Фокус върху необходимите данни

- **admin_correction_prompt.txt**: 93 → 76 реда (18% намаление)
  - Премахнати декоративни елементи
  - Опростени правила за коригиране

**Общо намаление**: 925 → 581 реда (37% общо намаление)

**Ползи**:
- По-ясна и директна комуникация с AI модела
- По-малко объркващи и противоречиви инструкции
- По-добра синхронизация с backend схемата
- По-лесно четими и поддържаеми промпти
- По-малко token употреба = по-бързи отговори

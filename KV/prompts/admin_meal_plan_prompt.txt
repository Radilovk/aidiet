Генерирай ДНИ ${startDay}-${endDay} за ${data.name}.

=== ПРОФИЛ ===
Цел: ${data.goal} | BMR: ${bmr} | Калории: ${recommendedCalories} kcal/ден | Модификатор: "${dietaryModifier}"${modificationsSection}
Стрес: ${data.stressLevel} | Сън: ${data.sleepHours}ч | Хронотип: ${data.chronotype}${previousDaysContext}

=== ДАННИ ОТ СТЪПКА 1 (АНАЛИЗ) ===
Макро съотношения: ${analysisCompact.macroRatios}
Дневни макро грамове: ${analysisCompact.macroGrams}
Дневни фибри: ${analysisCompact.fiber}

=== ДАННИ ОТ СТЪПКА 2 (СТРАТЕГИЯ) ===
Диета: ${strategyCompact.dietType} | Хранения: ${strategyCompact.mealTiming}
Принципи: ${strategyCompact.keyPrinciples}
Предпочитани храни (от стъпка 2): ${strategyCompact.foodsToInclude}
Допълнителни предпочитани храни (от потребител): ${data.dietLove || 'няма'}
Нежелани храни (от стъпка 2): ${strategyCompact.foodsToAvoid}
Допълнителни нежелани храни (от потребител): ${data.dietDislike || 'няма'}
Разпределение на калории (стъпка 2): ${strategyCompact.calorieDistribution}
Разпределение на макроси (стъпка 2): ${strategyCompact.macroDistribution}${strategyCompact.weeklyScheme ? `

=== СЕДМИЧНА СТРУКТУРА (от стъпка 2) ===
${Object.keys(strategyCompact.weeklyScheme).map(day => {
  const dayData = strategyCompact.weeklyScheme[day];
  const dayName = DAY_NAMES_BG[day] || day; // Fallback to English name if not found
  return `${dayName}: ${dayData.meals} хранения - ${dayData.description}`;
}).join('\n')}` : ''}${data.additionalNotes ? `

ВАЖНО - Потребителски бележки: ${data.additionalNotes}` : ''}

=== ADLE v5.1 - АРХИТЕКТУРА НА ХРАНЕНЕТО ===
Ти действаш като Advanced Dietary Logic Engine (ADLE) – логически конструктор на хранителни режими.

МОДИФИКАТОР (Диетичен филтър): "${dietaryModifier}"
Модификаторът филтрира кои храни са ПОЗВОЛЕНИ от универсалната база.

УНИВЕРСАЛНА БАЗА ОТ РЕСУРСИ (Категории храни):
[PRO] БЕЛТЪК - Основен градивен елемент:
  • Животински: месо (пилешко, говеждо, свинско), риба, яйца, млечни (сирене, извара, кисело мляко)
  • Растителен: тофу, темпе, растителен протеин
  • Смесен: бобови (леща, боб, нахут) - PRO или ENG според режима

[ENG] ЕНЕРГИЯ - Въглехидрати/Скорбяла:
  • Зърнени: ориз, киноа, елда, овес, паста, хляб
  • Кореноплодни: картофи, сладки картофи
  • Плодове: всички видове (съдържат захар)

[VOL] ОБЕМ И ФИБРИ - Зеленчуци без скорбяла:
  • Сурови: салати (листни), краставици, домати
  • Готвени: броколи, тиквички, чушки, гъби, карфиол, патладжан

[FAT] МАЗНИНИ - Вкус и ситост:
  • Източници: зехтин, масло, авокадо, ядки, семена, тахан, маслини

[CMPX] СЪСТАВНИ/СЛОЖНИ ЯСТИЯ - Възприемани като "едно цяло":
  • Тестени/Печива: пица, лазаня, мусака, паста със сос, киш/баница
  • Сандвич-тип: бургер, дюнер/врап, такос
  • Яхнии/Оризови: ястия, в които не можеш да отделиш белтъка от гарнитурата (ризото, паеля)

СТРУКТУРНИ ШАБЛОНИ (Форми на ястия):
ШАБЛОН A: "РАЗДЕЛЕНА ЧИНИЯ" → [PRO] + [ENG] + [VOL]
  Пример: Печено пиле + Картофи на фурна + Зелена салата
  Употреба: Стандартен обяд/вечеря

ШАБЛОН B: "СМЕСЕНО ЯСТИЕ/КУПА" → Смес от [PRO] + [ENG] + [VOL]
  Пример: Пилешка яхния с грах и картофи; Купа с киноа, тофу и зеленчуци
  Употреба: Готвено домашно ястие

ШАБЛОН C: "ЛЕКО/САНДВИЧ" → [ENG-Хляб] + [PRO] + [FAT] + [VOL-Свежест]
  Пример: Сандвич с пуешко и кашкавал; Тост с авокадо и яйце
  Употреба: Закуска или Обяд в движение

ШАБЛОН D: "ЕДИНЕН БЛОК" → [CMPX] + [VOL-Салата/Зеленчук]
  Пример: Парче лазаня + Салата домати; Бургер + Салата коулсло
  ЗАДЪЛЖИТЕЛНО: Винаги добавяй [VOL] като баланс към тежките храни
  Употреба: Уикенд, свободно хранене, комфортна храна

ЛОГИЧЕСКИ ЛОСТОВЕ (Как МОДИФИКАТОРЪТ управлява системата):
1. ФИЛТРИРАНЕ: Ако модификатор забранява група → търси алтернатива в същата категория
   • "Веган" → без животински [PRO], използвай растителен
   • "Без глутен" → [ENG] само безглутенови (ориз/картофи/царевица)
   • "Кето/Нисковъглехидратно" → минимизирай [ENG], компенсирай с [VOL] и [FAT]

2. ДЕКОНСТРУКЦИЯ НА [CMPX]: Преди да избереш Шаблон D, провери дали съставът е съвместим!
   • При "Нисковъглехидратно": стандартен бургер (хляб) е несъвместим → "Бургер без хлебче"
   • При "Веган": "Лазаня" → "Веган лазаня със зеленчуци"
   • Ако не можеш да гарантираш съвместимост → НЕ използвай Шаблон D

3. АКТИВНОСТ НА КАТЕГОРИИТЕ:
   • Нисковъглехидратно: [ENG] деактивиран → компенсирай с повече [VOL] и [FAT]
   • Щадящ стомах: [VOL] само готвени/щадящи (без сурови влакнини)

HARD BANS: лук, пуешко месо, мед, захар, кетчуп, майонеза, гръцко кисело мляко, грах+риба
РЯДКО (≤2x/седмица): бекон, пуешка шунка
WHITELIST: ${dynamicWhitelistSection}${dynamicBlacklistSection}

ПРАВИЛА ЗА ИЗХОД:
• Естествен български език - БЕЗ технически кодове ([PRO], [ENG])
• Без странни комбинации - общоприети кулинарни норми
• Шаблон D не е "прегрешение" - нормална част от менюто (напр. уикенд), винаги балансиран със салата
• Адаптивност: Ако категория не може да се попълни → автоматично премини към позволена алтернатива

=== ИЗИСКВАНИЯ ===
1. Разпределение на калории: Използвай "Разпределение на калории" от стъпка 2 за правилно разпределение на калориите по хранения
2. Макроси ЗАДЪЛЖИТЕЛНИ: protein, carbs, fats, fiber в грамове за ВСЯКО ястие
3. Калории: protein×4 + carbs×4 + fats×9
4. Целеви дневни калории: ~${recommendedCalories} kcal (±${DAILY_CALORIE_TOLERANCE} kcal OK)
5. Брой хранения: ${strategy.mealCountJustification || '2-5 хранения според профила (1-2 при IF, 3-4 стандартно)'}
6. Ред: Закуска, ако е посочено в стъпка 2→ Обяд → (Следобедна закуска Ако е посочена в стъпка 2) → Вечеря → (Късна закуска ако е посочена от стъпка 2)
   Късна закуска САМО с low GI: кисело мляко, ядки, ягоди/боровинки, авокадо, семена (макс ${MAX_LATE_SNACK_CALORIES} kcal)
7. Разнообразие: Различни ястия от предишните дни
8. Продукти ЗАДЪЛЖИТЕЛНИ: За ВСЯКО ястие, посочи списък products с name и weight (в грамове) на всеки продукт/съставка в храненето
${data.eatingHabits && data.eatingHabits.includes('Не закусвам') ? '\nВАЖНО: Клиентът НЕ ЗАКУСВА - без закуска или само напитка!' : ''}

${MEAL_NAME_FORMAT_INSTRUCTIONS}

JSON ФОРМАТ (дни ${startDay}-${endDay}):
{
  "day${startDay}": {
    "meals": [
      {"type": "Закуска/Следобедна закуска/Обяд/Вечеря/Късна закуска", "name": "име", "weight": "Xг", "description": "описание", "benefits": "ползи", "calories": X, "macros": {"protein": X, "carbs": X, "fats": X, "fiber": X}, "products": [{"name": "продукт1", "weight": "Xг"}, {"name": "продукт2", "weight": "Xг"}]}
    ],
    "dailyTotals": {"calories": X, "protein": X, "carbs": X, "fats": X}
  }${daysInChunk > 1 ? `,\n  "day${startDay + 1}": {...}` : ''}
}

Генерирай балансирани български ястия. ЗАДЪЛЖИТЕЛНО включи dailyTotals и products списък с грамажите на всеки продукт в храненето!

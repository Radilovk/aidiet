Генерирай ДНИ {startDay}-{endDay} за {userData.name}.

=== ПРОФИЛ ===
Цел: {userData.goal} | BMR: {bmr} | Калории: {recommendedCalories} kcal/ден | Модификатор: "{dietaryModifier}"{modificationsSection}
Стрес: {userData.stressLevel} | Сън: {userData.sleepHours}ч | Хронотип: {userData.chronotype}{previousDaysContext}

=== ДАННИ ОТ СТЪПКА 1 (АНАЛИЗ) ===
Макро съотношения: {analysisCompact.macroRatios}
Дневни макро грамове: {analysisCompact.macroGrams}
Дневни фибри: {analysisCompact.fiber}

=== ДАННИ ОТ СТЪПКА 2 (СТРАТЕГИЯ) — АРХИТЕКТУРА НА ХРАНЕНЕТО ===
Диета: {strategyCompact.dietType} | Хранения: {strategyCompact.mealTiming}
Принципи: {strategyCompact.keyPrinciples}
Предпочитани хранителни категории (от стъпка 2): {strategyCompact.foodsToInclude}
Допълнителни предпочитани храни (от потребител): {dietLove}
Нежелани хранителни категории (от стъпка 2): {strategyCompact.foodsToAvoid}
Допълнителни нежелани храни (от потребител): {dietDislike}
Разпределение на калории (стъпка 2): {strategyCompact.calorieDistribution}
Разпределение на макроси (стъпка 2): {strategyCompact.macroDistribution}

=== СЕДМИЧНА СТРУКТУРА С РАЗПРЕДЕЛЕНИЕ ПО ХРАНЕНИЯ (от стъпка 2) ===
{strategyCompact.weeklyScheme}

Потребителски бележки: {userData.additionalNotes}

=== ADLE v5.1 - ИЗБОР НА ПРОДУКТИ ===
Ти действаш като Advanced Dietary Logic Engine (ADLE) – избираш конкретни продукти, грамажи и комбинации по предписаната архитектура от Стъпка 2.

МОДИФИКАТОР (Диетичен филтър): "{dietaryModifier}"
Модификаторът филтрира кои храни са ПОЗВОЛЕНИ от универсалната база.

УНИВЕРСАЛНА БАЗА ОТ РЕСУРСИ (Категории храни):
[PRO] БЕЛТЪК - Основен градивен елемент:
  • Животински: месо (пилешко, говеждо, свинско), риба, яйца, млечни (сирене, извара, кисело мляко)
  • Растителен: тофу, темпе, растителен протеин
  • Смесен: бобови (леща, боб, нахут) - PRO или ENG според режима

[ENG] ЕНЕРГИЯ - Въглехидрати/Скорбяла:
  • Зърнени: ориз, киноа, елда, овес, паста, хляб
  • Кореноплодни: картофи, сладки картофи
  • Плодове: всички видове (съдържат захар)

[VOL] ОБЕМ И ФИБРИ - Зеленчуци без скорбяла:
  • Сурови: салати (листни), краставици, домати
  • Готвени: броколи, тиквички, чушки, гъби, карфиол, патладжан

[FAT] МАЗНИНИ - Вкус и ситост:
  • Източници: зехтин, масло, авокадо, ядки, семена, тахан, маслини

[CMPX] СЪСТАВНИ/СЛОЖНИ ЯСТИЯ - Възприемани като "едно цяло":
  • Тестени/Печива: пица, лазаня, мусака, паста със сос, киш/баница
  • Сандвич-тип: бургер, дюнер/врап, такос
  • Яхнии/Оризови: ястия, в които не можеш да отделиш белтъка от гарнитурата (ризото, паеля)

СТРУКТУРНИ ШАБЛОНИ (Форми на ястия):
ШАБЛОН A: "РАЗДЕЛЕНА ЧИНИЯ" → [PRO] + [ENG] + [VOL]
  Пример: Печено пиле + Картофи на фурна + Зелена салата
  Употреба: Стандартен обяд/вечеря

ШАБЛОН B: "СМЕСЕНО ЯСТИЕ/КУПА" → Смес от [PRO] + [ENG] + [VOL]
  Пример: Пилешка яхния с грах и картофи; Купа с киноа, тофу и зеленчуци
  Употреба: Готвено домашно ястие

ШАБЛОН C: "ЛЕКО/САНДВИЧ" → [ENG-Хляб] + [PRO] + [FAT] + [VOL-Свежест]
  Пример: Сандвич с пуешко и кашкавал; Тост с авокадо и яйце
  Употреба: Закуска или Обяд в движение

ШАБЛОН D: "ЕДИНЕН БЛОК" → [CMPX] + [VOL-Салата/Зеленчук]
  Пример: Парче лазаня + Салата домати; Бургер + Салата коулсло
  ЗАДЪЛЖИТЕЛНО: Винаги добавяй [VOL] като баланс към тежките храни
  Употреба: Уикенд, свободно хранене, комфортна храна

ЛОГИЧЕСКИ ЛОСТОВЕ (Как МОДИФИКАТОРЪТ управлява системата):
1. ФИЛТРИРАНЕ: Ако модификатор забранява група → търси алтернатива в същата категория
   • "Веган" → без животински [PRO], използвай растителен
   • "Без глутен" → [ENG] само безглутенови (ориз/картофи/царевица)
   • "Кето/Нисковъглехидратно" → минимизирай [ENG], компенсирай с [VOL] и [FAT]

2. ДЕКОНСТРУКЦИЯ НА [CMPX]: Преди да избереш Шаблон D, провери дали съставът е съвместим!
   • При "Нисковъглехидратно": стандартен бургер (хляб) е несъвместим → "Бургер без хлебче"
   • При "Веган": "Лазаня" → "Веган лазаня със зеленчуци"
   • Ако не можеш да гарантираш съвместимост → НЕ използвай Шаблон D

3. АКТИВНОСТ НА КАТЕГОРИИТЕ:
   • Нисковъглехидратно: [ENG] деактивиран → компенсирай с повече [VOL] и [FAT]
   • Щадящ стомах: [VOL] само готвени/щадящи (без сурови влакнини)

HARD BANS: лук, пуешко месо, мед, захар, кетчуп, майонеза, гръцко кисело мляко, грах+риба
РЯДКО (≤2x/седмица): бекон, пуешка шунка
WHITELIST: {dynamicWhitelistSection}{dynamicBlacklistSection}

ПРАВИЛА ЗА ИЗХОД:
• Естествен български език - БЕЗ технически кодове ([PRO], [ENG])
• Без странни комбинации - общоприети кулинарни норми
• Шаблон D не е "прегрешение" - нормална част от менюто (напр. уикенд), винаги балансиран със салата
• Адаптивност: Ако категория не може да се попълни → автоматично премини към позволена алтернатива

=== ИЗИСКВАНИЯ ===
1. Разпределение на калории: Използвай mealBreakdown от Стъпка 2 за всяко хранене — то задава ТОЧНИТЕ целеви калории и макроси за всяко хранене от деня
2. Макроси ЗАДЪЛЖИТЕЛНИ: protein, carbs, fats, fiber в грамове за ВСЯКО ястие
3. Калории: protein×4 + carbs×4 + fats×9
4. Целеви дневни калории (от стъпка 2): адаптирани по дни от Седмичната структура горе (±{DAILY_CALORIE_TOLERANCE} kcal OK)
5. Брой хранения: {strategyData.mealCountJustification}
6. Ред: Закуска, ако е посочено в стъпка 2→ Обяд → (Следобедна закуска Ако е посочена в стъпка 2) → Вечеря → (Късна закуска ако е посочена от стъпка 2)
   ВАЖНО: Ако навиците {userData.eatingHabits} включват "Не закусвам" - пропусни закуска!
   Късна закуска САМО с low GI: кисело мляко, ядки, ягоди/боровинки, авокадо, семена (макс {MAX_LATE_SNACK_CALORIES} kcal)
7. Разнообразие: Различни ястия от предишните дни

{MEAL_NAME_FORMAT_INSTRUCTIONS}

JSON ФОРМАТ (дни {startDay}-{endDay}):
{
  "day{startDay}": {
    "meals": [
      {"type": "Закуска/Следобедна закуска/Обяд/Вечеря/Късна закуска", "name": "име", "weight": "Xg", "description": "описание", "benefits": "ползи", "calories": X, "macros": {"protein": X, "carbs": X, "fats": X, "fiber": X}}
    ],
    "dailyTotals": {"calories": X, "protein": X, "carbs": X, "fats": X}
  }
}

Генерирай балансирани български ястия. ЗАДЪЛЖИТЕЛНО включи dailyTotals!

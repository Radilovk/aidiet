<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Ω–∞ –ò–∑–≤–µ—Å—Ç–∏—è - NutriPlan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 600px;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .status-box {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid;
        }
        
        .status-box.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .status-box.warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        
        .status-box.error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .status-box.info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        
        .info-item {
            padding: 10px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .info-item strong {
            display: inline-block;
            width: 180px;
            color: #666;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .test-results {
            margin-top: 20px;
        }
        
        ul {
            margin: 10px 0 10px 20px;
        }
        
        li {
            margin: 5px 0;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî –¢–µ—Å—Ç –Ω–∞ –ò–∑–≤–µ—Å—Ç–∏—è</h1>
        
        <div id="platformInfo" class="status-box info">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</h3>
            <div class="info-item">
                <strong>–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞ –°–∏—Å—Ç–µ–º–∞:</strong>
                <span id="osInfo">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
            </div>
            <div class="info-item">
                <strong>–ë—Ä–∞—É–∑—ä—Ä:</strong>
                <span id="browserInfo">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
            </div>
            <div class="info-item">
                <strong>PWA –†–µ–∂–∏–º:</strong>
                <span id="pwaInfo">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
            </div>
            <div class="info-item">
                <strong>Notification API:</strong>
                <span id="notifApiInfo">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
            </div>
            <div class="info-item">
                <strong>Service Worker:</strong>
                <span id="swInfo">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
            </div>
            <div class="info-item">
                <strong>Permission Status:</strong>
                <span id="permissionInfo">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
            </div>
        </div>
        
        <div id="compatibilityStatus"></div>
        
        <div style="margin: 20px 0;">
            <button id="requestPermBtn" onclick="requestPermission()">
                üîî –ü–æ–∏—Å–∫–∞–π Permission
            </button>
            <button id="testNotifBtn" onclick="sendTestNotification()" disabled>
                ‚úâÔ∏è –¢–µ—Å—Ç–≤–∞–π –ò–∑–≤–µ—Å—Ç–∏–µ
            </button>
            <button id="testSWNotifBtn" onclick="sendServiceWorkerNotification()" disabled>
                üì± –¢–µ—Å—Ç–≤–∞–π SW –ò–∑–≤–µ—Å—Ç–∏–µ
            </button>
        </div>
        
        <div id="testResults" class="test-results"></div>
        
        <a href="/" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º –ù–∞—á–∞–ª–æ</a>
    </div>
    
    <script>
        // Platform Detection
        const Platform = {
            isIOS: () => /iPhone|iPad|iPod/i.test(navigator.userAgent),
            isAndroid: () => /Android/i.test(navigator.userAgent),
            isHuawei: () => /huawei/i.test(navigator.userAgent) || /harmony/i.test(navigator.userAgent),
            isSafari: () => /Safari/i.test(navigator.userAgent) && !/Chrome/i.test(navigator.userAgent),
            isChrome: () => /Chrome/i.test(navigator.userAgent) && !/Edg/i.test(navigator.userAgent),
            isFirefox: () => /Firefox/i.test(navigator.userAgent),
            isPWA: () => window.matchMedia('(display-mode: standalone)').matches || 
                        window.navigator.standalone === true
        };
        
        // Update platform info
        function updatePlatformInfo() {
            // OS
            let os = 'Unknown';
            if (Platform.isIOS()) os = 'iOS';
            else if (Platform.isAndroid()) os = 'Android';
            else if (Platform.isHuawei()) os = 'Huawei/HarmonyOS';
            else if (navigator.userAgent.includes('Win')) os = 'Windows';
            else if (navigator.userAgent.includes('Mac')) os = 'macOS';
            else if (navigator.userAgent.includes('Linux')) os = 'Linux';
            document.getElementById('osInfo').textContent = os;
            
            // Browser
            let browser = 'Unknown';
            if (Platform.isChrome()) browser = 'Chrome';
            else if (Platform.isFirefox()) browser = 'Firefox';
            else if (Platform.isSafari()) browser = 'Safari';
            else if (navigator.userAgent.includes('Edg')) browser = 'Edge';
            document.getElementById('browserInfo').textContent = browser;
            
            // PWA
            const isPWA = Platform.isPWA();
            document.getElementById('pwaInfo').textContent = isPWA ? '‚úÖ –î–∞ (–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–æ)' : '‚ùå –ù–µ (Browser)';
            
            // Notification API
            const hasNotifAPI = 'Notification' in window;
            document.getElementById('notifApiInfo').textContent = hasNotifAPI ? '‚úÖ –ü–æ–¥–¥—ä—Ä–∂–∞ —Å–µ' : '‚ùå –ù–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞';
            
            // Service Worker
            const hasSW = 'serviceWorker' in navigator;
            document.getElementById('swInfo').textContent = hasSW ? '‚úÖ –ü–æ–¥–¥—ä—Ä–∂–∞ —Å–µ' : '‚ùå –ù–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞';
            
            // Permission
            if (hasNotifAPI) {
                const perm = Notification.permission;
                let permText = '';
                if (perm === 'granted') permText = '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ';
                else if (perm === 'denied') permText = '‚ùå –û—Ç–∫–∞–∑–∞–Ω–æ';
                else permText = '‚è∏Ô∏è –ù–µ –µ –ø–æ–∏—Å–∫–∞–Ω–æ';
                document.getElementById('permissionInfo').textContent = permText;
                
                // Update buttons
                if (perm === 'granted') {
                    document.getElementById('testNotifBtn').disabled = false;
                    document.getElementById('testSWNotifBtn').disabled = false;
                    document.getElementById('requestPermBtn').disabled = true;
                }
            } else {
                document.getElementById('permissionInfo').textContent = 'N/A';
            }
            
            // Show compatibility status
            showCompatibilityStatus(os, browser, isPWA, hasNotifAPI);
        }
        
        function showCompatibilityStatus(os, browser, isPWA, hasNotifAPI) {
            const container = document.getElementById('compatibilityStatus');
            let html = '';
            let cssClass = 'success';
            
            if (os === 'iOS' && !isPWA) {
                cssClass = 'warning';
                html = `
                    <h3>‚ö†Ô∏è iOS –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –ü–æ–¥–¥—Ä—ä–∂–∫–∞</h3>
                    <p>–ò–∑–≤–µ—Å—Ç–∏—è—Ç–∞ —Ä–∞–±–æ—Ç—è—Ç –°–ê–ú–û –∫–æ–≥–∞—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–æ –∫–∞—Ç–æ PWA.</p>
                    <p><strong>–ö–∞–∫ –¥–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞—Ç–µ:</strong></p>
                    <ol>
                        <li>–û—Ç–≤–æ—Ä–µ—Ç–µ –≤ Safari (–Ω–µ Chrome/Firefox)</li>
                        <li>–ù–∞—Ç–∏—Å–Ω–µ—Ç–µ Share –±—É—Ç–æ–Ω–∞ (–∫–≤–∞–¥—Ä–∞—Ç—á–µ —Å—ä—Å —Å—Ç—Ä–µ–ª–∫–∞)</li>
                        <li>–ò–∑–±–µ—Ä–µ—Ç–µ "Add to Home Screen"</li>
                        <li>–û—Ç–≤–æ—Ä–µ—Ç–µ –æ—Ç Home Screen</li>
                        <li>–†–∞–∑—Ä–µ—à–µ—Ç–µ –∏–∑–≤–µ—Å—Ç–∏—è</li>
                    </ol>
                `;
            } else if (os === 'Huawei/HarmonyOS') {
                cssClass = 'error';
                html = `
                    <h3>‚ùå Huawei –ù–µ –°–µ –ü–æ–¥–¥—ä—Ä–∂–∞</h3>
                    <p>–£–µ–± –∏–∑–≤–µ—Å—Ç–∏—è –Ω–µ —Ä–∞–±–æ—Ç—è—Ç –Ω–∞ Huawei —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–µ–∑ Google Services.</p>
                    <p><strong>–ê–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:</strong></p>
                    <ul>
                        <li>–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Huawei Calendar –∑–∞ –Ω–∞–ø–æ–º–Ω—è–Ω–∏—è</li>
                        <li>–ó–∞–¥–∞–π—Ç–µ alarms –≤ Clock app</li>
                        <li>–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Reminders app</li>
                    </ul>
                `;
            } else if (!hasNotifAPI) {
                cssClass = 'error';
                html = `
                    <h3>‚ùå –ë—Ä–∞—É–∑—ä—Ä—ä—Ç –ù–µ –ü–æ–¥–¥—ä—Ä–∂–∞ –ò–∑–≤–µ—Å—Ç–∏—è</h3>
                    <p>–ú–æ–ª—è, –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –ø–æ-–Ω–æ–≤–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞.</p>
                `;
            } else if (os === 'Android' || os === 'Windows' || os === 'macOS' || os === 'Linux') {
                cssClass = 'success';
                html = `
                    <h3>‚úÖ –ü—ä–ª–Ω–∞ –ü–æ–¥–¥—Ä—ä–∂–∫–∞</h3>
                    <p>–í–∞—à–∞—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–∞–ø—ä–ª–Ω–æ –ø–æ–¥–¥—ä—Ä–∂–∞ –∏–∑–≤–µ—Å—Ç–∏—è!</p>
                    <p>–ö–ª–∏–∫–Ω–µ—Ç–µ "–ü–æ–∏—Å–∫–∞–π Permission" –∑–∞ –¥–∞ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –∏–∑–≤–µ—Å—Ç–∏—è.</p>
                `;
            }
            
            container.className = 'status-box ' + cssClass;
            container.innerHTML = html;
        }
        
        async function requestPermission() {
            if (!('Notification' in window)) {
                showResult('‚ùå Notification API –Ω–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞', 'error');
                return;
            }
            
            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    showResult('‚úÖ Permission —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!', 'success');
                    updatePlatformInfo();
                } else if (permission === 'denied') {
                    showResult('‚ùå Permission –æ—Ç–∫–∞–∑–∞–Ω–æ. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ browser settings.', 'error');
                } else {
                    showResult('‚è∏Ô∏è Permission –Ω–µ –µ –¥–∞–¥–µ–Ω–æ.', 'warning');
                }
            } catch (e) {
                showResult('‚ùå –ì—Ä–µ—à–∫–∞: ' + e.message, 'error');
            }
        }
        
        async function sendTestNotification() {
            if (Notification.permission !== 'granted') {
                showResult('‚ùå Permission –Ω–µ –µ –¥–∞–¥–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–ü–æ–∏—Å–∫–∞–π Permission" –ø—ä—Ä–≤–æ.', 'error');
                return;
            }
            
            try {
                const notification = new Notification('üéâ –¢–µ—Å—Ç–æ–≤–æ –ò–∑–≤–µ—Å—Ç–∏–µ', {
                    body: '–ê–∫–æ –≤–∏–∂–¥–∞—Ç–µ —Ç–æ–≤–∞, –∏–∑–≤–µ—Å—Ç–∏—è—Ç–∞ —Ä–∞–±–æ—Ç—è—Ç –Ω–∞ –≤–∞—à–µ—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ!',
                    icon: '/icon-192x192.png',
                    tag: 'test-notification',
                    requireInteraction: false
                });
                
                notification.onclick = () => {
                    window.focus();
                    notification.close();
                };
                
                showResult('‚úÖ –¢–µ—Å—Ç–æ–≤–æ –∏–∑–≤–µ—Å—Ç–∏–µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ (Notification API)', 'success');
            } catch (e) {
                showResult('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ: ' + e.message, 'error');
            }
        }
        
        async function sendServiceWorkerNotification() {
            if (Notification.permission !== 'granted') {
                showResult('‚ùå Permission –Ω–µ –µ –¥–∞–¥–µ–Ω–æ.', 'error');
                return;
            }
            
            try {
                const registration = await navigator.serviceWorker.ready;
                await registration.showNotification('üöÄ SW –¢–µ—Å—Ç–æ–≤–æ –ò–∑–≤–µ—Å—Ç–∏–µ', {
                    body: '–¢–æ–≤–∞ –∏–∑–≤–µ—Å—Ç–∏–µ –∏–¥–≤–∞ –æ—Ç Service Worker (–ø–æ-–¥–æ–±—Ä–∞ iOS –ø–æ–¥–¥—Ä—ä–∂–∫–∞)',
                    icon: '/icon-192x192.png',
                    badge: '/icon-192x192.png',
                    tag: 'sw-test-notification',
                    requireInteraction: false,
                    vibrate: [200, 100, 200]
                });
                
                showResult('‚úÖ Service Worker –∏–∑–≤–µ—Å—Ç–∏–µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!', 'success');
            } catch (e) {
                showResult('‚ùå Service Worker –≥—Ä–µ—à–∫–∞: ' + e.message, 'error');
            }
        }
        
        function showResult(message, type) {
            const container = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = 'status-box ' + type;
            div.textContent = message;
            container.appendChild(div);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                div.style.opacity = '0';
                setTimeout(() => div.remove(), 300);
            }, 10000);
        }
        
        // Initialize on page load
        updatePlatformInfo();
        
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.error('Service Worker registration failed:', err));
        }
    </script>
</body>
</html>

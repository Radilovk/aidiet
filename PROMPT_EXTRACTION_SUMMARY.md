# –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ AI –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ - –†–µ–∑—é–º–µ

## –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ

–í—Å–∏—á–∫–∏ AI –ø—Ä–æ–º–ø—Ç–æ–≤–µ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∏ –ø–ª–∞–Ω–æ–≤–µ –∏ –∫–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–∏ —Å–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏ –æ—Ç `worker.js` –∏ –æ—Ä–≥–∞–Ω–∏–∑–∏—Ä–∞–Ω–∏ –≤ –æ—Ç–¥–µ–ª–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ –∑–∞ –ø–æ-–ª–µ—Å–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ù–æ–≤–∞ –ø–∞–ø–∫–∞ —Å –ø—Ä–æ–º–ø—Ç–æ–≤–µ
```
KV/prompts/
‚îú‚îÄ‚îÄ README.md                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ
‚îú‚îÄ‚îÄ admin_analysis_prompt.txt          # –ü—Ä–æ–º–ø—Ç –∑–∞ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–µ–Ω –ø—Ä–æ—Ñ–∏–ª
‚îú‚îÄ‚îÄ admin_strategy_prompt.txt          # –ü—Ä–æ–º–ø—Ç –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ –¥–∏–µ—Ç–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
‚îú‚îÄ‚îÄ admin_meal_plan_prompt.txt         # –ü—Ä–æ–º–ø—Ç –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω
‚îú‚îÄ‚îÄ admin_summary_prompt.txt           # –ü—Ä–æ–º–ø—Ç –∑–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –Ω–∞ –ø–ª–∞–Ω–∞
‚îú‚îÄ‚îÄ admin_consultation_prompt.txt      # –ü—Ä–æ–º–ø—Ç –∑–∞ –∫–æ–Ω—Å—É–ª—Ç–∞—Ü–∏–æ–Ω–µ–Ω —Ä–µ–∂–∏–º
‚îú‚îÄ‚îÄ admin_modification_prompt.txt      # –ü—Ä–æ–º–ø—Ç –∑–∞ —Ä–µ–∂–∏–º –Ω–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –ø–ª–∞–Ω–∞
‚îî‚îÄ‚îÄ admin_correction_prompt.txt        # –ü—Ä–æ–º–ø—Ç –∑–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ –≥—Ä–µ—à–∫–∏
```

### –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ

1. **KV/upload-kv-keys.sh** - –°–∫—Ä–∏–ø—Ç—ä—Ç –µ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω –¥–∞ –∫–∞—á–≤–∞ –≤—Å–∏—á–∫–∏ 7 –Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–º–ø—Ç–æ–≤–µ
2. **worker.js** - –î–æ–±–∞–≤–µ–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –∑–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è –∫—ä–º external –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∏

### 1. –í–µ—Ä—Å–∏–æ–Ω–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª
- –í—Å–∏—á–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤–µ —Å–∞ –≤ –æ—Ç–¥–µ–ª–Ω–∏ `.txt` —Ñ–∞–π–ª–æ–≤–µ –≤ `KV/prompts/`
- –õ–µ—Å–Ω–æ —Å–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç –∏ —Å–µ —Å–ª–µ–¥—è—Ç –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –ø—Ä–µ–∑ Git
- –ò–º–∞ README —Å –ø—ä–ª–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 2. Cloudflare KV Storage
- –ü—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ —Å–µ –∫–∞—á–≤–∞—Ç –≤ KV storage —Å `./KV/upload-kv-keys.sh`
- Worker –ø—ä—Ä–≤–æ –ø—Ä–æ–≤–µ—Ä—è–≤–∞ –∑–∞ custom –ø—Ä–æ–º–ø—Ç–æ–≤–µ –≤ KV
- –ê–∫–æ –Ω—è–º–∞ –≤ KV, –∏–∑–ø–æ–ª–∑–≤–∞ –≤–≥—Ä–∞–¥–µ–Ω–∏—Ç–µ –≤ `getDefaultPromptTemplates()`

### 3. Fallback –º–µ—Ö–∞–Ω–∏–∑—ä–º
- –§—É–Ω–∫—Ü–∏—è—Ç–∞ `getDefaultPromptTemplates()` –≤ worker.js –æ—Å—Ç–∞–≤–∞ –Ω–µ–ø—Ä–æ–º–µ–Ω–µ–Ω–∞
- –°—ä–¥—ä—Ä–∂–∞ —Å—ä—â–∏—Ç–µ –ø—Ä–æ–º–ø—Ç–æ–≤–µ –∫–∞—Ç–æ backup
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Ä–∞–±–æ—Ç–∏ –¥–æ—Ä–∏ –∞–∫–æ KV –Ω–µ –µ –Ω–∞–ª–∏—á–Ω–æ

### 4. Admin Panel
- –ü—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ –º–æ–≥–∞—Ç –¥–∞ —Å–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç –ø—Ä–µ–∑ admin –ø–∞–Ω–µ–ª–∞
- –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç –≤ KV storage
- "View Standard Prompt" –±—É—Ç–æ–Ω—ä—Ç –ø–æ–∫–∞–∑–≤–∞ default –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ

## –ö–ª—é—á–æ–≤–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏ (KV Keys)

–í—Å–∏—á–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤–µ —Å–∞ –¥–æ—Å—Ç—ä–ø–Ω–∏ —á—Ä–µ–∑ —Å–ª–µ–¥–Ω–∏—Ç–µ KV –∫–ª—é—á–æ–≤–µ:

1. `admin_analysis_prompt` - –°—Ç—ä–ø–∫–∞ 1: –ê–Ω–∞–ª–∏–∑
2. `admin_strategy_prompt` - –°—Ç—ä–ø–∫–∞ 2: –°—Ç—Ä–∞—Ç–µ–≥–∏—è
3. `admin_meal_plan_prompt` - –°—Ç—ä–ø–∫–∞ 3: –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–Ω –ø–ª–∞–Ω
4. `admin_summary_prompt` - –°—Ç—ä–ø–∫–∞ 4: –†–µ–∑—é–º–µ
5. `admin_consultation_prompt` - –ß–∞—Ç: –ö–æ–Ω—Å—É–ª—Ç–∞—Ü–∏—è
6. `admin_modification_prompt` - –ß–∞—Ç: –ü—Ä–æ–º—è–Ω–∞
7. `admin_correction_prompt` - –í–∞–ª–∏–¥–∞—Ü–∏—è: –ö–æ—Ä–µ–∫—Ü–∏—è

## –ü—Ä–µ–¥–∏–º—Å—Ç–≤–∞

‚úÖ **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è**: –ü—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ —Å–∞ –≤ –æ—Ç–¥–µ–ª–Ω–∞ –ø–∞–ø–∫–∞, –Ω–µ –≤ worker.js  
‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª**: –õ–µ—Å–Ω–æ —Å–µ —Å–ª–µ–¥—è—Ç –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –ø—Ä–µ–∑ Git  
‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ**: –ú–æ–∂–µ –¥–∞ —Å–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤—ä–≤ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ  
‚úÖ **KV Storage**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ –∫–∞—á–≤–∞—Ç –≤ Cloudflare KV  
‚úÖ **Backup**: –ò–º–∞ fallback –≤ worker.js –∞–∫–æ KV –Ω–µ —Ä–∞–±–æ—Ç–∏  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: README —Å –ø—ä–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –≤—Å–µ–∫–∏ –ø—Ä–æ–º–ø—Ç  
‚úÖ **Admin Panel**: –ú–æ–∂–µ –¥–∞ —Å–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç –ø—Ä–µ–∑ UI  

## –ö–∞–∫ –¥–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞—Ç–µ –ø—Ä–æ–º–ø—Ç–æ–≤–µ

### –ú–µ—Ç–æ–¥ 1: –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ (–ø—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ)
```bash
# 1. –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ —Ñ–∞–π–ª
nano KV/prompts/admin_analysis_prompt.txt

# 2. –ö–∞—á–µ—Ç–µ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –≤ KV
./KV/upload-kv-keys.sh

# 3. Commit –∏ push
git add KV/prompts/
git commit -m "Update analysis prompt"
git push
```

### –ú–µ—Ç–æ–¥ 2: –ü—Ä–µ–∑ Admin Panel
1. –û—Ç–∏–¥–µ—Ç–µ –Ω–∞ https://aidiet.radilov-k.workers.dev/admin.html
2. –í–ª–µ–∑—Ç–µ —Å –ø–∞—Ä–æ–ª–∞: nutriplan2024
3. –ò–∑–±–µ—Ä–µ—Ç–µ –ø—Ä–æ–º–ø—Ç –æ—Ç dropdown
4. –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ –∏ –∑–∞–ø–∞–∑–µ—Ç–µ
5. –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç –≤ KV storage

### –ú–µ—Ç–æ–¥ 3: –î–∏—Ä–µ–∫—Ç–Ω–æ –≤ Cloudflare Dashboard
1. –û—Ç–∏–¥–µ—Ç–µ –Ω–∞ https://dash.cloudflare.com/
2. Workers & Pages ‚Üí KV
3. –ò–∑–±–µ—Ä–µ—Ç–µ namespace: page_content
4. –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ —Å—ä–æ—Ç–≤–µ—Ç–Ω–∏—è –∫–ª—é—á

**–í–ê–ñ–ù–û**: –ü—Ä–∏ –º–µ—Ç–æ–¥ 2 –∏ 3, –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –∏ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ –≤ —Ä–µ–ø–æ—Ç–æ –∑–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç!

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–µ—Ç–∞–π–ª–∏

### –§–æ—Ä–º–∞—Ç –Ω–∞ placeholders
–ü—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç —Å–ø–µ—Ü–∏–∞–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç:
- –í —Ñ–∞–π–ª–æ–≤–µ—Ç–µ: `{name}`, `{age}`, `{goal}` –∏ —Ç.–Ω.
- –í worker.js –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ: `${data.name}`, `${data.age}` –∏ —Ç.–Ω.
- –ó–∞–º–µ–Ω—è—Ç —Å–µ –æ—Ç `replacePromptVariables()` —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞

### Upload –ø—Ä–æ—Ü–µ—Å
```bash
# –°–∫—Ä–∏–ø—Ç—ä—Ç upload-kv-keys.sh:
1. –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –∑–∞ wrangler CLI
2. –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è
3. –ö–∞—á–≤–∞ –≤—Å–µ–∫–∏ –ø—Ä–æ–º–ø—Ç —Ñ–∞–π–ª –≤ KV
4. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞ –∫–∞—á–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
```

### Runtime flow
```javascript
// 1. Worker –ø–æ–ª—É—á–∞–≤–∞ –∑–∞—è–≤–∫–∞ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ
// 2. –ò–∑–≤–∏–∫–≤–∞ generateAnalysisPrompt()
// 3. –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –∑–∞ custom prompt: env.page_content.get('admin_analysis_prompt')
// 4. –ê–∫–æ –Ω—è–º–∞ custom, –∏–∑–ø–æ–ª–∑–≤–∞ getDefaultPromptTemplates().analysis
// 5. –ó–∞–º–µ–Ω—è placeholders —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏
// 6. –ò–∑–ø—Ä–∞—â–∞ –∫—ä–º AI –º–æ–¥–µ–ª
```

## –¢–µ—Å—Ç–≤–∞–Ω–µ

–ó–∞ –¥–∞ —Ç–µ—Å—Ç–≤–∞—Ç–µ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ:

1. **Syntax check**:
   ```bash
   node -c worker.js
   ```

2. **Local dev**:
   ```bash
   npm run dev
   ```

3. **Upload prompts**:
   ```bash
   ./KV/upload-kv-keys.sh
   ```

4. **Verify in admin panel**:
   - –û—Ç–≤–æ—Ä–µ—Ç–µ admin.html
   - –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ —á–µ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç –ø—Ä–∞–≤–∏–ª–Ω–æ

## –°—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç

- ‚úÖ –û–±—Ä–∞—Ç–Ω–æ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ —Å –ø—Ä–µ–¥–∏—à–Ω–∏ –≤–µ—Ä—Å–∏–∏
- ‚úÖ –†–∞–±–æ—Ç–∏ –¥–æ—Ä–∏ –∞–∫–æ KV –Ω–µ –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–æ (–∏–∑–ø–æ–ª–∑–≤–∞ fallback)
- ‚úÖ Legacy –ø—Ä–æ–º–ø—Ç–æ–≤–µ (`admin_plan_prompt`, `admin_chat_prompt`) –≤—Å–µ –æ—â–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞—Ç
- ‚úÖ –í—Å–∏—á–∫–∏ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—è—Ç –±–µ–∑ –ø—Ä–æ–º–µ–Ω–∏

## –°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)

1. ‚úÖ –°—ä–∑–¥–∞–¥–µ–Ω–∏ —Å–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–º–ø—Ç —Ñ–∞–π–ª–æ–≤–µ
2. ‚úÖ –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω –µ upload —Å–∫—Ä–∏–ø—Ç–∞
3. ‚úÖ –î–æ–±–∞–≤–µ–Ω–∞ –µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
4. üîÑ –ö–∞—á–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ –≤ Cloudflare KV (–∏–∑–∏—Å–∫–≤–∞ wrangler)
5. üîÑ –¢–µ—Å—Ç–≤–∞–Ω–µ –≤ production environment

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–∏—á–∫–∏ AI –ø—Ä–æ–º–ø—Ç–æ–≤–µ —Å–∞ —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏ –æ—Ç `worker.js` –∏ –æ—Ä–≥–∞–Ω–∏–∑–∏—Ä–∞–Ω–∏ –≤ –æ—Ç–¥–µ–ª–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ –≤ `KV/prompts/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞. –ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–∞ –æ–±—Ä–∞—Ç–Ω–æ —Å—ä–≤–º–µ—Å—Ç–∏–º–∏ –∏ –ø–æ–¥–æ–±—Ä—è–≤–∞—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ—Ç–æ –Ω–∞ –ø—Ä–æ–º–ø—Ç–æ–≤–µ—Ç–µ.

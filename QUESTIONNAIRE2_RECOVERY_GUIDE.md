# Възстановяване на данни от Въпросник 2.0

## Какво е това?

Тази функция позволява възстановяване на данни от Въпросник 2.0, които са били запазени в локалния кеш (localStorage) на браузъра, но не са били изпратени към сървъра.

## Кога да използвате тази функция?

Използвайте тази функция ако:
- Въпросник 2.0 е бил попълнен, но данните не са били записани на сървъра
- Данните все още са в кеша на браузъра
- Искате да запазите данните постоянно в базата данни

## Как работи?

### АВТОМАТИЧНО! Просто отворете линка

**Важно:** Всичко се случва автоматично при отваряне на страницата!

1. **Отворете линка** в **същия браузър**, където са били попълнени въпросниците:

```
https://biocode.website/questionnaire2-recovery.html
```

2. **Изчакайте 1-2 секунди** - страницата автоматично:
   - Търси всички записи от Въпросник 2.0 в localStorage
   - Изпраща ги към сървъра чрез API endpoint `/api/save-questionnaire2-data`
   - Записва ги в KV хранилището на Cloudflare
   - Изтрива ги от localStorage след успешно запазване

3. **Виждате резултата** на екрана:
   - ✅ **"Успешно!"** - данните са изпратени и запазени
   - ❌ **"Грешка!"** - данните не можаха да се изпратят (остават в кеша)
   - ℹ️ **"Няма данни"** - не са намерени данни в кеша

**Никакви бутони, никакви действия - всичко е автоматично!**

## Технически детайли

### Формат на данните

Данните са запазени в localStorage с ключ:
```
questionnaire2_client_{timestamp}_{random}
```

Структура на данните:
```json
{
  "id": "client_1234567890_abc123",
  "timestamp": "2026-02-13T12:00:00.000Z",
  "answers": {
    "name": "Име на клиента",
    "email": "email@example.com",
    "age": "35",
    "gender": "Жена",
    ...
  },
  "files": [
    {
      "name": "test-result.pdf",
      "type": "application/pdf",
      "size": 102400,
      "data": "data:application/pdf;base64,..."
    }
  ]
}
```

### API Endpoint

**POST** `/api/save-questionnaire2-data`

**Request Body:** Пълен обект с данни (виж формата по-горе)

**Response при успех:**
```json
{
  "success": true,
  "id": "client_1234567890_abc123",
  "message": "Questionnaire data saved successfully"
}
```

**Response при грешка:**
```json
{
  "error": "Error message"
}
```

### Къде се съхраняват данните?

След запазване в сървъра, данните се съхраняват в:
- **Cloudflare KV** с ключ: `questionnaire2_data:{clientId}`
- **Списък с ID-та**: `questionnaire2_data_list` (съдържа списък с всички ID-та)

## Често задавани въпроси

### Какво ще стане ако затворя браузъра?

Данните в localStorage остават запазени, докато не изчистите кеша на браузъра или не ги изтриете ръчно. Можете да отворите страницата за възстановяване по-късно.

### Мога ли да възстановя данни от друг браузър?

Не. localStorage е специфичен за браузъра и домейна. Трябва да използвате същия браузър, където са били попълнени въпросниците.

### Мога ли да възстановя данни от друго устройство?

Не. localStorage е локален за устройството. Не може да се синхронизира между устройства.

### Какво става с данните след успешно запазване?

След успешно запазване в сървъра:
1. Данните се записват в KV хранилището
2. Автоматично се изтриват от localStorage
3. Страницата се опреснява и показва актуализирания списък

### Колко време остават данните в localStorage?

Данните остават в localStorage докато:
- Не се изчисти кеша на браузъра
- Не се изтрият ръчно
- Не бъдат изпратени към сървъра (тогава се изтриват автоматично)

## Безопасност

- Данните се изпращат през HTTPS (шифрована връзка)
- Не се съхраняват междинни копия
- След успешно запазване, локалните данни се изтриват
- Файловете се съхраняват в base64 формат

## Поддръжка

За проблеми или въпроси, свържете се с екипа на:
- Email: [посочен в контактите]
- GitHub Issues: https://github.com/Radilovk/aidiet/issues

## Версия

Добавена: Февруари 2026
Последна актуализация: Февруари 2026
